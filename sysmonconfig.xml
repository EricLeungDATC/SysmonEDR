<!--
  last update: 29 Jan 2021
  sysmon-config | A Sysmon configuration focused on default high-quality event tracing and easy customization by the community
  Source version:	71 | Date: 2020-01-16
  Source project:	https://github.com/SwiftOnSecurity/sysmon-config
  Source license:	Creative Commons Attribution 4.0 | You may privatize, fork, edit, teach, publish, or deploy for commercial use - with attribution in the text.

  Fork version:	<N/A>
  Fork author:	<N/A>
  Fork project:	<N/A>
  Fork license:	<N/A>

  REQUIRED: Sysmon version 13 or higher (due to changes in syntax and bug-fixes)
	https://docs.microsoft.com/en-us/sysinternals/downloads/sysmon

  NOTE: To collect Sysmon logs centrally for free, see https://aka.ms/WEF | Command to allow log access to the Network Service:
	wevtutil.exe sl Microsoft-Windows-Sysmon/Operational /ca:O:BAG:SYD:(A;;0xf0005;;;SY)(A;;0x5;;;BA)(A;;0x1;;;S-1-5-32-573)(A;;0x1;;;NS)

  NOTE: Do not let the size and complexity of this configuration discourage you from customizing it or building your own.
	This configuration is based around known, high-signal event tracing, and thus appears complicated, but it is only very
	detailed. Significant effort over years has been invested in front-loading as much filtering as possible onto the
	client. This is to make analysis of intrusions possible by hand, and to try to surface anomalous activity as quickly
	as possible to technicians armed only with Event Viewer. Its purpose is to democratize system monitoring for all organizations.

  NOTE: Sysmon is NOT a whitelist solution or HIDS correlation engine, it is a computer change logging tool.
	Do NOT ignore everything possible. Sysmon's purpose is providing context during a threat or problem investigation. Legitimate
	processes are routinely used by threats - do not blindly exclude them. Additionally, be mindful of process-hollowing / imitation.

  NOTE: By default this monitors DNS, which is extremely noisy. If you are starting out on your monitoring journey, just remove that section.
	You can remove DNS events from Event Viewer screen by applying a 'Filter Current View' for event IDs of: -22
	Additionally, if you want to monitor DNS, you should deploy client-side adblocking to reduce lookups. See the DNS section for info.

  NOTE: This configuration is designed for PER-MACHINE installs of Chrome and OneDrive. That moves their binaries out of user-controlled folders.
	Otherwise, attackers could imitate these common applications, and bypass your logging. Below are silent upgrades you can do, no user impact:
	- https://docs.microsoft.com/en-us/onedrive/per-machine-installation
	- https://cloud.google.com/chrome-enterprise/browser/download/
	- As of 2019-08-25 there is no usermode version of Microsoft Teams.

  NOTE: Sysmon is not hardened against an attacker with admin rights. Additionally, this configuration offers an attacker, willing
	to study it, limited ways to evade some of the logging. If you are in a very high-threat environment, you should consider a broader,
	log-most approach. However, in the vast majority of cases, an attacker will bumble through multiple behavioral traps which
	this configuration monitors, especially in the first minutes. Even APT do not send their A-team unless they know you're hardened.
	5% of the effort gets 95% of the results. APT rely on nobody watching because almost nobody does. Your effort makes the difference.

  NOTE: If you encounter unexplainable event inclusion/exclusion, you may have a second Sysmon instance installed under a different exe filename.
	To clear this, try downloading the latest version and uninstalling with -u force. If it hangs, kill the processes and run it again to cleanup.

  TECHNICAL:
  - Run sysmon.exe -? for a briefing on Sysmon configuration.
  - Sysmon XML cannot use the AMPERSAND sign. Replace it with this: &amp;
  - Sysmon 8+ can track which rule caused an event to be logged through the "RuleName" field.
  - If you only specify exclude for a filtering subsection, everything in that subsection is logged by default.
  - Some Sysmon monitoring abilities are not meant for widely deployed general-purpose use due to performance impact. Depends on environment.
  - Duplicate or overlapping "Include" rules do not result in duplicate events being logged.
  - All characters enclosed by XML tags are always interpreted literally. Sysmon does not support wildcards (*), alternate characters, or RegEx.
  - In registry events, the value name is appended to the full key path with a "\" delimiter. Default key values are named "\(Default)"
  - "Image" is a technical term for a compiled binary file like an EXE or DLL. Also, it can match just the filename, or entire path.
  - "ProcessGuid" and "LoginGuid" are not random, they contain some embedded information. https://gist.github.com/mattifestation/0102042160c9a60b2b847378c0ef70b4

  FILTERING: Filter conditions available for use are: is, is not, contains, excludes, begin with, end with, less than, more than, image
  - The "image" filter is usable on any field. Same as "is" but can either match entire string, or only the text after last "\". Credit: @mattifestation

-->

<Sysmon schemaversion="4.50">
	<!--SYSMON META CONFIG-->
	<HashAlgorithms>*</HashAlgorithms> <!-- Both MD5 and SHA256 are the industry-standard algorithms for identifying files -->
	<CheckRevocation/> <!-- Check loaded drivers, log if their code-signing certificate has been revoked, in case malware stole one to sign a kernel driver -->

	<DnsLookup>False</DnsLookup>
	<!-- Disables lookup behavior, default is True (Boolean) -->
	<ArchiveDirectory>Sysmon</ArchiveDirectory>
	<!-- Sets the name of the directory in the C:\ root where preserved files will be saved (String)-->
	<CaptureClipboard />
	<!--This enables capturing the Clipboard changes-->
	<!-- <ImageLoad/> --> <!-- Would manually force-on ImageLoad monitoring, even without configuration below. Included only documentation. -->
	<!-- <ProcessAccessConfig/> --> <!-- Would manually force-on ProcessAccess monitoring, even without configuration below. Included only documentation. -->
	<!-- <PipeMonitoringConfig/> --> <!-- Would manually force-on PipeCreated / PipeConnected events, even without configuration below. Included only documentation. -->

	<EventFiltering>

	<!--SYSMON EVENT ID 1 : PROCESS CREATION [ProcessCreate]-->
		<!--COMMENT:	All processes launched will be logged, except for what matches a rule below. It's best to be as specific as possible,
			to avoid user-mode executables imitating other process names to avoid logging, or if malware drops files in an existing directory.
			Ultimately, you must weigh CPU time checking many detailed rules, against the risk of malware exploiting the blindness created.
			Beware of Masquerading, where attackers imitate the names and paths of legitimate tools. Ideally, you'd use both file path and
			code signatures to validate, but Sysmon does not support that. Look into AppLocker/WindowsDeviceGuard for whitelisting support. -->

		<!--DATA: UtcTime, ProcessGuid, ProcessID, Image, FileVersion, Description, Product, Company, CommandLine, CurrentDirectory, User, LogonGuid, LogonId, TerminalSessionId, IntegrityLevel, Hashes, ParentProcessGuid, ParentProcessId, ParentImage, ParentCommandLine, RuleName-->
	<RuleGroup name="" groupRelation="or">
		<ProcessCreate onmatch="include">
			<!--Accessibility Features-->
			<ParentImage name="flag=Amber,technique_id=T1546.008,technique_name=Accessibility Features" condition="image">sethc.exe</ParentImage>
			<ParentImage name="flag=Info,technique_id=T1546.008,technique_name=Accessibility Features" condition="image">utilman.exe</ParentImage>
			<ParentImage name="flag=Info,technique_id=T1546.008,technique_name=Accessibility Features" condition="image">osk.exe</ParentImage>
			<ParentImage name="flag=Info,technique_id=T1546.008,technique_name=Accessibility Features" condition="image">Magnify.exe</ParentImage>
			<ParentImage name="flag=Info,technique_id=T1546.008,technique_name=Accessibility Features" condition="image">DisplaySwitch.exe</ParentImage>
			<ParentImage name="flag=Info,technique_id=T1546.008,technique_name=Accessibility Features" condition="image">Narrator.exe</ParentImage>
			<ParentImage name="flag=Info,technique_id=T1546.008,technique_name=Accessibility Features" condition="image">AtBroker.exe</ParentImage>
			<!--Appc Shim-->
			<OriginalFileName name="flag=Info,technique_id=T1546.011,technique_name=Application Shimming" condition="is">sdbinst.exe</OriginalFileName>
			<!--Bitsadmin-->
			<OriginalFileName name="flag=Info,technique_id=T1197,technique_name=BITS Jobs" condition="is">bitsadmin.exe</OriginalFileName>
			<!--Bypass UAC-->
			<Rule name="flag=Red,technique_id=T1548.002,technique_name=Bypass User Access Control" groupRelation="and">
          		<ParentImage name="flag=Red,technique_id=T1548.002,technique_name=Bypass User Access Control" condition="image">eventvwr.exe</ParentImage><!-- eventvwr.exe launching child process other than mmc.exe -->
         		<Image name="flag=Info" condition="is not">c:\windows\system32\mmc.exe</Image>
        	</Rule>
         	<ParentImage name="flag=Info,technique_id=T1548.002,technique_name=Bypass User Account Control" condition="image">fodhelper.exe</ParentImage>
			<!--Dosfuscation-->
			<CommandLine name="flag=Info,technique_id=T1027,technique_name=Obfuscated Files or Information" condition="contains">Ë†</CommandLine><!-- https://www.fireeye.com/content/dam/fireeye-www/blog/pdfs/dosfuscation-report.pdf  -->
        	<CommandLine name="flag=Info,technique_id=T1027,technique_name=Obfuscated Files or Information" condition="contains">../../</CommandLine><!--https://twitter.com/julianpentest/status/1270595517794451456-->
			<!--Explorer-->
			<ParentCommandLine name="flag=Info,technique_id=T1204,technique_name=User Execution" condition="is">C:\Windows\explorer.exe</ParentCommandLine>
			<!--Fltmc-->
        	<Rule name="flag=Red,technique_id=T1054,technique_name=Indicator Blocking,Fltmc" groupRelation="and">
          		<OriginalFileName name="flag=Red,technique_id=T1054,technique_name=Indicator Blocking" condition="is">fltMC.exe</OriginalFileName>
         		<CommandLine name="flag=Red,technique_id=T1054,technique_name=Indicator Blocking" condition="contains">unload;detach</CommandLine>
        	</Rule>
        	<OriginalFileName name="flag=Info,technique_id=T1518.001,technique_name=Security Software Discovery" condition="is">fltMC.exe</OriginalFileName>
        	<CommandLine name="flag=Info,technique_id=T1518.001,technique_name=Security Software Discovery" condition="contains">misc::mflt</CommandLine>
			<!--Installuti-->
			<Rule name="flag=Red,technique_id=T1218.004,technique_name=InstallUtil" groupRelation="and">
          		<OriginalFileName name="flag=Red,technique_id=T1218.004,technique_name=InstallUtil" condition="is">InstallUtil.exe</OriginalFileName>
          		<CommandLine name="flag=Red,technique_id=T1218.004,technique_name=InstallUtil" condition="contains all">/logfile=;/LogToConsole=false;/U</CommandLine>
        	</Rule>
			<!--Native Windows tools - Living off the land-->
			<OriginalFileName name="flag=Amber,technique_id=T1033,technique_name=System Owner/User Discovery" condition="is">whoami.exe</OriginalFileName><!--Microsoft:Windows: shows current user -->
			<OriginalFileName name="flag=Info,technique_id=T1016,technique_name=System Network Configuration Discovery" condition="is">ipconfig.exe</OriginalFileName><!--Microsoft:Windows: shows ip configuration -->
			<OriginalFileName name="flag=Amber,technique_id=T1057,technique_name=Process Discovery" condition="is">tasklist.exe</OriginalFileName> <!--Mitre T1057--><!--Mitre T1007--><!--Microsoft:Windows: shows current running processes-->
      		<OriginalFileName name="flag=Amber,technique_id=T1057,technique_name=Process Discovery" condition="is">taskmgr.exe</OriginalFileName> <!--Mitre T1057--><!--Mitre T1007--><!--Microsoft:Windows: shows current running processes-->
			<OriginalFileName name="flag=Info,technique_id=T1033,technique_name=System Owner/User Discovery" condition="contains any">systeminfo.exe;sysinfo.exe</OriginalFileName><!--Mitre T1033--><!--Mitre T1082--><!--Microsoft:Windows: shows systeminformation -->
			<OriginalFileName name="flag=Info,technique_id=T1049,technique_name=System Network Connections Discovery" condition="is">netstat.exe</OriginalFileName> <!--Mitre T1016--><!--Mitre T1049--><!--Microsoft:Windows: shows protocol statistics and current TCP/IP network connections -->
			<OriginalFileName name="flag=Info,technique_id=T1057,technique_name=Process Discovery" condition="image">qprocess.exe</OriginalFileName> <!--Microsoft:Windows: shows information about processes -->
     		<OriginalFileName name="flag=Info,technique_id=T1016,technique_name=System Network Configuration Discovery" condition="is">nslookup.exe</OriginalFileName><!--Microsoft:Windows: shows DNS configuration and enables quering -->
      		<OriginalFileName name="flag=Red,technique_id=T1018,technique_name=Remote System Discovery" condition="contains any">net.exe;net1.exe</OriginalFileName> <!--Mitre T1201--><!--Mitre T1007--><!--Mitre T1124--><!--Mitre T1018--><!--Mitre T1049--><!--Mitre T1087--><!--Mitre T1135--><!--Mitre T1069--><!--Mitre T1016--><!--Mitre T1021.002--><!--Microsoft:Windows: "net use"/"net view" used by attackers to surveil and connect with file shares from command line | Credit @ion-storm -->
			<OriginalFileName name="flag=Amber,technique_id=T1033,technique_name=System Owner/User Discovery" condition="is">quser.exe</OriginalFileName> <!--Microsoft:Windows: shows logged-on users -->
			<OriginalFileName name="flag=Info,technique_id=T1057,technique_name=Process Discovery" condition="is">query.exe</OriginalFileName> <!--Microsoft:Windows: shows information about processes -->
			<OriginalFileName name="flag=Info,technique_id=T1016,technique_name=System Network Configuration Discovery" condition="is">tracert.exe</OriginalFileName> <!--Microsoft:Windows: shows routing information -->
			<OriginalFileName name="flag=Info,technique_id=T1083,technique_name=File and Directory Discovery" condition="is">tree.com</OriginalFileName> <!--Microsoft:Windows: shows recursive directory listing -->
			<OriginalFileName name="flag=Red,technique_id=T1016,technique_name=System Network Configuration Discovery" condition="is">route.exe</OriginalFileName> <!--Microsoft:Windows: manipulates network routing tables -->
			<OriginalFileName name="flag=Red,technique_id=T1134,technique_name=Access Token Manipulation" condition="is">runas.exe</OriginalFileName> <!--Microsoft:Windows: run a process as another user -->
			<OriginalFileName name="flag=Red,technique_id=T1112,technique_name=Modify Registry" condition="is">reg.exe</OriginalFileName> <!--Mitre T1552.002--><!--Mitre T1012--><!--Mitre T1112--><!--Microsoft:Windows: reads and modifies the Windows register -->
      		<OriginalFileName name="flag=Amber,technique_id=T1112,technique_name=Modify Registry" condition="is">regedit.exe</OriginalFileName> <!--Mitre T1552.002--><!--Mitre T1012--><!--Mitre T1112--><!--Microsoft:Windows: reads and modifies the Windows register -->
			<OriginalFileName name="flag=Red" condition="is">taskkill.exe</OriginalFileName> <!--Microsoft:Windows: stops processes -->
			<OriginalFileName name="flag=Amber,technique_id=T1518.001,technique_name=Security Software Discovery" condition="is">netsh.exe</OriginalFileName> <!--Mitre T1016--><!--Mitre T1546.007--><!--Mitre T1518.001--><!--Microsoft:Windows: manipulate the firewall -->
			<OriginalFileName name="flag=Red,technique_id=T1087,technique_name=Account Discovery" condition="is">klist.exe</OriginalFileName> <!--Microsoft:Windows: show cached kerberos tickets -->
			<OriginalFileName name="flag=Red,technique_id=T1070,technique_name=Indicator Removal on Host" condition="is">wevtutil.exe</OriginalFileName><!--Microsoft:Windows: read and modify the Windows Eventlog -->
      		<OriginalFileName name="flag=Red,technique_id=T1053,technique_name=Scheduled Task" condition="is">taskeng.exe</OriginalFileName><!--Microsoft:Windows: taskscheduler -->
			<OriginalFileName name="flag=Amber,technique_id=T1053,technique_name=Scheduled Task/Job" condition="is">taskeng.exe</OriginalFileName><!--Microsoft:Windows: taskscheduler -->
 			<OriginalFileName name="flag=Amber,technique_id=T1218.010,technique_name=Regsvr32" condition="is">regsvr32.exe</OriginalFileName> <!--Mitre T1218.010--><!--Mitre T1218.011--><!--Microsoft:Windows: [ https://subt0x10.blogspot.com/2016/04/bypass-application-whitelisting-script.html ] -->
			<ParentImage name="flag=Amber,technique_id=T1047,technique_name=Windows Management Instrumentation" condition="image">wmiprvse.exe</ParentImage>
			<OriginalFileName name="flag=Amber,technique_id=T1047,technique_name=Windows Management Instrumentation" condition="is">wmiprvse.exe</OriginalFileName>
			<OriginalFileName name="Red" condition="is">hh.exe</OriginalFileName> <!--Microsoft:Windows: HTML Helper-->
			<OriginalFileName name="flag=Amber,technique_id=T1059.003,technique_name=Windows Command Shell" condition="is">cmd.exe</OriginalFileName><!--Microsoft:Windows: Command prompt-->
			<ParentImage name="flag=Amber,technique_id=T1059.003,technique_name=Windows Command Shell" condition="image">cmd.exe</ParentImage><!--Microsoft:Windows: Command prompt-->
			<Image name="flag=Red,technique_id=T1059.001,technique_name=PowerShell" condition="image">powershell.exe</Image><!--Microsoft:Windows: PowerShell interface-->
			<OriginalFileName name="flag=Red,technique_id=T1059.003,technique_name=Windows Command Shell" condition="is">cmd.exe</OriginalFileName><!--Microsoft:Windows: Command prompt-->
			<ParentImage name="flag=Red,technique_id=T1059.003,technique_name=Windows Command Shell" condition="image">cmd.exe</ParentImage><!--Microsoft:Windows: Command prompt-->
			<Image name="flag=Red,technique_id=T1059.001,technique_name=PowerShell" condition="image">powershell.exe</Image><!--Microsoft:Windows: PowerShell interface-->
			<ParentImage name="flag=Red,technique_id=T1059.001,technique_name=PowerShell" condition="image">powershell.exe</ParentImage><!--Microsoft:Windows: PowerShell interface-->
			<ParentImage name="flag=Red,technique_id=T1059.001,technique_name=PowerShell" condition="image">powershell_ise.exe</ParentImage><!--Microsoft:Windows: PowerShell interface--><OriginalFileName name="flag=Info,technique_id=T1202,technique_name=Indirect Command Execution" condition="is">bash.exe</OriginalFileName><!--Microsoft:Windows: bash on Windows, Linux subsystem-->
			<OriginalFileName name="flag=Red,technique_id=T1073,technique_name=DLL Side-Loading" condition="is">odbcconf.exe</OriginalFileName> <!--Microsoft:Windows: allows for driver loads -->
			<Image name="flag=Amber,technique_id=T1202,technique_name=Indirect Command Execution" condition="image">pcalua.exe</Image><!--Microsoft:Windows: Program Compatibility Assistant)-->
			<OriginalFileName name="flag=Red,technique_id=T1202,technique_name=Indirect Command Execution" condition="is">cscript.exe</OriginalFileName>
			<OriginalFileName name="flag=Info,technique_id=T1202,technique_name=Indirect Command Execution" condition="is">wscript.exe</OriginalFileName>
			<ParentImage name="flag=Info,technique_id=T1202,technique_name=Indirect Command Execution" condition="image">pcalua.exe</ParentImage><!--Microsoft:Windows: Program Compatibility Assistant)-->
			<ParentImage name="flag=Info,technique_id=T1202,technique_name=Indirect Command Execution" condition="image">cscript.exe</ParentImage>
			<ParentImage name="flag=Info,technique_id=T1202,technique_name=Indirect Command Execution" condition="image">wscript.exe</ParentImage>
			<ParentImage name="flag=Red,technique_id=T1218.005,technique_name=Mshta" condition="image">mshta.exe</ParentImage>
			<ParentImage name="flag=Info,technique_id=T1202,technique_name=Indirect Command Execution" condition="image">control.exe</ParentImage> <!-- https://twitter.com/rikvduijn/status/853251879320662017 -->
			<OriginalFileName name="flag=Info,technique_id=T1218.005,technique_name=Mshta" condition="is">mshta.exe</OriginalFileName>
			<OriginalFileName name="flag=Info,technique_id=T1564.001,technique_name=Hidden Files and DirectoriesHidden Files and Directories" condition="is">attrib.exe</OriginalFileName>
			<OriginalFileName name="flag=Info,technique_id=T1087,technique_name=Account Discovery" condition="is">cmdkey.exe</OriginalFileName> <!--Microsoft:Windows: creates, lists, and deletes stored user names and passwords or credentials.-->
			<OriginalFileName name="flag=Info,technique_id=T1016,technique_name=System Network Configuration Discovery" condition="contains any">nbtstat.exe;nbtinfo.exe</OriginalFileName> <!--Microsoft:Windows: NetBIOS statistics, attackers use to enumerate local network -->
			<OriginalFileName name="flag=Amber,technique_id=T1057,technique_name=Process Discovery" condition="is">qwinsta.exe</OriginalFileName> <!--Microsoft:Windows: Remotely query login sessions on a server or workstation | Credit @ion-storm -->
			<OriginalFileName name="flag=Red,technique_id=T1057,technique_name=Process Discovery" condition="is">rwinsta.exe</OriginalFileName> <!--Microsoft:Windows: Disconnect remote sessions | Credit @ion-storm -->
			<OriginalFileName name="flag=Red,technique_id=T1053,technique_name=Scheduled Task/Job" condition="contains any">schtasks.exe;sctasks.exe</OriginalFileName> <!--Microsoft:Windows: Command-line interface to local and remote tasks -->
			<OriginalFileName name="flag=Red,technique_id=T1218,technique_name=Signed Binary Proxy Execution" condition="is">replace.exe</OriginalFileName>
			<Image name="flag=Info,technique_id=T1218,technique_name=Signed Binary Proxy Execution" condition="image">jjs.exe</Image>
			<Image name="flag=Info,technique_id=T1218,technique_name=Signed Binary Proxy Execution" condition="image">appcmd.exe</Image>
			<OriginalFileName name="flag=Red,technique_id=T1543.003,technique_name=Windows Service" condition="is">sc.exe</OriginalFileName>
			<OriginalFileName name="flag=Red,technique_id=T1202,technique_name=Indirect Command Execution" condition="is">certutil.exe</OriginalFileName>
			<OriginalFileName name="flag=Red,technique_id=T1202,technique_name=Indirect Command Execution" condition="is">desktopimgdownldr.exe</OriginalFileName><!--https://labs.sentinelone.com/living-off-windows-land-a-new-native-file-downldr/-->
			<OriginalFileName name="flag=Info,technique_id=T1552.001,technique_name=Credentials in Files" condition="is">findstr.exe</OriginalFileName>
			<OriginalFileName name="flag=Info,technique_id=T1552.001,technique_name=Credentials in Files" condition="is">where.exe</OriginalFileName>
			<Image name="flag=Info,technique_id=T1222,technique_name=File Permissions Modification" condition="image">forfiles.exe</Image>
			<OriginalFileName name="flag=Info,technique_id=T1222,technique_name=File Permissions Modification" condition="contains any">icacls.exe;cacls.exe</OriginalFileName>
			<OriginalFileName name="flag=Info,technique_id=T1074,technique_name=Data Staged" condition="is">xcopy.exe</OriginalFileName>
			<OriginalFileName name="flag=Red,technique_id=T1074,technique_name=Data Staged" condition="is">robocopy.exe</OriginalFileName>
			<OriginalFileName name="flag=Red,technique_id=T1222,technique_name=File Permissions Modification" condition="is">takeown.exe</OriginalFileName>
			<OriginalFileName name="flag=Red,technique_id=T,technique_name=" condition="is">makecab.exe</OriginalFileName>
			<OriginalFileName name="flag=Red,technique_id=T,technique_name=" condition="is">wusa.exe</OriginalFileName>
			<OriginalFileName name="flag=Red,technique_id=T1490,technique_name=Inhibit System Recovery" condition="is">vssadmin.exe</OriginalFileName>
			<OriginalFileName name="flag=Amber,technique_id=T1033,technique_name=System Owner/User Discovery" condition="contains any">nltest.exe;nltestk.exe</OriginalFileName><!-- netlogon testing utility-->
			<OriginalFileName name="flag=Red,technique_id=T1202,technique_name=Indirect Command Execution" condition="is">winrs.exe</OriginalFileName>
			<OriginalFileName name="flag=Info,technique_id=T1548.002,technique_name=Bypass User Access Control" condition="is">computerdefaults.exe</OriginalFileName>
			<OriginalFileName name="flag=Info,technique_id=T1548.002,technique_name=Bypass User Access Control" condition="is">dism.exe</OriginalFileName>
			<OriginalFileName name="flag=Info,technique_id=T1548.002,technique_name=Bypass User Access Control" condition="is">fodhelper.exe</OriginalFileName>
			<OriginalFileName name="flag=Info,technique_id=T1078,technique_name=Valid Accounts" condition="is">djoin.exe</OriginalFileName><!--Create computer account -->
			<OriginalFileName name="flag=Amber,technique_id=T1040,technique_name=Network Sniffing" condition="is">PktMon.exe</OriginalFileName><!--Native windows packet sniffer -->
			<OriginalFileName name="flag=Amber,technique_id=T1047,technique_name=Windows Management Instrumentation" condition="is">mofcomp.exe</OriginalFileName><!-- Microsoft:MOF Compiler -used to compile custom MOF files for WMI use -->
			<Image name="flag=Amber,technique_id=T1047,technique_name=Windows Management Instrumentation" condition="begin with">C:\WINDOWS\system32\wbem\scrcons.exe</Image>
			<OriginalFileName name="flag=Info,technique_id=T1047,technique_name=Windows Management Instrumentation" condition="is">ScrCons</OriginalFileName>
			<Rule name="flag=Red,technique_id=T1003,technique_name=Credential Dumping,Extensible Storage Engine Utilities" groupRelation="and">
				<OriginalFileName name="flag=Red,technique_id=T1003,technique_name=Credential Dumping" condition="is">esentutl.exe</OriginalFileName>
				<CommandLine name="flag=Red,technique_id=T1003,technique_name=Credential Dumping" condition="contains all">/y;/vss/d</CommandLine>
			</Rule>
			<Rule name="flag=Red,technique_id=1482,technique_name=Domain Trust Discovery,Domain Name" groupRelation="and">
				<OriginalFileName name="flag=Red,technique_id=1482,technique_name=Domain Trust Discovery" condition="is">nltest.exe</OriginalFileName>
				<CommandLine name="flag=Red,technique_id=1482,technique_name=Domain Trust Discovery" condition="contains">/domain_trusts</CommandLine>
			</Rule>
			<OriginalFileName name="flag=Amber,technique_id=T1218,technique_name=Signed Binary Proxy Execution" condition="is">ATBroker.exe</OriginalFileName>
			<OriginalFileName name="flag=Info,technique_id=T1127,technique_name=Trusted Developer Utilities Proxy Execution" condition="is">csc.exe</OriginalFileName><!--https://lolbas-project.github.io/lolbas/Binaries/Csc/-->
       		<OriginalFileName name="flag=Info,technique_id=T1127,technique_name=Trusted Developer Utilities Proxy Execution" condition="is">dfsvc.exe</OriginalFileName><!--https://lolbas-project.github.io/lolbas/Binaries/Dfsvc/-->
       		<OriginalFileName name="flag=Amber,technique_id=T1569.002,technique_name=Service Execution" condition="is">dnscmd.exe</OriginalFileName><!--Service Execution--><OriginalFileName name="flag=Info,technique_id=T1096,technique_name=NTFS File Attributes" condition="is">esentutl.exe</OriginalFileName><!--https://lolbas-project.github.io/lolbas/Binaries/Esentutl/ Multiple options-->
			<OriginalFileName name="flag=Info,technique_id=T1105,technique_name=Ingress Tool Transfer" condition="is">expand</OriginalFileName>
			<OriginalFileName name="flag=Info,technique_id=T1218,technique_name=Signed Binary Proxy Execution" condition="is">extexport.exe</OriginalFileName>
			<OriginalFileName name="flag=Info,technique_id=T1096,technique_name=NTFS File Attributes" condition="is">extrac32.exe</OriginalFileName>
			<OriginalFileName name="flag=Info,technique_id=T1105,technique_name=Ingress Tool Transfer" condition="is">IEExec.exe</OriginalFileName>
			<OriginalFileName name="flag=Info,technique_id=T1127,technique_name=Trusted Developer Utilities Proxy Execution" condition="is">ilasm.exe</OriginalFileName>
			<OriginalFileName name="flag=Info,technique_id=T1218,technique_name=Signed Binary Proxy Execution" condition="is">InfDefaultInstall.EXE</OriginalFileName>
			<OriginalFileName name="flag=Info,technique_id=T1127,technique_name=Trusted Developer Utilities Proxy Execution" condition="is">jsc.exe</OriginalFileName>
			<OriginalFileName name="flag=Info,technique_id=T1127,technique_name=Trusted Developer Utilities Proxy Execution" condition="is">vbc.exe</OriginalFileName>
			<OriginalFileName name="flag=Info,technique_id=T1127,technique_name=Trusted Developer Utilities Proxy Execution" condition="is">Microsoft.Workflow.Compiler.exe</OriginalFileName>
			<OriginalFileName name="flag=Info,technique_id=T1218,technique_name=Signed Binary Proxy Execution" condition="is">msconfig.EXE</OriginalFileName>
			<OriginalFileName name="flag=Info,technique_id=T1218,technique_name=Signed Binary Proxy Execution" condition="is">Msdt.exe</OriginalFileName><!--https://lolbas-project.github.io/lolbas/Binaries/Msdt/-->
			<OriginalFileName name="flag=Amber,technique_id=T1218,technique_name=Signed Binary Proxy Execution" condition="is">msiexec.exe</OriginalFileName>
			<OriginalFileName name="flag=Red,technique_id=T1218,technique_name=Signed Binary Proxy Execution" condition="is">odbcconf.exe</OriginalFileName>
			<OriginalFileName name="flag=Info,technique_id=T1218,technique_name=Signed Binary Proxy Execution" condition="is">PresentationHost.exe</OriginalFileName>
			<OriginalFileName name="flag=Info,technique_id=T1105,technique_name=Ingress Tool Transfer" condition="is">Print.Exe</OriginalFileName>
			<OriginalFileName name="flag=Info,technique_id=T1218,technique_name=Signed Binary Proxy Execution" condition="is">rasdlui.exe</OriginalFileName><!--pre win10, rasautou.exe-->
			<OriginalFileName name="flag=Info,technique_id=T1218,technique_name=Signed Binary Proxy Execution" condition="is">RegisterCimProvider2.exe</OriginalFileName><!--Image name is RegisterCimProvider.exe-->
			<OriginalFileName name="flag=Info,technique_id=T1218,technique_name=Signed Binary Proxy Execution" condition="is">Register-CimProvider.exe</OriginalFileName>
			<OriginalFileName name="flag=Info,technique_id=T1003,technique_name=Credential Dumping" condition="is">RpcPing.exe</OriginalFileName><!--https://lolbas-project.github.io/lolbas/Binaries/Rpcping/-->
			<OriginalFileName name="flag=Info,technique_id=T1218,technique_name=Signed Binary Proxy Execution" condition="is">ScriptRunner.exe</OriginalFileName>
			<OriginalFileName name="flag=Info,technique_id=T1003,technique_name=Credential Dumping" condition="is">TTTracer.exe</OriginalFileName><!--Also able to spawn processes https://lolbas-project.github.io/lolbas/Binaries/Tttracer/-->
			<OriginalFileName name="flag=Info,technique_id=T1218,technique_name=Signed Binary Proxy Execution" condition="is">verclsid.exe</OriginalFileName>
			<OriginalFileName name="flag=Info,technique_id=T1218,technique_name=Signed Binary Proxy Execution" condition="is">wab.exe</OriginalFileName><!--http://www.hexacorn.com/blog/2018/05/01/wab-exe-as-a-lolbin/-->
			<OriginalFileName name="flag=Red,technique_id=T1548.002,technique_name=Bypass User Access Control" condition="is">WSReset.exe</OriginalFileName>
			<OriginalFileName name="flag=Info,technique_id=T1548.002,technique_name=Bypass User Access Control" condition="is">xwizard.exe</OriginalFileName><!--https://bohops.com/2018/08/18/abusing-the-com-registry-structure-part-2-loading-techniques-for-evasion-and-persistence/ -->
			<!--mavinject-->
			<Rule name="flag=Amber,technique_id=T1218,technique_name=Signed Binary Proxy Execution,Mavinject" groupRelation="and">
				<OriginalFileName name="flag=Amber,technique_id=T1218,technique_name=Signed Binary Proxy Execution" condition="contains any">Mavinject.exe;mavinject64.exe</OriginalFileName>
				<CommandLine name="flag=Amber,technique_id=T1218,technique_name=Signed Binary Proxy Execution" condition="contains">/INJECTRUNNING</CommandLine>
			</Rule>
			<!--Microsoft cmstp-->
			<Rule name="flag=Red,technique_id=T1218.003,technique_name=CMSTP,Mavinject" groupRelation="and">
				<OriginalFileName name="flag=Red,technique_id=T1218.003,technique_name=CMSTP" condition="is">CMSTP.exe</OriginalFileName><!--Microsoft Connection Manager Profile Installer-->
				<CommandLine name="flag=Red,technique_id=T1218.003,technique_name=CMSTP" condition="contains all">/ni;/s</CommandLine>
			</Rule>
			<!--Msbuild-->
			<OriginalFileName name="flag=Amber,technique_id=T1127,technique_name=Trusted Developer Utilities Proxy Execution" condition="is">MSBuild.exe</OriginalFileName>
			<!--Microsoft Office-->
			<ParentImage name="flag=Amber,technique_id=T1137,technique_name=Office Application Startup" condition="image">excel.exe</ParentImage>
			<ParentImage name="flag=Amber,technique_id=T1137,technique_name=Office Application Startup" condition="image">winword.exe</ParentImage>
			<ParentImage name="flag=Amber,technique_id=T1137,technique_name=Office Application Startup" condition="image">powerpnt.exe</ParentImage>
			<ParentImage name="flag=Amber,technique_id=T1137,technique_name=Office Application Startup" condition="image">outlook.exe</ParentImage>
			<ParentImage name="flag=Amber,technique_id=T1137,technique_name=Office Application Startup" condition="image">msaccess.exe</ParentImage>
			<ParentImage name="flag=Amber,technique_id=T1137,technique_name=Office Application Startup" condition="image">mspub.exe</ParentImage>
			<!--Regsvcs regasm-->
			<OriginalFileName name="flag=Amber,technique_id=T1218.009,technique_name=Regsvcs/Regasm" condition="contains any">regsvcs.exe;regasm.exe</OriginalFileName>
			<!--Syncappvpublishingserver-->
			<Image name="flag=Amber,technique_id=T1218,technique_name=Signed Binary Proxy Execution" condition="image">SyncAppvPublishingServer.exe</Image>
			<!--Sysinternal-->
			<!--Note: Not all Sysinternals listed here, only the ones I know/suspect to be used for malicious activity -->
			<OriginalFileName name="flag=Info,technique_id=T1057,technique_name=Process Discovery" condition="is">PsList.exe</OriginalFileName><!--Note: Also for the pslist64.exe -->
			<OriginalFileName name="flag=Red,technique_id=T1007,technique_name=System Service Discovery" condition="is">PsService.exe</OriginalFileName>
			<OriginalFileName name="flag=Info,technique_id=T1569.002,technique_name=Service Execution" condition="is">PsExec.exe</OriginalFileName>
			<OriginalFileName name="flag=Info,technique_id=T1569.002,technique_name=Service Execution" condition="is">PsExec.c</OriginalFileName><!--Note: in some versions named like this -->
			<OriginalFileName name="flag=Info,technique_id=T1033,technique_name=System Owner/User Discovery" condition="is">PsGetSID.exe</OriginalFileName>
			<OriginalFileName name="flag=Info,technique_id=T1089,technique_name=Disabling Security Tools" condition="is">PsKill.exe</OriginalFileName>
			<OriginalFileName name="flag=Info,technique_id=T1089,technique_name=Disabling Security Tools" condition="is">PKill.exe</OriginalFileName><!--Note: in some versions named like this -->
			<OriginalFileName name="flag=Amber,technique_id=T1003,technique_name=Credential Dumping" condition="contains">ProcDump</OriginalFileName><!--Note: in some versions naming differs -->
			<OriginalFileName name="flag=Red,technique_id=T1033,technique_name=System Owner/User Discovery" condition="is">PsLoggedOn.exe</OriginalFileName>
			<OriginalFileName name="flag=Info,technique_id=T1105,technique_name=Ingress Tool Transfer" condition="image">PsFile.exe</OriginalFileName>
			<OriginalFileName name="flag=Info,technique_id=T1548.002,technique_name=Bypass User Access Control" condition="contains">ShellRunas</OriginalFileName><!--Note: in some versions naming differs -->
			<OriginalFileName name="flag=Info,technique_id=T1057,technique_name=Process Discovery" condition="is">PipeList.exe</OriginalFileName>
			<OriginalFileName name="flag=Info,technique_id=T1083,technique_name=File and Directory Discovery" condition="is">AccessChk.exe</OriginalFileName>
			<OriginalFileName name="flag=Info,technique_id=T1083,technique_name=File and Directory Discovery" condition="is">AccessEnum.exe</OriginalFileName>
			<OriginalFileName name="flag=Info,technique_id=T1033,technique_name=System Owner/User Discovery" condition="is">LogonSessions.exe</OriginalFileName>
			<OriginalFileName name="flag=Info,technique_id=T1005,technique_name=Data from Local System" condition="is">PsLogList.exe</OriginalFileName>
			<OriginalFileName name="flag=Info,technique_id=T1057,technique_name=Process Discovery" condition="is">PsInfo.exe</OriginalFileName>
			<OriginalFileName name="flag=Info,technique_id=T1007,technique_name=System Service Discovery" condition="contains">LoadOrd</OriginalFileName><!--Note: in some versions naming differs -->
			<OriginalFileName name="flag=Red,technique_id=T1098,technique_name=Account Manipulation" condition="is">PsPasswd.exe</OriginalFileName>
			<OriginalFileName name="flag=Info,technique_id=T1012,technique_name=Query Registry" condition="is">ru.exe</OriginalFileName>
			<OriginalFileName name="flag=Info,technique_id=T1012,technique_name=Query Registry" condition="contains">Regsize</OriginalFileName>
			<OriginalFileName name="flag=Info,technique_id=T1003,technique_name=Credential Dumping" condition="is">ProcDump</OriginalFileName><!--Note: in some versions naming differs -->
			<CommandLine name="flag=Red,technique_id=T1003,technique_name=Credential Dumping"  condition="is">-ma lsass.exe</CommandLine>
			<!--uncommon locations-->
			<Image name="flag=Amber,technique_id=T1036,technique_name=Masquerading" condition="begin with">C:\PerfLogs\</Image>
			<Image name="flag=Info,technique_id=T1036,technique_name=Masquerading" condition="begin with">C:\$Recycle.bin\</Image>
			<Image name="flag=Info,technique_id=T1036,technique_name=Masquerading" condition="begin with">C:\Intel\Logs\</Image>
			<Image name="flag=Info,technique_id=T1036,technique_name=Masquerading" condition="begin with">C:\Users\Default\</Image>
			<Image name="flag=Info,technique_id=T1036,technique_name=Masquerading" condition="begin with">C:\Users\Public\</Image>
			<Image name="flag=Info,technique_id=T1036,technique_name=Masquerading" condition="begin with">C:\Users\NetworkService\</Image>
			<Image name="flag=Info,technique_id=T1036,technique_name=Masquerading" condition="begin with">C:\Windows\Fonts\</Image>
			<Image name="flag=Info,technique_id=T1036,technique_name=Masquerading" condition="begin with">C:\Windows\Debug\</Image>
			<Image name="flag=Info,technique_id=T1036,technique_name=Masquerading" condition="begin with">C:\Windows\Media\</Image>
			<Image name="flag=Info,technique_id=T1036,technique_name=Masquerading" condition="begin with">C:\Windows\Help\</Image>
			<Image name="flag=Info,technique_id=T1036,technique_name=Masquerading" condition="begin with">C:\Windows\addins\</Image>
			<Image name="flag=Info,technique_id=T1036,technique_name=Masquerading" condition="begin with">C:\Windows\repair\</Image>
			<Image name="flag=Info,technique_id=T1036,technique_name=Masquerading" condition="begin with">C:\Windows\security\</Image>
			<Image name="flag=Info,technique_id=T1036,technique_name=Masquerading" condition="begin with">C:\Windows\system32\config\systemprofile\</Image>
			<Image name="flag=Info,technique_id=T1036,technique_name=Masquerading" condition="contains">VolumeShadowCopy</Image>
			<Image name="flag=Info,technique_id=T1036,technique_name=Masquerading" condition="contains">\htdocs\</Image>
			<Image name="flag=Info,technique_id=T1036,technique_name=Masquerading" condition="contains">\wwwroot\</Image>
			<Image name="flag=Info,technique_id=T1036,technique_name=Masquerading" condition="contains">\Temp\</Image>
			<Image name="flag=Info,technique_id=T1036,technique_name=Masquerading" condition="contains">\Appdata\Local\</Image><!--Thanks to Josh Frazier-->
			<!--Control Panel Items-->
			<Rule name="flag=Red,technique_id=T1218.002,technique_name=Control Panel Items" groupRelation="or">
				<CommandLine name="flag=Red,technique_id=T1218.002,technique_name=Control Panel Items" condition="contains all">control;/name</CommandLine>
				<CommandLine name="flag=Red,technique_id=T1218.002,technique_name=Control Panel Items" condition="contains all">rundll32.exe;shell32.dll;Control_RunDLL</CommandLine>
			</Rule>
			<!--Windows defender tampering-->
			<Rule name="flag=Red,technique_id=T1089,technique_name=Disabling Security Tools,Windows Defender tampering" groupRelation="and">
				<Image name="flag=Red,technique_id=T1089,technique_name=Disabling Security Tools" condition="image">MpCmdRun.exe</Image><!-- Credit @viss http://www.offensiveops.io/tools/incapacitating-windows-defender/ -->
				<CommandLine name="flag=Red,technique_id=T1089,technique_name=Disabling Security Tools" condition="contains any">Add-MpPreference;RemoveDefinitions;DisableIOAVProtection</CommandLine><!-- Credit @viss http://www.offensiveops.io/tools/incapacitating-windows-defender/ -->
			</Rule>
			<!--Windows remote management-->
			<OriginalFileName name="flag=Red,technique_id=T1021.006,technique_name=Windows Remote Management" condition="is">wsmprovhost.exe</OriginalFileName>
		    <Image name="flag=Info,technique_id=T1021.006,technique_name=Windows Remote Management" condition="image">winrm.cmd</Image>
		</ProcessCreate>
	
	</RuleGroup>
	<RuleGroup name="" groupRelation="or">
		<ProcessCreate onmatch="exclude">

			<ParentImage name="flag=Info" condition="is">C:\Program Files\Palo Alto Networks\Traps\cyserver.exe</ParentImage><!--Palo Alto Cortex XDR-->

			<!--SECTION: Microsoft Windows-->
			<CommandLine name="flag=Info" condition="begin with"> "C:\Windows\system32\wermgr.exe" "-queuereporting_svc" </CommandLine> <!--Windows:Windows error reporting/telemetry-->
			<CommandLine name="flag=Info" condition="begin with">C:\Windows\system32\DllHost.exe /Processid</CommandLine> <!--Windows-->
			<CommandLine name="flag=Info" condition="begin with">C:\Windows\system32\wbem\wmiprvse.exe -Embedding</CommandLine> <!--Windows: WMI provider host-->
			<CommandLine name="flag=Info" condition="begin with">C:\Windows\system32\wbem\wmiprvse.exe -secured -Embedding</CommandLine> <!--Windows: WMI provider host-->
			<CommandLine name="flag=Info" condition="is">C:\Windows\system32\wermgr.exe -upload</CommandLine> <!--Windows:Windows error reporting/telemetry-->
			<CommandLine name="flag=Info" condition="is">C:\Windows\system32\SearchIndexer.exe /Embedding</CommandLine> <!--Windows: Search Indexer-->
			<CommandLine name="flag=Info" condition="is">C:\windows\system32\wermgr.exe -queuereporting</CommandLine> <!--Windows:Windows error reporting/telemetry-->
			<CommandLine name="flag=Info" condition="is">\??\C:\Windows\system32\autochk.exe *</CommandLine> <!--Microsoft:Bootup: Auto Check Utility-->
			<CommandLine name="flag=Info" condition="is">\SystemRoot\System32\smss.exe</CommandLine> <!--Microsoft:Bootup: Windows Session Manager-->
			<CommandLine name="flag=Info" condition="is">C:\Windows\System32\RuntimeBroker.exe -Embedding</CommandLine> <!--Windows:Apps permissions [ https://fossbytes.com/runtime-broker-process-windows-10/ ] -->
			<Image name="flag=Info" condition="is">C:\Program Files (x86)\Common Files\microsoft shared\ink\TabTip32.exe</Image> <!--Windows: Touch Keyboard and Handwriting Panel Helper-->
			<Image name="flag=Info" condition="is">C:\Windows\System32\TokenBrokerCookies.exe</Image> <!--Windows: SSO sign-in assistant for MicrosoftOnline.com-->
			<Image name="flag=Info" condition="is">C:\Windows\System32\plasrv.exe</Image> <!--Windows: Performance Logs and Alerts DCOM Server-->
			<Image name="flag=Info" condition="is">C:\Windows\System32\wifitask.exe</Image> <!--Windows: Wireless Background Task-->
			<Image name="flag=Info" condition="is">C:\Windows\system32\CompatTelRunner.exe</Image> <!--Windows: Customer Experience Improvement-->
			<Image name="flag=Info" condition="is">C:\Windows\system32\PrintIsolationHost.exe</Image> <!--Windows: Printing-->
			<Image name="flag=Info" condition="is">C:\Windows\system32\SppExtComObj.Exe</Image> <!--Windows: KMS activation-->
			<Image name="flag=Info" condition="is">C:\Windows\system32\audiodg.exe</Image> <!--Windows: Launched constantly-->
			<Image name="flag=Info" condition="is">C:\Windows\system32\conhost.exe</Image> <!--Windows: Command line interface host process-->
			<Image name="flag=Info" condition="is">C:\Windows\system32\mobsync.exe</Image> <!--Windows: Network file syncing-->
			<Image name="flag=Info" condition="is">C:\Windows\system32\musNotification.exe</Image> <!--Windows: Update pop-ups-->
			<Image name="flag=Info" condition="is">C:\Windows\system32\musNotificationUx.exe</Image> <!--Windows: Update pop-ups-->
			<Image name="flag=Info" condition="is">C:\Windows\system32\powercfg.exe</Image> <!--Microsoft:Power configuration management-->
			<Image name="flag=Info" condition="is">C:\Windows\system32\sndVol.exe</Image> <!--Windows: Volume control-->
			<Image name="flag=Info" condition="is">C:\Windows\system32\sppsvc.exe</Image> <!--Windows: Software Protection Service-->
			<Image name="flag=Info" condition="is">C:\Windows\system32\wbem\WmiApSrv.exe</Image> <!--Windows: WMI performance adapter host process-->
			<IntegrityLevel name="flag=Info" condition="is">AppContainer</IntegrityLevel> <!--Windows: Don't care about sandboxed processes right now. Will need to revisit this decision.-->
			<ParentCommandLine name="flag=Info" condition="begin with">%%SystemRoot%%\system32\csrss.exe ObjectDirectory=\Windows</ParentCommandLine> <!--Windows:CommandShell: Triggered when programs use the command shell, but doesn't provide attribution for what caused it-->
			<ParentCommandLine name="flag=Info" condition="is">C:\windows\system32\wermgr.exe -queuereporting</ParentCommandLine> <!--Windows:Windows error reporting/telemetry-->
			<CommandLine name="flag=Info" condition="is">C:\WINDOWS\system32\devicecensus.exe UserCxt</CommandLine>
			<CommandLine name="flag=Info" condition="is">C:\Windows\System32\usocoreworker.exe -Embedding</CommandLine>
			<ParentImage name="flag=Info" condition="is">C:\Windows\system32\SearchIndexer.exe</ParentImage> <!--Windows:Search: Launches many uninteresting sub-processes-->
			<!--SECTION: Windows:svchost-->
			<CommandLine name="flag=Info" condition="is">C:\Windows\system32\svchost.exe -k appmodel -s StateRepository</CommandLine>
			<CommandLine name="flag=Info" condition="is">C:\Windows\system32\svchost.exe -k appmodel -p -s camsvc</CommandLine>
			<CommandLine name="flag=Info" condition="is">C:\Windows\system32\svchost.exe -k appmodel</CommandLine> <!--Windows 10-->
			<CommandLine name="flag=Info" condition="is">C:\Windows\system32\svchost.exe -k appmodel -p -s tiledatamodelsvc</CommandLine>
			<CommandLine name="flag=Info" condition="is">C:\Windows\system32\svchost.exe -k camera -s FrameServer</CommandLine>
			<CommandLine name="flag=Info" condition="is">C:\Windows\system32\svchost.exe -k dcomlaunch -s LSM</CommandLine>
			<CommandLine name="flag=Info" condition="is">C:\Windows\system32\svchost.exe -k dcomlaunch -s PlugPlay</CommandLine>
			<CommandLine name="flag=Info" condition="is">C:\Windows\system32\svchost.exe -k defragsvc</CommandLine> <!--Windows defragmentation-->
			<CommandLine name="flag=Info" condition="is">C:\Windows\system32\svchost.exe -k devicesflow -s DevicesFlowUserSvc</CommandLine>
			<CommandLine name="flag=Info" condition="is">C:\Windows\system32\svchost.exe -k imgsvc</CommandLine> <!--Microsoft:The Windows Image Acquisition Service-->
			<CommandLine name="flag=Info" condition="is">C:\Windows\system32\svchost.exe -k localService -s EventSystem</CommandLine>
			<CommandLine name="flag=Info" condition="is">C:\Windows\system32\svchost.exe -k localService -s bthserv</CommandLine>
			<CommandLine name="flag=Info" condition="is">C:\Windows\system32\svchost.exe -k LocalService -p -s BthAvctpSvc</CommandLine>
			<CommandLine name="flag=Info" condition="is">C:\Windows\system32\svchost.exe -k localService -s nsi</CommandLine>
			<CommandLine name="flag=Info" condition="is">C:\Windows\system32\svchost.exe -k localService -s w32Time</CommandLine>
			<CommandLine name="flag=Info" condition="is">C:\Windows\system32\svchost.exe -k localServiceAndNoImpersonation</CommandLine> <!--Windows: Network services-->
			<CommandLine name="flag=Info" condition="is">C:\Windows\system32\svchost.exe -k localServiceNetworkRestricted -s Dhcp</CommandLine> <!--Windows: Network services-->
			<CommandLine name="flag=Info" condition="is">C:\Windows\system32\svchost.exe -k localServiceNetworkRestricted -s EventLog</CommandLine>
			<CommandLine name="flag=Info" condition="is">C:\Windows\system32\svchost.exe -k localServiceNetworkRestricted -s TimeBrokerSvc</CommandLine>
			<CommandLine name="flag=Info" condition="is">C:\Windows\system32\svchost.exe -k localServiceNetworkRestricted -s WFDSConMgrSvc</CommandLine>
			<CommandLine name="flag=Info" condition="is">C:\Windows\system32\svchost.exe -k LocalServiceNetworkRestricted -s BTAGService</CommandLine>
			<CommandLine name="flag=Info" condition="is">C:\Windows\System32\svchost.exe -k LocalSystemNetworkRestricted -p -s NcbService</CommandLine> <!--Win10:1903:Network Connection Broker-->
			<CommandLine name="flag=Info" condition="is">C:\Windows\system32\svchost.exe -k localServiceNetworkRestricted</CommandLine> <!--Windows: Network services-->
			<CommandLine name="flag=Info" condition="is">C:\Windows\system32\svchost.exe -k localServiceAndNoImpersonation -s SensrSvc</CommandLine>
			<CommandLine name="flag=Info" condition="is">C:\Windows\system32\svchost.exe -k localServiceAndNoImpersonation -p -s SSDPSRV</CommandLine> <!--Windows:SSDP [ https://en.wikipedia.org/wiki/Simple_Service_Discovery_Protocol ] -->
			<CommandLine name="flag=Info" condition="is">C:\Windows\system32\svchost.exe -k localServiceNoNetwork</CommandLine>
			<CommandLine name="flag=Info" condition="is">C:\Windows\system32\svchost.exe -k localSystemNetworkRestricted -p -s WPDBusEnum</CommandLine>
			<CommandLine name="flag=Info" condition="is">C:\Windows\system32\svchost.exe -k localSystemNetworkRestricted -p -s fhsvc</CommandLine>
			<CommandLine name="flag=Info" condition="is">C:\Windows\system32\svchost.exe -k localSystemNetworkRestricted -s DeviceAssociationService</CommandLine>
			<CommandLine name="flag=Info" condition="is">C:\Windows\system32\svchost.exe -k localSystemNetworkRestricted -s NcbService</CommandLine>
			<CommandLine name="flag=Info" condition="is">C:\Windows\system32\svchost.exe -k localSystemNetworkRestricted -s SensorService</CommandLine>
			<CommandLine name="flag=Info" condition="is">C:\Windows\system32\svchost.exe -k localSystemNetworkRestricted -s TabletInputService</CommandLine>
			<CommandLine name="flag=Info" condition="is">C:\Windows\system32\svchost.exe -k localSystemNetworkRestricted -s UmRdpService</CommandLine>
			<CommandLine name="flag=Info" condition="is">C:\Windows\system32\svchost.exe -k localSystemNetworkRestricted -s WPDBusEnum</CommandLine>
			<CommandLine name="flag=Info" condition="is">C:\Windows\system32\svchost.exe -k localSystemNetworkRestricted -p -s NgcSvc</CommandLine> <!--Microsoft:Passport--> 
			<CommandLine name="flag=Info" condition="is">C:\Windows\system32\svchost.exe -k localServiceNetworkRestricted -p -s NgcCtnrSvc</CommandLine> <!--Microsoft:Passport Container--> 
			<CommandLine name="flag=Info" condition="is">C:\Windows\system32\svchost.exe -k localServiceAndNoImpersonation -s SCardSvr</CommandLine>
			<CommandLine name="flag=Info" condition="is">C:\Windows\system32\svchost.exe -k netsvcs -p -s wuauserv</CommandLine>
			<CommandLine name="flag=Info" condition="is">C:\Windows\System32\svchost.exe -k netsvcs -p -s SessionEnv</CommandLine> <!--Windows:Remote desktop configuration-->
			<CommandLine name="flag=Info" condition="is">C:\Windows\system32\svchost.exe -k localSystemNetworkRestricted -s WdiSystemHost</CommandLine> <!--Windows: Diagnostic System Host [ http://www.blackviper.com/windows-services/diagnostic-system-host/ ] -->
			<CommandLine name="flag=Info" condition="is">C:\Windows\System32\svchost.exe -k localSystemNetworkRestricted -p -s WdiSystemHost</CommandLine> <!--Windows: Diagnostic System Host [ http://www.blackviper.com/windows-services/diagnostic-system-host/ ] -->
			<CommandLine name="flag=Info" condition="is">C:\Windows\system32\svchost.exe -k localSystemNetworkRestricted</CommandLine> <!--Windows-->
			<CommandLine name="flag=Info" condition="is">C:\Windows\system32\svchost.exe -k netsvcs -p -s wlidsvc</CommandLine> <!--Windows: Windows Live Sign-In Assistant [ https://www.howtogeek.com/howto/30348/what-are-wlidsvc.exe-and-wlidsvcm.exe-and-why-are-they-running/ ] -->
			<CommandLine name="flag=Info" condition="is">C:\Windows\system32\svchost.exe -k netsvcs -p -s ncaSvc</CommandLine> <!--Windows: Network Connectivity Assistant [ http://www.blackviper.com/windows-services/network-connectivity-assistant/ ] -->
			<CommandLine name="flag=Info" condition="is">C:\Windows\system32\svchost.exe -k netsvcs -s BDESVC</CommandLine> <!--Windows:Network: BitLocker Drive Encryption-->
			<CommandLine name="flag=Info" condition="is">C:\Windows\System32\svchost.exe -k netsvcs -p -s BDESVC</CommandLine> <!--Microsoft:Win10:1903:Network: BitLocker Drive Encryption-->
			<CommandLine name="flag=Info" condition="is">C:\Windows\system32\svchost.exe -k netsvcs -p -s BITS</CommandLine> <!--Windows:Network: Background Intelligent File Transfer (BITS) -->
			<CommandLine name="flag=Info" condition="is">C:\Windows\system32\svchost.exe -k netsvcs -s BITS</CommandLine> <!--Windows:Network: Background Intelligent File Transfer (BITS) -->
			<CommandLine name="flag=Info" condition="is">C:\Windows\system32\svchost.exe -k netsvcs -s CertPropSvc</CommandLine>
			<CommandLine name="flag=Info" condition="is">C:\Windows\system32\svchost.exe -k netsvcs -s DsmSvc</CommandLine>
			<CommandLine name="flag=Info" condition="is">C:\Windows\system32\svchost.exe -k netsvcs -p -s Appinfo</CommandLine>
			<CommandLine name="flag=Info" condition="is">C:\Windows\system32\svchost.exe -k netsvcs -s Gpsvc</CommandLine> <!--Windows:Network: Group Policy -->
			<CommandLine name="flag=Info" condition="is">C:\Windows\system32\svchost.exe -k netsvcs -s ProfSvc</CommandLine> <!--Windows: Network services-->
			<CommandLine name="flag=Info" condition="is">C:\Windows\system32\svchost.exe -k netsvcs -s SENS</CommandLine> <!--Windows: Network services-->
			<CommandLine name="flag=Info" condition="is">C:\Windows\system32\svchost.exe -k netsvcs -s SessionEnv</CommandLine> <!--Windows: Network services-->
			<CommandLine name="flag=Info" condition="is">C:\Windows\system32\svchost.exe -k netsvcs -s Themes</CommandLine> <!--Windows: Network services-->
			<CommandLine name="flag=Info" condition="is">C:\Windows\system32\svchost.exe -k netsvcs -s Winmgmt</CommandLine> <!--Windows: Windows Management Instrumentation (WMI) -->
			<CommandLine name="flag=Info" condition="is">C:\Windows\system32\svchost.exe -k netsvcs</CommandLine> <!--Windows: Network services-->
			<CommandLine name="flag=Info" condition="is">C:\Windows\system32\svchost.exe -k networkService -p -s DoSvc</CommandLine>
			<CommandLine name="flag=Info" condition="is">C:\Windows\system32\svchost.exe -k networkService -s Dnscache</CommandLine> <!--Windows:Network: DNS caching, other uses -->
			<CommandLine name="flag=Info" condition="is">C:\Windows\system32\svchost.exe -k networkService -s LanmanWorkstation</CommandLine> <!--Windows:Network: "Workstation" service, used for SMB file-sharing connections and RDP-->
			<CommandLine name="flag=Info" condition="is">C:\Windows\system32\svchost.exe -k networkService -s NlaSvc</CommandLine> <!--Windows:Network: Network Location Awareness-->
			<CommandLine name="flag=Info" condition="is">C:\Windows\system32\svchost.exe -k networkService -s TermService</CommandLine> <!--Windows:Network: Terminal Services (RDP)-->
			<CommandLine name="flag=Info" condition="is">C:\Windows\system32\svchost.exe -k networkService</CommandLine> <!--Windows: Network services-->
			<CommandLine name="flag=Info" condition="is">C:\Windows\system32\svchost.exe -k networkServiceNetworkRestricted</CommandLine> <!--Windows: Network services-->
			<CommandLine name="flag=Info" condition="is">C:\Windows\system32\svchost.exe -k rPCSS</CommandLine> <!--Windows Services-->
			<CommandLine name="flag=Info" condition="is">C:\Windows\system32\svchost.exe -k secsvcs</CommandLine>
			<CommandLine name="flag=Info" condition="is">C:\Windows\system32\svchost.exe -k swprv</CommandLine> <!--Microsoft:Software Shadow Copy Provider-->
			<CommandLine name="flag=Info" condition="is">C:\Windows\system32\svchost.exe -k unistackSvcGroup</CommandLine> <!--Windows 10-->
			<CommandLine name="flag=Info" condition="is">C:\Windows\system32\svchost.exe -k utcsvc</CommandLine> <!--Windows Services-->
			<CommandLine name="flag=Info" condition="is">C:\Windows\system32\svchost.exe -k wbioSvcGroup</CommandLine> <!--Windows Services-->
			<CommandLine name="flag=Info" condition="is">C:\Windows\system32\svchost.exe -k werSvcGroup</CommandLine> <!--Windows: ErrorReporting-->
			<CommandLine name="flag=Info" condition="is">C:\Windows\system32\svchost.exe -k wusvcs -p -s WaaSMedicSvc</CommandLine> <!--Windows: Update Medic Service [ https://www.thewindowsclub.com/windows-update-medic-service ] -->
			<CommandLine name="flag=Info" condition="is">C:\Windows\System32\svchost.exe -k wsappx -p -s ClipSVC</CommandLine> <!--Windows:Apps: Client License Service-->
			<CommandLine name="flag=Info" condition="is">C:\Windows\system32\svchost.exe -k wsappx -p -s AppXSvc</CommandLine> <!--Windows:Apps: AppX Deployment Service-->
			<CommandLine name="flag=Info" condition="is">C:\Windows\system32\svchost.exe -k wsappx -s ClipSVC</CommandLine> <!--Windows:Apps: Client License Service-->
			<CommandLine name="flag=Info" condition="is">C:\Windows\system32\svchost.exe -k wsappx</CommandLine> <!--Windows:Apps [ https://www.howtogeek.com/320261/what-is-wsappx-and-why-is-it-running-on-my-pc/ ] -->
			<ParentCommandLine name="flag=Info" condition="is">C:\Windows\system32\svchost.exe -k netsvcs</ParentCommandLine> <!--Windows: Network services: Spawns Consent.exe-->
			<ParentCommandLine name="flag=Info" condition="is">C:\Windows\system32\svchost.exe -k localSystemNetworkRestricted</ParentCommandLine> <!--Windows-->
			<CommandLine name="flag=Info" condition="is">C:\Windows\system32\deviceenroller.exe /c /AutoEnrollMDM</CommandLine> <!--Windows: AzureAD device enrollment agent-->
			<!--SECTION: Microsoft:Edge-->
			<CommandLine name="flag=Info" condition="begin with">"C:\Program Files (x86)\Microsoft\Edge Dev\Application\msedge.exe" --type=</CommandLine>
			<!--SECTION: Microsoft:dotNet-->
			<CommandLine name="flag=Info" condition="begin with">C:\Windows\Microsoft.NET\Framework\v4.0.30319\ngen.exe</CommandLine> <!--Microsoft:DotNet-->
			<CommandLine name="flag=Info" condition="begin with">C:\WINDOWS\Microsoft.NET\Framework64\v4.0.30319\Ngen.exe</CommandLine> <!--Microsoft:DotNet-->
			<Image name="flag=Info" condition="is">C:\Windows\Microsoft.NET\Framework64\v4.0.30319\mscorsvw.exe</Image> <!--Microsoft:DotNet-->
			<Image name="flag=Info" condition="is">C:\Windows\Microsoft.NET\Framework\v4.0.30319\mscorsvw.exe</Image> <!--Microsoft:DotNet-->
			<Image name="flag=Info" condition="is">C:\Windows\Microsoft.Net\Framework64\v3.0\WPF\PresentationFontCache.exe</Image> <!--Windows: Font cache service-->
			<ParentCommandLine name="flag=Info" condition="contains">C:\Windows\Microsoft.NET\Framework64\v4.0.30319\ngentask.exe</ParentCommandLine>
			<ParentImage name="flag=Info" condition="is">C:\Windows\Microsoft.NET\Framework64\v4.0.30319\mscorsvw.exe</ParentImage> <!--Microsoft:DotNet-->
			<ParentImage name="flag=Info" condition="is">C:\Windows\Microsoft.NET\Framework64\v4.0.30319\ngentask.exe</ParentImage> <!--Microsoft:DotNet-->
			<ParentImage name="flag=Info" condition="is">C:\Windows\Microsoft.NET\Framework\v4.0.30319\mscorsvw.exe</ParentImage> <!--Microsoft:DotNet-->
			<ParentImage name="flag=Info" condition="is">C:\Windows\Microsoft.NET\Framework\v4.0.30319\ngentask.exe</ParentImage> <!--Microsoft:DotNet: Spawns thousands of ngen.exe processes-->
			<!--SECTION: Microsoft:Office-->
			<Image name="flag=Info" condition="is">C:\Program Files\Microsoft Office\Office16\MSOSYNC.EXE</Image> <!--Microsoft:Office: Background process for SharePoint/Office365 connectivity-->
			<Image name="flag=Info" condition="is">C:\Program Files (x86)\Microsoft Office\Office16\MSOSYNC.EXE</Image> <!--Microsoft:Office: Background process for SharePoint/Office365 connectivity-->
			<Image name="flag=Info" condition="is">C:\Program Files\Common Files\Microsoft Shared\OfficeSoftwareProtectionPlatform\OSPPSVC.EXE</Image> <!--Microsoft:Office: Licensing service-->
			<Image name="flag=Info" condition="is">C:\Program Files\Microsoft Office\Office16\msoia.exe</Image> <!--Microsoft:Office: Telemetry collector-->
			<Image name="flag=Info" condition="is">C:\Program Files (x86)\Microsoft Office\root\Office16\officebackgroundtaskhandler.exe</Image>
			<!--SECTION: Microsoft:Office:Click2Run-->
			<Image name="flag=Info" condition="is">C:\Program Files\Common Files\Microsoft Shared\ClickToRun\OfficeC2RClient.exe</Image> <!--Microsoft:Office: Background process-->
			<ParentImage name="flag=Info" condition="is">C:\Program Files\Common Files\Microsoft Shared\ClickToRun\OfficeClickToRun.exe</ParentImage> <!--Microsoft:Office: Background process-->
			<ParentImage name="flag=Info" condition="is">C:\Program Files\Common Files\Microsoft Shared\ClickToRun\OfficeC2RClient.exe</ParentImage> <!--Microsoft:Office: Background process-->
			<!--SECTION: Windows: Media player-->
			<Image name="flag=Info" condition="is">C:\Program Files\Windows Media Player\wmpnscfg.exe</Image> <!--Windows: Windows Media Player Network Sharing Service Configuration Application-->
			<!--SECTION: Google-->
			<CommandLine name="flag=Info" condition="begin with">"C:\Program Files (x86)\Google\Chrome\Application\chrome.exe" --type=</CommandLine> <!--Google:Chrome: massive command-line arguments-->
			<CommandLine name="flag=Info" condition="begin with">"C:\Program Files\Google\Chrome\Application\chrome.exe" --type=</CommandLine> <!--Google:Chrome: massive command-line arguments-->
			
			<!--Above is default, Below added from Olaf-->
			
			<!--SECTION: Adobe acrobat-->
    		<Rule groupRelation="and">
        		<Image name="flag=Info" condition="end with">AcroRd32.exe</Image>
				<CommandLine name="flag=Info" condition="contains any">/CR;channel=</CommandLine> <!--Adobe:AcrobatReader: Uninteresting sandbox subprocess-->
			</Rule>
			<Image name="flag=Info" condition="end with">C:\Program Files (x86)\Adobe\Acrobat DC\Acrobat\AcroCEF\AcroCEF.exe</Image> <!--Adobe:Acrobat: Sandbox subprocess, still evaluating security exposure-->
			<ParentImage name="flag=Info" condition="end with">C:\Program Files (x86)\Common Files\Adobe\AdobeGCClient\AGSService.exe</ParentImage>
			<Image name="flag=Info" condition="end with">C:\Program Files (x86)\Adobe\Acrobat Reader DC\Reader\AcroCEF\RdrCEF.exe</Image> <!--Adobe:AcrobatReader: Sandbox subprocess, still evaluating security exposure-->
			<Image name="flag=Info" condition="end with">C:\Program Files (x86)\Adobe\Acrobat DC\Acrobat\LogTransport2.exe</Image>
			<!--SECTION: Adobe Creative Cloud-->
			<Image name="flag=Info" condition="end with">C:\Program Files (x86)\Adobe\Adobe Creative Cloud\ACC\Creative Cloud.exe</Image>
			<ParentImage name="flag=Info" condition="end with">C:\Program Files (x86)\Adobe\Adobe Creative Cloud\ACC\Creative Cloud.exe</ParentImage>
			<ParentImage name="flag=Info" condition="end with">C:\Program Files (x86)\Adobe\Adobe Creative Cloud\CCXProcess\CCXProcess.exe</ParentImage>
			<ParentImage name="flag=Info" condition="end with">C:\Program Files (x86)\Adobe\Adobe Creative Cloud\CoreSync\CoreSync.exe</ParentImage>
			<!--SECTION: Adobe Flash-->
			<Image name="flag=Info" condition="end with">C:\Windows\SysWOW64\Macromed\Flash\FlashPlayerUpdateService.exe</Image> <!--Adobe:Flash: Properly hardened updater, not a risk-->
			<!--SECTION: Adobe Supporting processess-->
			<Image name="flag=Info" condition="end with">C:\Program Files (x86)\Common Files\Adobe\ARM\1.0\AdobeARM.exe</Image> <!--Adobe:Updater: Properly hardened updater, not a risk-->
			<ParentImage name="flag=Info" condition="end with">C:\Program Files (x86)\Common Files\Adobe\ARM\1.0\AdobeARM.exe</ParentImage> <!--Adobe:Updater: Properly hardened updater, not a risk-->
			<Image name="flag=Info" condition="end with">C:\Program Files (x86)\Common Files\Adobe\ARM\1.0\armsvc.exe</Image> <!--Adobe:Updater: Properly hardened updater, not a risk-->
			<Image name="flag=Info" condition="end with">C:\Program Files (x86)\Adobe\Acrobat DC\Acrobat\AdobeCollabSync.exe</Image>
			<Image name="flag=Info" condition="end with">C:\Program Files (x86)\Common Files\Adobe\Adobe Desktop Common\HEX\Adobe CEF Helper.exe</Image>
			<Image name="flag=Info" condition="end with">C:\Program Files (x86)\Common Files\Adobe\AdobeGCClient\AdobeGCClient.exe</Image> <!--Adobe:Creative Cloud-->
			<Image name="flag=Info" condition="end with">C:\Program Files (x86)\Common Files\Adobe\OOBE\PDApp\P6\adobe_licutil.exe</Image> <!--Adobe:License utility-->
			<Image name="flag=Info" condition="end with">C:\Program Files (x86)\Common Files\Adobe\OOBE\PDApp\P7\adobe_licutil.exe</Image> <!--Adobe:License utility-->
			<ParentImage name="flag=Info" condition="end with">C:\Program Files (x86)\Common Files\Adobe\OOBE\PDApp\P7\adobe_licutil.exe</ParentImage> <!--Adobe:License utility-->
			<Image name="flag=Info" condition="end with">C:\Program Files (x86)\Common Files\Adobe\OOBE\PDApp\UWA\updaterstartuputility.exe</Image>
			<ParentImage name="flag=Info" condition="is">C:\Program Files (x86)\Common Files\Adobe\OOBE\PDApp\UWA\updaterstartuputility.exe</ParentImage>
			
			
			<ParentCommandLine name="flag=Info" condition="is">"C:\Program Files\Microsoft Monitoring Agent\Agent\MonitoringHost.exe" -Embedding</ParentCommandLine>
				<Rule groupRelation="and">
					<ParentImage name="flag=Info" condition="is">"C:\Program Files\Microsoft Monitoring Agent\Agent\MonitoringHost.exe"</ParentImage> 
					<CommandLine name="flag=Info" condition="is">C:\Windows\system32\cscript.exe" /nologo "MonitorKnowledgeDiscovery.vbs</CommandLine> <!--Microsoft Sentinel SIEM agent, based on MOM - thanks d4ph1l--> 
				</Rule>

			<!--Cisco Anyconnect-->
			<ParentImage name="flag=Info" condition="end with">C:\Program Files (x86)\Cisco\Cisco AnyConnect Secure Mobility Client\vpnagent.exe</ParentImage>
			<!--dotnet 3 or 4-->
			<CommandLine name="flag=Info" condition="begin with">C:\Windows\Microsoft.NET\Framework\v4.0.30319\ngen.exe</CommandLine> <!--Microsoft:DotNet-->
			<Image name="flag=Info" condition="is">C:\Windows\Microsoft.NET\Framework64\v4.0.30319\mscorsvw.exe</Image> <!--Microsoft:DotNet-->
			<Image name="flag=Info" condition="is">C:\Windows\Microsoft.NET\Framework\v4.0.30319\mscorsvw.exe</Image> <!--Microsoft:DotNet-->
			<Image name="flag=Info" condition="is">C:\Windows\Microsoft.Net\Framework64\v3.0\WPF\PresentationFontCache.exe</Image> <!--Microsoft:Windows: Font cache service-->
			<Image name="flag=Info" condition="is">C:\Windows\Microsoft.Net\Framework64\v3.0\WPF\PresentationFontCache.exe</Image> <!--Microsoft:Windows: Font cache service-->
			<ParentCommandLine name="flag=Info" condition="contains">C:\Windows\Microsoft.NET\Framework64\v4.0.30319\ngentask.exe</ParentCommandLine>
			<ParentImage name="flag=Info" condition="is">C:\Windows\Microsoft.NET\Framework64\v4.0.30319\mscorsvw.exe</ParentImage> <!--Microsoft:DotNet-->
			<ParentImage name="flag=Info" condition="is">C:\Windows\Microsoft.NET\Framework64\v4.0.30319\ngentask.exe</ParentImage> <!--Microsoft:DotNet-->
			<ParentImage name="flag=Info" condition="is">C:\Windows\Microsoft.NET\Framework\v4.0.30319\mscorsvw.exe</ParentImage> <!--Microsoft:DotNet-->
			<ParentImage name="flag=Info" condition="is">C:\Windows\Microsoft.NET\Framework\v4.0.30319\ngentask.exe</ParentImage> <!--Microsoft:DotNet-->
			<ParentImage name="flag=Info" condition="is">C:\Windows\Microsoft.NET\Framework\v4.0.30319\ngentask.exe</ParentImage> <!--Microsoft:DotNet: Spawns thousands of ngen.exe processes-->
			<!--Drivers-->
			<Image name="flag=Info" condition="begin with">C:\Program Files\NVIDIA Corporation\</Image> <!--Nvidia:Driver: routine actions-->
			<Image name="flag=Info" condition="begin with">C:\Program Files\Realtek\</Image> <!--Realtek:Driver: routine actions-->
			<ParentImage name="flag=Info" condition="end with">C:\Program Files\Realtek\Audio\HDA\RtkAudioService64.exe</ParentImage> <!--Realtek:Driver: routine actions-->
			<!--Dropbox-->
			<Image name="flag=Info" condition="end with">C:\Program Files (x86)\Dropbox\Update\DropboxUpdate.exe</Image> <!--Dropbox:Updater: Lots of command-line arguments-->
			<ParentImage name="flag=Info" condition="end with">C:\Program Files (x86)\Dropbox\Update\DropboxUpdate.exe</ParentImage>
			<!--Eset-->
			<Image name="flag=Info" condition="is">C:\Program Files\ESET\ESET Nod32 Antivirus\ekrn.exe</Image>  <!--Credit d4ph1l -->
			<!--Google Chrome-->
			<CommandLine name="flag=Info" condition="begin with">"C:\Program Files (x86)\Google\Chrome\Application\chrome.exe" --type=</CommandLine> <!--Google:Chrome: massive command-line arguments-->
			<CommandLine name="flag=Info" condition="begin with">"C:\Program Files\Google\Chrome\Application\chrome.exe" --type=</CommandLine> <!--Google:Chrome: massive command-line arguments-->
			<Image name="flag=Info" condition="begin with">C:\Program Files (x86)\Google\Update\</Image> <!--Google:Chrome: Updater-->
			<ParentImage name="flag=Info" condition="begin with">C:\Program Files (x86)\Google\Update\</ParentImage> <!--Google:Chrome: Updater-->
			<!--Ivanti res-->
			<ParentImage name="flag=Info" condition="is">C:\Program Files (x86)\RES Software\Workspace Manager\pfwsmgr.exe</ParentImage>
			<ParentImage name="flag=Info" condition="is">C:\Program Files (x86)\RES Software\Workspace Manager\respesvc64.exe</ParentImage>
			<ParentImage name="flag=Info" condition="is">C:\Program Files (x86)\Ivanti\Workspace Control\pfwsmgr.exe</ParentImage>
			<ParentImage name="flag=Info" condition="is">C:\Program Files (x86)\RES Software\Workspace Manager\ResPesvc64.exe</ParentImage>
			<ParentImage name="flag=Info" condition="is">C:\Program Files\RES Software\Workspace Manager\respesvc.exe</ParentImage>
			<ParentImage name="flag=Info" condition="is">C:\Program Files\Ivanti\Workspace Control\ResPesvc.exe</ParentImage>
			<!--Malwarebytes-->
			<Image name="flag=Info" condition="is">C:\Program Files\Malwarebytes\Anti-Malware\mbam.exe</Image> <!--Credit d4ph1l -->
        	<Image name="flag=Info" condition="is">C:\Program Files\Malwarebytes\Anti-Malware\mbamservice.exe</Image> <!--Credit d4ph1l -->
        	<Image name="flag=Info" condition="is">C:\Program Files\Malwarebytes\Anti-Malware\mbamtray.exe</Image> <!--Credit d4ph1l -->
			<!--Microsoft office click2run-->
			<Image name="flag=Info" condition="is">C:\Program Files\Common Files\Microsoft Shared\ClickToRun\OfficeC2RClient.exe</Image> <!--Microsoft:Office: Background process-->
			<ParentImage name="flag=Info" condition="end with">C:\Program Files\Common Files\Microsoft Shared\ClickToRun\OfficeClickToRun.exe</ParentImage> <!--Microsoft:Office: Background process-->
			<ParentImage name="flag=Info" condition="is">C:\Program Files\Common Files\Microsoft Shared\ClickToRun\OfficeC2RClient.exe</ParentImage> <!--Microsoft:Office: Background process-->
			<!--Microsoft office services-->
			<Image name="flag=Info" condition="is">C:\Program Files (x86)\Microsoft Office\Office16\MSOSYNC.EXE</Image> <!--Microsoft:Office: Background process-->
			<Image name="flag=Info" condition="is">C:\Program Files\Common Files\Microsoft Shared\OfficeSoftwareProtectionPlatform\OSPPSVC.EXE</Image> <!--Microsoft:Office: Background process-->
			<!--Mozilla Firefox-->
			<CommandLine name="flag=Info" condition="begin with">"C:\Program Files\Mozilla Firefox\plugin-container.exe" --channel</CommandLine> <!-- Mozilla:Firefox: Large command-line arguments | Credit @Darkbat91 -->
			<CommandLine name="flag=Info" condition="begin with">"C:\Program Files (x86)\Mozilla Firefox\plugin-container.exe" --channel</CommandLine> <!-- Mozilla:Firefox: Large command-line arguments | Credit @Darkbat91 -->
			<!--Sophos-->
			<Image name="flag=Info" condition="is">C:\Program Files (x86)\Sophos\Sophos Anti-Virus\Web Intelligence\swi_service.exe</Image> <!--Credit d4ph1l -->
			<Image name="flag=Info" condition="is">C:\Program Files (x86)\Sophos\Sophos Anti-Virus\Web Control\swc_service.exe</Image> <!--Credit d4ph1l -->
			<Image name="flag=Info" condition="is">C:\Program Files (x86)\Sophos\Sophos System Protection\ssp.exe</Image> <!--Credit d4ph1l -->
			<Image name="flag=Info" condition="is">C:\Program Files (x86)\Sophos\Remote Management System\RouterNT.exe</Image> <!--Credit d4ph1l -->
			<Image name="flag=Info" condition="is">C:\Program Files (x86)\Sophos\AutoUpdate\ALsvc.exe</Image> <!--Credit d4ph1l -->
			<Image name="flag=Info" condition="is">C:\Program Files (x86)\Sophos\Sophos Anti-Virus\SAVAdminService.exe</Image> <!--Credit d4ph1l -->
			<Image name="flag=Info" condition="is">C:\Program Files (x86)\Sophos\Remote Management System\ManagementAgentNT.exe</Image> <!--Credit d4ph1l -->
			<!--Splunk-->
			<Image name="flag=Info" condition="begin with">C:\Program Files\Splunk\bin\</Image> <!--Splunk child processes-->
 			<ParentImage name="flag=Info" condition="is">C:\Program Files\Splunk\bin\splunkd.exe</ParentImage> <!--Splunk:Daemon-->
			<ParentImage name="flag=Info" condition="is">C:\Program Files\Splunk\bin\splunk.exe</ParentImage> <!--Splunk:Daemon-->
 			<Image name="flag=Info" condition="begin with">D:\Program Files\Splunk\bin\</Image> <!--Splunk child processes-->
 			<ParentImage name="flag=Info" condition="is">D:\Program Files\Splunk\bin\splunkd.exe</ParentImage> <!--Splunk:Daemon-->
			<ParentImage name="flag=Info" condition="is">D:\Program Files\Splunk\bin\splunk.exe</ParentImage> <!--Splunk:Daemon-->
			<!--Splunk universal forwarder-->
			<Image name="flag=Info" condition="begin with">C:\Program Files\SplunkUniversalForwarder\bin\</Image> <!--Splunk:UniversalForwarder child processes-->
 			<ParentImage name="flag=Info" condition="is">C:\Program Files\SplunkUniversalForwarder\bin\splunkd.exe</ParentImage> <!--Splunk:UniversalForwarder:Daemon-->
      		<ParentImage name="flag=Info" condition="is">C:\Program Files\SplunkUniversalForwarder\bin\splunk.exe</ParentImage> <!--Splunk:UniversalForwarder:Launcher-->
 			<Image name="flag=Info" condition="begin with">D:\Program Files\SplunkUniversalForwarder\bin\</Image> <!--Splunk:UniversalForwarder child processes-->
 			<ParentImage name="flag=Info" condition="is">D:\Program Files\SplunkUniversalForwarder\bin\splunkd.exe</ParentImage> <!--Splunk:UniversalForwarder:Daemon-->
      		<ParentImage name="flag=Info" condition="is">D:\Program Files\SplunkUniversalForwarder\bin\splunk.exe</ParentImage> <!--Splunk:UniversalForwarder:Launcher-->	      
			<!--Trend Micro-->
			<Image name="flag=Info" condition="is">C:\Program Files\Trend Micro\Deep Security Agent\ds_monitor.exe</Image> <!--Credit pdoconnell -->
			<Image name="flag=Info" condition="is">C:\Program Files\Trend Micro\Deep Security Agent\dsa.exe</Image> <!--Credit pdoconnell -->
			<Image name="flag=Info" condition="is">C:\Program Files\Trend Micro\Deep Security Agent\dsuam.exe</Image> <!--Credit pdoconnell -->
			<Image name="flag=Info" condition="is">C:\Program Files\Trend Micro\Deep Security Agent\Notifier.exe</Image> <!--Credit pdoconnell -->
			<Image name="flag=Info" condition="is">C:\Program Files\Trend Micro\Deep Security Agent\lib\Patch.exe</Image> <!--Credit pdoconnell -->
			<Image name="flag=Info" condition="is">C:\Program Files (x86)\Trend Micro\BM\TMBMSRV.exe</Image> <!--Credit d4ph1l -->
			<Image name="flag=Info" condition="is">C:\Program Files (x86)\Trend Micro\OfficeScan Client\TmopExtIns32.exe</Image> <!--Credit d4ph1l -->
			<Image name="flag=Info" condition="is">C:\Program Files (x86)\Trend Micro\OfficeScan Client\TmExtIns.exe</Image> <!--Credit d4ph1l -->
			<Image name="flag=Info" condition="is">C:\Program Files (x86)\Trend Micro\OfficeScan Client\TmListen.exe</Image> <!--Credit d4ph1l -->
			<!--Windows Defender-->
			<Image name="flag=Info" condition="begin with">C:\Program Files\Windows Defender\</Image> <!--Microsoft:Windows:Defender in Win10-->
  			<Image name="flag=Info" condition="is">C:\Windows\system32\MpSigStub.exe</Image> <!--Microsoft:Windows: Microsoft Malware Protection Signature Update Stub-->
  			<Image name="flag=Info" condition="begin with">C:\Windows\SoftwareDistribution\Download\Install\AM_</Image> <!--Microsoft:Defender: Signature updates-->
        	<Image name="flag=Info" condition="is">C:\Program Files\Microsoft Security Client\MpCmdRun.exe</Image>
			<!--SECTION: Generic Microsoft Windows Processes-->
			<CommandLine name="flag=Info" condition="begin with">C:\Windows\system32\DllHost.exe /Processid</CommandLine> <!--Microsoft:Windows-->
			<CommandLine name="flag=Info" condition="is">C:\Windows\system32\SearchIndexer.exe /Embedding</CommandLine> <!--Microsoft:Windows: Search Indexer-->
			<Image name="flag=Info" condition="end with">C:\Windows\System32\CompatTelRunner.exe</Image> <!--Microsoft:Windows:Customer Experience Improvement-->
			<Image name="flag=Info" condition="is">C:\Windows\System32\MusNotification.exe</Image> <!--Microsoft:Windows: Update popups-->
			<Image name="flag=Info" condition="is">C:\Windows\System32\MusNotificationUx.exe</Image> <!--Microsoft:Windows: Update popups-->
			<Image name="flag=Info" condition="is">C:\Windows\System32\audiodg.exe</Image> <!--Microsoft:Windows: Launched constantly-->
			<Image name="flag=Info" condition="is">C:\Windows\System32\conhost.exe</Image> <!--Microsoft:Windows: Command line interface host process-->
			<Image name="flag=Info" condition="is">C:\Windows\System32\powercfg.exe</Image> <!--Microsoft:Power configuration management-->
			<Image name="flag=Info" condition="is">C:\Windows\System32\wbem\WmiApSrv.exe</Image> <!--Microsoft:Windows: WMI performance adpater host process-->
			<Image name="flag=Info" condition="is">C:\Windows\System32\wermgr.exe</Image> <!--Microsoft:Windows:Windows error reporting/telemetry-->
			<Image name="flag=Info" condition="is">C:\Windows\SysWOW64\wermgr.exe</Image> <!--Microsoft:Windows:Windows error reporting/telemetry-->
			<Image name="flag=Info" condition="is">C:\Windows\system32\sppsvc.exe</Image> <!--Microsoft:Windows: Software Protection Service-->
			<IntegrityLevel name="flag=Info" condition="is">AppContainer</IntegrityLevel> <!--Microsoft:Windows: Don't care about sandboxed processes-->
			<ParentCommandLine name="flag=Info" condition="begin with">%%SystemRoot%%\system32\csrss.exe ObjectDirectory=\Windows</ParentCommandLine> <!--Microsoft:Windows:CommandShell: Triggered when programs use the command shell, but without attribution-->
			<ParentImage name="flag=Info" condition="is">C:\Windows\system32\SearchIndexer.exe</ParentImage> <!--Microsoft:Windows:Search: Launches many uninteresting sub-processes-->
		</ProcessCreate>
	</RuleGroup>
	
	<!--SYSMON EVENT ID 2 : FILE CREATION TIME RETROACTIVELY CHANGED IN THE FILESYSTEM [FileCreateTime]-->
		<!--COMMENT:	[ https://attack.mitre.org/wiki/Technique/T1099 ] -->

		<!--DATA: UtcTime, ProcessGuid, ProcessId, Image, TargetFilename, CreationUtcTime, PreviousCreationUtcTime-->
	<RuleGroup name="" groupRelation="or">
		<FileCreateTime onmatch="include">
			<Image name="flag=Info,technique_id=T1099,technique_name=Timestomp" condition="begin with">C:\Users</Image> <!--Look for timestomping in user area, usually nothing should be doing that here-->
			<TargetFilename name="flag=Info,technique_id=T1099,technique_name=Timestomp" condition="end with">.exe</TargetFilename> <!--Look for backdated executables anywhere-->
			<Image name="flag=Red,technique_id=T1099,technique_name=Timestomp" condition="begin with">\Device\HarddiskVolumeShadowCopy</Image> <!--Nothing should be written here | Credit: @SBousseaden [ https://twitter.com/SBousseaden/status/1133030955407630336 ] -->
			<!--Temp Folder-->
			<Image name="flag=Amber,technique_id=T1099,technique_name=Timestomp" condition="begin with">C:\Temp</Image><!--Look for timestomping in temp folders-->
      		<Image name="flag=Info,technique_id=T1099,technique_name=Timestomp" condition="begin with">C:\Windows\Temp</Image>
      		<Image name="flag=Info,technique_id=T1099,technique_name=Timestomp" condition="begin with">C:\Tmp</Image>
			<!--Users Folder-->
			<Image name="flag=Amber,technique_id=T1099,technique_name=Timestomp" condition="begin with">C:\Users</Image><!--Look for timestomping in user area-->		
		
			<!--Nothing from Olaf-->
		</FileCreateTime>
	</RuleGroup>

	<RuleGroup name="" groupRelation="or">
		<FileCreateTime onmatch="exclude">

			<Image name="flag=Info" condition="end with">slack.exe</Image> <!--slack constantly changes files-->   
			<Image name="flag=Info" condition="end with">AppData\Local\Microsoft\Teams\current\Teams.exe</Image> <!--Teams constantly changes files--> 

			<Image name="flag=Info" condition="image">OneDrive.exe</Image> <!--OneDrive constantly changes file times-->
			<Image name="flag=Info" condition="image">C:\Windows\system32\backgroundTaskHost.exe</Image>
			<Image name="flag=Info" condition="contains">setup</Image> <!--Ignore setups-->
			<Image name="flag=Info" condition="contains">install</Image> <!--Ignore setups-->
			<Image name="flag=Info" condition="contains">Update\</Image> <!--Ignore setups-->
			<Image name="flag=Info" condition="end with">redist.exe</Image> <!--Ignore setups-->
			<Image name="flag=Info" condition="is">msiexec.exe</Image> <!--Ignore setups-->
			<Image name="flag=Info" condition="is">TrustedInstaller.exe</Image> <!--Ignore setups-->

			<!--Above is default, below is added from Olaf-->
			<Image name="flag=Info" condition="end with">AppData\Local\Microsoft\Teams\current\Teams.exe</Image> <!--Teams constantly changes files--> 
			<!--Google Chrome-->
			<Image name="flag=Info" condition="end with">AppData\Local\Google\Chrome\Application\chrome.exe</Image> <!--chrome constantly changes files-->
			<Image name="flag=Info" condition="end with">Root\VFS\ProgramFilesX86\Google\Chrome\Application\chrome.exe</Image> <!--chrome constantly changes files-->      
			<!--One Drive-->
	  		<Image name="flag=Info" condition="image">OneDrive.exe</Image> <!--OneDrive constantly changes file times-->
			<!--Setups-->
			<Image name="flag=Info" condition="contains">setup</Image> <!--Ignore setups-->
	  
		</FileCreateTime>
	</RuleGroup>

	<!--SYSMON EVENT ID 3 : NETWORK CONNECTION INITIATED [NetworkConnect]-->
		<!--COMMENT:	By default this configuration takes a very conservative approach to network logging, limited to only extremely high-signal events.-->
		<!--COMMENT:	[ https://attack.mitre.org/wiki/Command_and_Control ] [ https://attack.mitre.org/wiki/Exfiltration ] [ https://attack.mitre.org/wiki/Lateral_Movement ] -->
		<!--TECHNICAL:	For the DestinationHostname, Sysmon uses the GetNameInfo API, which will often not have any information, and may just be a CDN. This is NOT reliable for filtering.-->
		<!--TECHNICAL:	For the DestinationPortName, Sysmon uses the GetNameInfo API for the friendly name of ports you see in logs.-->
		<!--TECHNICAL:	These exe do not initiate their connections, and thus includes do not work in this section: BITSADMIN NLTEST-->
		
		<!-- https://www.first.org/resources/papers/conf2017/APT-Log-Analysis-Tracking-Attack-Tools-by-Audit-Policy-and-Sysmon.pdf -->

		<!--DATA: UtcTime, ProcessGuid, ProcessId, Image, User, Protocol, Initiated, SourceIsIpv6, SourceIp, SourceHostname, SourcePort, SourcePortName, DestinationIsIpV6, DestinationIp, DestinationHostname, DestinationPort, DestinationPortName-->
	<RuleGroup name="" groupRelation="or">
		<NetworkConnect onmatch="include">
			<Image name="flag=Red,technique_id=T1021,technique_name=PS Remote Management" condition="image">wsmprovhost.exe</Image> <!-- Datc - suspicious remote powershell remoting -->
			<!--Suspicious sources for network-connecting binaries-->
			<Image name="flag=Info,Usermode" condition="begin with">C:\Users</Image> <!--Tools downloaded by users can use other processes for networking, but this is a very valuable indicator.-->
			<Image name="flag=Red,Caution" condition="begin with">C:\Recycle</Image> <!--Nothing should operate from the RecycleBin locations.-->
			<Image name="flag=Amber" condition="begin with">C:\ProgramData</Image> <!--Normally, network communications should be sourced from "Program Files" not from ProgramData, something to look at-->
			<Image name="flag=Amber" condition="begin with">C:\Windows\Temp</Image> <!--Suspicious anything would communicate from the system-level temp directory-->
			<Image name="flag=Red,Caution" condition="begin with">\</Image> <!--Devices and VSC shouldn't be executing changes | Credit: @SBousseaden @ionstorm @neu5ron @PerchedSystems [ https://twitter.com/SwiftOnSecurity/status/1133167323991486464 ] -->
			<Image name="flag=Amber,Caution" condition="begin with">C:\perflogs</Image> <!-- Credit @blu3_team [ https://blu3-team.blogspot.com/2019/05/netconn-from-suspicious-directories.html ] -->
			<Image name="flag=Info,Caution" condition="begin with">C:\intel</Image> <!-- Credit @blu3_team [ https://blu3-team.blogspot.com/2019/05/netconn-from-suspicious-directories.html ] -->
			<Image name="flag=Amber,Caution" condition="begin with">C:\Windows\fonts</Image> <!-- Credit @blu3_team [ https://blu3-team.blogspot.com/2019/05/netconn-from-suspicious-directories.html ] -->
			<Image name="flag=Info,Caution" condition="begin with">C:\Windows\system32\config</Image> <!-- Credit @blu3_team [ https://blu3-team.blogspot.com/2019/05/netconn-from-suspicious-directories.html ] -->
			<!--Suspicious Windows tools-->
			<Image name="flag=Amber" condition="image">at.exe</Image> <!--Windows: Remote task scheduling, removed in Win10 | Credit @ion-storm -->
			<Image name="flag=Amber" condition="image">certutil.exe</Image> <!--Windows: Certificate tool can contact outbound | Credit @ion-storm @FVT [ https://twitter.com/FVT/status/834433734602530817 ] -->
			<Image name="flag=Amber" condition="image">cmd.exe</Image> <!--Windows: Remote command prompt-->
			<Image name="flag=Info" condition="image">cmstp.exe</Image> <!--Windows: Connection manager profiles can launch executables from WebDAV [ https://twitter.com/NickTyrer/status/958450014111633408 ] | Credit @NickTyrer @Oddvarmoe @KyleHanslovan @subTee -->
			<Image name="flag=Amber" condition="image">cscript.exe</Image> <!--WindowsScriptingHost: | Credit @Cyb3rOps [ https://gist.github.com/Neo23x0/a4b4af9481e01e749409 ] -->
			<Image name="flag=Amber,technique_id=T1069,technique_name=Permission Groups Discovery" condition="image">dsquery.exe</Image> <!--Microsoft: Query Active Directory -->
			<Image name="flag=Info, technique_id=T1069,technique_name=Permission Groups Discovery" condition="image">AdFind.exe</Image>
			<Image name="flag=Info" condition="image">hh.exe</Image> <!--Windows: HTML Help Executable, opens CHM files -->
			<Image name="flag=Info" condition="image">infDefaultInstall.exe</Image> <!--Microsoft: [ https://github.com/huntresslabs/evading-autoruns ] | Credit @KyleHanslovan -->
			<Image name="flag=Info" condition="image">java.exe</Image> <!--Java: Monitor usage of vulnerable application and init from JAR files | Credit @ion-storm -->
			<Image name="flag=Info" condition="image">javaw.exe</Image> <!--Java: Monitor usage of vulnerable application and init from JAR files -->
			<Image name="flag=Amber" condition="image">javaws.exe</Image> <!--Java: Monitor usage of vulnerable application and init from JAR files -->
			<Image name="flag=Amber" condition="image">mmc.exe</Image> <!--Windows: -->
			<Image name="flag=Amber" condition="image">msbuild.exe</Image> <!--Windows: [ https://www.hybrid-analysis.com/sample/a314f6106633fba4b70f9d6ddbee452e8f8f44a72117749c21243dc93c7ed3ac?environmentId=100 ] -->
			<Image name="flag=Amber" condition="image">mshta.exe</Image> <!--Windows: HTML application executes scripts without IE protections | Credit @ion-storm [ https://en.wikipedia.org/wiki/HTML_Application ] -->
			<Image name="flag=Info" condition="image">msiexec.exe</Image> <!--Windows: Can install from http:// paths | Credit @vector-sec -->
			<Image name="flag=Info" condition="image">nbtstat.exe</Image> <!--Windows: NetBIOS statistics, attackers use to enumerate local network -->
			<Image name="flag=Info" condition="image">net.exe</Image> <!--Windows: Note - May not detect anything, net.exe is a front-end to lower APIs | Credit @ion-storm -->
			<Image name="flag=Amber" condition="image">net1.exe</Image> <!--Windows: Launched by "net.exe", but it may not detect connections either -->
			<Image name="flag=Info" condition="image">notepad.exe</Image> <!--Windows: [ https://secrary.com/ReversingMalware/CoinMiner/ ] [ https://blog.cobaltstrike.com/2013/08/08/why-is-notepad-exe-connecting-to-the-internet/ ] -->
			<Image name="flag=Info" condition="image">nslookup.exe</Image> <!--Windows: Retrieve data over DNS -->
			<Image name="flag=Red" condition="image">powershell.exe</Image> <!--Windows: PowerShell interface-->
			<Image name="flag=Red" condition="image">qprocess.exe</Image> <!--Windows: [ https://www.first.org/resources/papers/conf2017/APT-Log-Analysis-Tracking-Attack-Tools-by-Audit-Policy-and-Sysmon.pdf ] -->
			<Image name="flag=Red" condition="image">qwinsta.exe</Image> <!--Windows: Query remote sessions | Credit @ion-storm -->
			<Image name="flag=Info" condition="image">qwinsta.exe</Image> <!--Windows: Remotely query login sessions on a server or workstation | Credit @ion-storm -->
			<Image name="flag=Info" condition="image">reg.exe</Image> <!--Windows: Remote Registry editing ability | Credit @ion-storm -->
			<Image name="flag=Info" condition="image">regsvcs.exe</Image> <!--Windows: [ https://www.hybrid-analysis.com/sample/3f94d7080e6c5b8f59eeecc3d44f7e817b31562caeba21d02ad705a0bfc63d67?environmentId=100 ] -->
			<Image name="flag=Info" condition="image">regsvr32.exe</Image> <!--Windows: [ https://subt0x10.blogspot.com/2016/04/bypass-application-whitelisting-script.html ] -->
			<Image name="flag=Red" condition="image">rundll32.exe</Image> <!--Windows: [ https://blog.cobaltstrike.com/2016/07/22/why-is-rundll32-exe-connecting-to-the-internet/ ] -->
			<Image name="flag=Red" condition="image">rwinsta.exe</Image> <!--Windows: Disconnect remote sessions | Credit @ion-storm -->
			<Image name="flag=Info" condition="image">sc.exe</Image> <!--Windows: Remotely change Windows service settings | Credit @ion-storm -->
			<Image name="flag=Info" condition="image">schtasks.exe</Image> <!--Windows: Command-line interface to local and remote tasks -->
			<Image name="flag=Red" condition="image">taskkill.exe</Image> <!--Windows: Kill processes, has remote ability -->
			<Image name="flag=Info" condition="image">tasklist.exe</Image> <!--Windows: List processes, has remote ability -->
			<Image name="flag=Red" condition="image">wmic.exe</Image> <!--WindowsManagementInstrumentation: Credit @Cyb3rOps [ https://gist.github.com/Neo23x0/a4b4af9481e01e749409 ] -->
			<Image name="flag=Amber" condition="image">wscript.exe</Image> <!--WindowsScriptingHost: | Credit @arekfurt -->
			<!--Relevant 3rd Party Tools-->
			<Image name="flag=Red" condition="image">nc.exe</Image> <!-- Nmap's modern version of netcat [ https://nmap.org/ncat/guide/index.html#ncat-overview ] [ https://securityblog.gr/1517/create-backdoor-in-windows-with-ncat/ ] -->
			<Image name="flag=Red" condition="image">ncat.exe</Image> <!-- Nmap's modern version of netcat [ https://nmap.org/ncat/guide/index.html#ncat-overview ] [ https://securityblog.gr/1517/create-backdoor-in-windows-with-ncat/ ] -->
			<Image name="flag=Amber" condition="image">psexec.exe</Image> <!--Sysinternals:PsExec client side | Credit @Cyb3rOps -->
			<Image name="flag=Amber" condition="image">psexesvc.exe</Image> <!--Sysinternals:PsExec server side | Credit @Cyb3rOps -->
			<Image name="flag=Red" condition="image">tor.exe</Image> <!--Tor [ https://www.hybrid-analysis.com/sample/800bf028a23440134fc834efc5c1e02cc70f05b2e800bbc285d7c92a4b126b1c?environmentId=100 ] -->
			<Image name="flag=Red" condition="image">vnc.exe</Image> <!-- VNC client | Credit @Cyb3rOps -->
			<Image name="flag=Red" condition="image">vncservice.exe</Image> <!-- VNC server | Credit @Cyb3rOps -->
			<Image name="flag=Red" condition="image">vncviewer.exe</Image> <!-- VNC client | Credit @Cyb3rOps -->
			<Image name="flag=Amber" condition="image">winexesvc.exe</Image> <!-- Winexe service executable | Credit @Cyb3rOps -->
			<Image name="flag=Amber" condition="image">nmap.exe</Image>
			<Image name="flag=Amber" condition="image">psinfo.exe</Image>
			<!--Ports: Suspicious-->
			<!--Eventhough DNS is a commmon exfil channel, you should monitor that via some other way, Sysmon is not ideal for that-->
			<DestinationPort name="flag=Info,technique_id=T1021,technique_name=Remote Services" condition="is">22</DestinationPort> <!--SSH protocol-->
			<DestinationPort name="flag=Info,technique_id=T1021,technique_name=Remote Services" condition="is">23</DestinationPort> <!--Telnet protocol-->
			<DestinationPort name="flag=Info,technique_id=T1043,technique_name=Commonly Used Port" condition="is">25</DestinationPort> <!--SMTP mail protocol-->
			<DestinationPort name="flag=Info,IMAP" condition="is">143</DestinationPort> <!--IMAP mail protocol port, insecure, used by threats-->
			<DestinationPort name="flag=Red,technique_id=T1021,technique_name=Remote Services" condition="is">3389</DestinationPort> <!--Microsoft:Windows:RDP-->
			<DestinationPort name="flag=Red,technique_id=T1021,technique_name=Remote Services" condition="is">5800</DestinationPort> <!--VNC protocol-->
			<DestinationPort name="flag=Red,technique_id=T1021,technique_name=Remote Services" condition="is">5900</DestinationPort> <!--VNC protocol-->
			<DestinationPort name="flag=Red,Alert,Metasploit" condition="is">444</DestinationPort>
			<DestinationPort name="flag=Info,AllPorts" condition="begin with">1024</DestinationPort>
			<DestinationPort name="flag=Info,AllPorts" condition="end with">65535</DestinationPort>
			<!--Ports: Proxy-->
			<DestinationPort name="flag=Info,technique_id=T1043,technique_name=Commonly Used Port" condition="is">1080</DestinationPort> <!--Socks proxy port | Credit @ion-storm-->
			<DestinationPort name="flag=Info,technique_id=T1043,technique_name=Commonly Used Port" condition="is">3128</DestinationPort> <!--Socks proxy port | Credit @ion-storm-->
			<DestinationPort name="flag=Info,technique_id=T1043,technique_name=Commonly Used Port" condition="is">8080</DestinationPort><!--Socks proxy port | Credit @ion-storm-->
			<!--TOR - Frequently used by malware-->
			<Image name="flag=Red" condition="image">tor.exe</Image> <!--Tor [ https://www.hybrid-analysis.com/sample/800bf028a23440134fc834efc5c1e02cc70f05b2e800bbc285d7c92a4b126b1c?environmentId=100 ] -->
			<!--Ports: Tor-->
			<DestinationPort name="flag=Red,technique_id=T1043,technique_name=Commonly Used Port" condition="is">1723</DestinationPort> <!--Tor protocol | Credit @ion-storm-->
			<DestinationPort name="flag=Red,technique_id=T1043,technique_name=Commonly Used Port" condition="is">4500</DestinationPort> <!--Tor protocol | Credit @ion-storm-->
			<DestinationPort name="flag=Red,technique_id=T1043,technique_name=Commonly Used Port" condition="is">9001</DestinationPort> <!--Tor protocol [ http://www.computerworlduk.com/tutorial/security/tor-enterprise-2016-blocking-malware-darknet-use-rogue-nodes-3633907/ ] -->
			<DestinationPort name="flag=Red,technique_id=T1043,technique_name=Commonly Used Port" condition="is">9030</DestinationPort> <!--Tor protocol [ http://www.computerworlduk.com/tutorial/security/tor-enterprise-2016-blocking-malware-darknet-use-rogue-nodes-3633907/ ] -->			
	  
			<!--Added from Olaf-->
			<!--3rd Party Remote Management tools-->
			<Image name="flag=Info,technique_id=T1021,technique_name=Remote Services" condition="image">vnc.exe</Image> <!-- VNC client | Credit @Cyb3rOps -->
			<Image name="flag=Info,technique_id=T1021,technique_name=Remote Services" condition="image">vncviewer.exe</Image> <!-- VNC client | Credit @Cyb3rOps -->
			<Image name="flag=Info,technique_id=T1021,technique_name=Remote Services" condition="image">vncservice.exe</Image> <!-- VNC server | Credit @Cyb3rOps -->
			<Image name="flag=Info,technique_id=T1569.002,technique_name=Service Execution" condition="image">winexesvc.exe</Image> <!-- Winexe service executable | Credit @Cyb3rOps -->
	  		<!--Bitsadmin-->
			<Image name="flag=Red,technique_id=T1197,technique_name=BITS Jobs" condition="image">bitsadmin.exe</Image>
			<!--Critical HP services-->
			<Image name="flag=Amber,technique_id=T1021,technique_name=Remote Services" condition="image">omniinet.exe</Image> <!-- HP Data Protector https://www.cvedetails.com/vulnerability-list/vendor_id-10/product_id-20499/HP-Data-Protector.html | Credit @Cyb3rOps -->
			<Image name="flag=Amber,technique_id=T1021,technique_name=Remote Services" condition="image">hpsmhd.exe</Image> <!-- HP System Management Homepage https://www.cvedetails.com/vulnerability-list/vendor_id-10/product_id-7244/HP-System-Management-Homepage.html | Credit @Cyb3rOps -->
	  		<!--Native Windows tools - Living off the land-->
			<Image name="flag=Info,technique_id=T1016,technique_name=System Network Configuration Discovery" condition="image">ipconfig.exe</Image><!--Microsoft:Windows: shows ip configuration -->
			<Image name="flag=Info,technique_id=T1057,technique_name=Process Discovery" condition="image">tasklist.exe</Image> <!--Mitre T1057--><!--Mitre T1007--><!--Microsoft:Windows: shows current running processes-->
			<Image name="flag=Info,technique_id=T1049,technique_name=System Network Connections Discovery" condition="image">netstat.exe</Image> <!--Mitre T1016--><!--Mitre T1049--><!--Microsoft:Windows: shows protocol statistics and current TCP/IP network connections -->
			<Image name="flag=Info,technique_id=T1057,technique_name=Process Discovery" condition="image">qprocess.exe</Image> <!--Microsoft:Windows: shows information about processes -->
      		<Image name="flag=Info,technique_id=T1016,technique_name=System Network Configuration Discovery" condition="image">nslookup.exe</Image><!--Microsoft:Windows: shows DNS configuration and enables quering -->
      		<Image name="flag=Info,technique_id=T1018,technique_name=Remote System Discovery" condition="image">net.exe</Image> <!--Mitre T1201--><!--Mitre T1007--><!--Mitre T1124--><!--Mitre T1018--><!--Mitre T1049--><!--Mitre T1087--><!--Mitre T1135--><!--Mitre T1069--><!--Mitre T1016--><!--Mitre T1021.002--><!--Microsoft:Windows: "net use"/"net view" used by attackers to surveil and connect with file shares from command line | Credit @ion-storm -->
			<Image name="flag=Info,technique_id=T1033,technique_name=System Owner/User Discovery" condition="image">quser.exe</Image> <!--Microsoft:Windows: shows logged-on users -->
			<Image name="flag=Info,technique_id=T1057,technique_name=Process Discovery" condition="image">query.exe</Image> <!--Microsoft:Windows: shows information about processes -->
			<Image name="flag=Red,technique_id=T1134,technique_name=Access Token Manipulation" condition="image">runas.exe</Image> <!--Microsoft:Windows: run a process as another user -->
			<Image name="flag=Amber,technique_id=T1112,technique_name=Modify Registry" condition="image">reg.exe</Image> <!--Mitre T1552.002--><!--Mitre T1012--><!--Mitre T1112--><!--Microsoft:Windows: reads and modifies the Windows register -->
			<Image name="flag=Red,technique_id=T1518.001,technique_name=Security Software Discovery" condition="image">netsh.exe</Image> <!--Mitre T1016--><!--Mitre T1546.007--><!--Mitre T1518.001--><!--Microsoft:Windows: manipulate the firewall -->
			<Image name="flag=Red" condition="image">klist.exe</Image> <!--Microsoft:Windows: show cached kerberos tickets -->
			<Image name="flag=Info,technique_id=T1070,technique_name=Indicator Removal on Host" condition="image">wevtutil.exe</Image><!--Microsoft:Windows: read and modify the Windows Eventlog -->
      		<Image name="flag=Info,technique_id=T1053,technique_name=Scheduled Task/Job" condition="image">taskeng.exe</Image><!--Microsoft:Windows: taskscheduler -->
			<Image name="flag=Amber,technique_id=T1218.010,technique_name=Regsvr32" condition="image">regsvr32.exe</Image> <!--Mitre T1218.010--><!--Mitre T1218.011--><!--Microsoft:Windows: [ https://subt0x10.blogspot.com/2016/04/bypass-application-whitelisting-script.html ] -->
			<Image name="flag=Amber" condition="image">hh.exe</Image> <!--Microsoft:Windows: HTML Helper-->
			<Image name="flag=Amber,technique_id=T1059.003,technique_name=Windows Command Shell" condition="image">cmd.exe</Image><!--Microsoft:Windows: Command prompt-->
			<Image name="flag=Red,technique_id=T1059.001,technique_name=PowerShell" condition="image">powershell.exe</Image><!--Microsoft:Windows: PowerShell interface-->
			<Image name="flag=Info,technique_id=T1202,technique_name=Indirect Command Execution" condition="image">bash.exe</Image><!--Microsoft:Windows: bash on Windows, Linux subsystem-->
			<Image name="flag=Info,technique_id=T1202,technique_name=Indirect Command Execution" condition="image">pcalua.exe</Image><!--Microsoft:Windows: Program Compatibility Assistant)-->
			<Image name="flag=Amber,technique_id=T1202,technique_name=Indirect Command Execution" condition="image">cscript.exe</Image>
			<Image name="flag=Info,technique_id=T1202,technique_name=Indirect Command Execution" condition="image">wscript.exe</Image>
			<Image name="flag=Info,technique_id=T1218.005,technique_name=Mshta" condition="image">mshta.exe</Image>
			<Image name="flag=Info,technique_id=T1016,technique_name=System Network Configuration Discovery" condition="image">nbtstat.exe</Image> <!--Microsoft:Windows: NetBIOS statistics, attackers use to enumerate local network -->
			<Image name="flag=Amber,technique_id=T1069,technique_name=Permission Groups Discovery" condition="image">net1.exe</Image> <!--Mitre T1018--><!--Mitre T1021.002--><!--Mitre T1087--><!--Mitre T1135--><!--Mitre T1069--><!--Mitre T1016--><!--Microsoft:Windows: Launched by "net.exe", but it may not detect connections either -->
			<Image name="flag=Info,technique_id=T1018,technique_name=Remote System Discovery" condition="image">nslookup.exe</Image> <!--Microsoft:Windows: Retrieve data over DNS -->
			<Image name="flag=Amber,technique_id=T1057,technique_name=Process Discovery" condition="image">qwinsta.exe</Image> <!--Microsoft:Windows: Remotely query login sessions on a server or workstation | Credit @ion-storm -->
			<Image name="flag=Red,technique_id=T1057,technique_name=Process Discovery" condition="image">rwinsta.exe</Image> <!--Microsoft:Windows: Disconnect remote sessions | Credit @ion-storm -->
			<Image name="flag=Red" condition="image">schtasks.exe</Image> <!--Microsoft:Windows: Command and Scripting Interpreter to local and remote tasks -->
			<Image name="flag=Info" condition="image">taskkill.exe</Image> <!--Microsoft:Windows: Kill processes, has remote ability -->
			<Image name="flag=Amber,technique_id=T1543.003,technique_name=Windows Service" condition="image">sc.exe</Image>
			<Image name="flag=Info,technique_id=T1033,technique_name=System Owner/User Discovery" condition="image">nltest.exe</Image><!-- netlogon testing utility-->
			<Image name="flag=Info,technique_id=T1202,technique_name=Indirect Command Execution" condition="image">winrs.exe</Image>
			<Image name="flag=Info,technique_id=T1127,technique_name=Trusted Developer Utilities Proxy Execution" condition="image">dfsvc.exe</Image><!--https://lolbas-project.github.io/lolbas/Binaries/Dfsvc/-->
			<Image name="flag=Red,technique_id=T1569.002,technique_name=Service Execution" condition="image">dnscmd.exe</Image><!--Service Execution-->
			<Image name="flag=Amber,technique_id=T1096,technique_name=NTFS File Attributes" condition="image">esentutl.exe</Image><!--https://lolbas-project.github.io/lolbas/Binaries/Esentutl/ Multiple options-->
			<Image name="flag=Info,technique_id=T1105,technique_name=Ingress Tool Transfer" condition="image">expand.exe</Image>
			<Image name="flag=Amber,technique_id=T1105,technique_name=Ingress Tool Transfer" condition="image">extrac32.exe</Image>
			<Image name="flag=Info,technique_id=T1105,technique_name=Ingress Tool Transfer" condition="image">IEExec.exe</Image>
			<Image name="flag=Info,technique_id=T1218,technique_name=Signed Binary Proxy Execution" condition="image">Msdt.exe</Image><!--https://lolbas-project.github.io/lolbas/Binaries/Msdt/-->
			<Image name="flag=Info,technique_id=T1218,technique_name=Signed Binary Proxy Execution" condition="image">msiexec.exe</Image>
			<Image name="flag=Info,technique_id=T1105,technique_name=Ingress Tool Transfer" condition="image">Print.Exe</Image>
			<Image name="flag=Info,technique_id=T1218,technique_name=Signed Binary Proxy Execution" condition="image">RegisterCimProvider.exe</Image>
			<Image name="flag=Amber,technique_id=T1003,technique_name=Credential Dumping" condition="image">RpcPing.exe</Image><!--https://lolbas-project.github.io/lolbas/Binaries/Rpcping/-->
			<Image name="flag=Amber,technique_id=T1218,technique_name=Signed Binary Proxy Execution" condition="image">ScriptRunner.exe</Image>
			<Image name="flag=Amber,technique_id=T1548.002,technique_name=Bypass User Access Control" condition="image">xwizard.exe</Image><!--https://bohops.com/2018/08/18/abusing-the-com-registry-structure-part-2-loading-techniques-for-evasion-and-persistence/ -->
			<Image name="flag=Info,technique_id=T1202,technique_name=Indirect Command Execution" condition="image">desktopimgdownldr.exe</Image><!--https://labs.sentinelone.com/living-off-windows-land-a-new-native-file-downldr/-->
			<Image name="flag=Info,technique_id=T1059.001,technique_name=PowerShell" condition="image">OpenConsole.exe</Image>
        	<Image name="flag=Info,technique_id=T1059.001,technique_name=PowerShell" condition="image">WindowsTerminal.exe</Image>
			<!--Mavinject-->
			<Image name="flag=Red,technique_id=T1218,technique_name=Signed Binary Proxy Execution" condition="image">Mavinject.exe</Image>
			<!--Native Windows tools - Living off the land-->
			<Image name="flag=Info,technique_id=T1053,technique_name=Scheduled Task" condition="image">at.exe</Image> <!--Microsoft:Windows: Remote task scheduling | Credit @ion-storm -->
			<Image name="flag=Amber,technique_id=T1218,technique_name=Signed Binary Proxy Execution" condition="image">certutil.exe</Image> <!--Microsoft:Windows: Certificate tool can contact outbound | Credit @ion-storm and @FVT [ https://twitter.com/FVT/status/834433734602530817 ] -->
			<Image name="flag=Amber" condition="image">cmd.exe</Image> <!--Microsoft:Windows: Command prompt-->
			<Image name="flag=Amber,technique_id=T1218,technique_name=Signed Script Proxy Execution" condition="image">cscript.exe</Image><!--Microsoft:WindowsScriptingHost: | Credit @Cyb3rOps [ https://gist.github.com/Neo23x0/a4b4af9481e01e749409 ] -->
			<Image name="flag=Amber" condition="image">java.exe</Image> <!--Java: Monitor usage of vulnerable application | Credit @ion-storm -->
			<Image name="flag=Info,technique_id=T1218.005,technique_name=Mshta" condition="image">mshta.exe</Image><!--Microsoft:Windows: HTML application executes scripts without IE protections | Credit @ion-storm [ https://en.wikipedia.org/wiki/HTML_Application ] -->
			<Image name="flag=Info,technique_id=T1218,technique_name=Signed Binary Proxy Execution" condition="image">msiexec.exe</Image> <!--Microsoft:Windows: Can install from http:// paths | Credit @vector-sec -->
			<Image name="flag=Amber,technique_id=T1069,technique_name=Permission Groups Discovery" condition="image">net.exe</Image> <!--Mitre T1018--><!--Mitre T1021.002--><!--Mitre T1087--><!--Mitre T1135--><!--Mitre T1069--><!--Mitre T1016--><!--Microsoft:Windows: "net use"/"net view" used by attackers to surveil and connect with file shares from command line | Credit @ion-storm -->
			<Image name="flag=Red,technique_id=T1218,technique_name=Signed Binary Proxy Execution" condition="image">notepad.exe</Image> <!--Microsoft:Windows: [ https://blog.cobaltstrike.com/2013/08/08/why-is-notepad-exe-connecting-to-the-internet/ ] -->
			<Image name="flag=Red,technique_id=T1218,technique_name=Signed Binary Proxy Execution" condition="image">powershell.exe</Image><!--Microsoft:Windows: PowerShell interface-->
			<Image name="flag=Info,technique_id=T1012,technique_name=Query Registry" condition="image">reg.exe</Image> <!--Mitre T1012--><!--Mitre T1112--><!--Microsoft:Windows: Remote Registry | Credit @ion-storm -->
			<Image name="flag=Info,technique_id=T1218,technique_name=Regsvr32" condition="image">regsvr32.exe</Image><!--Microsoft:Windows: [ https://subt0x10.blogspot.com/2016/04/bypass-application-whitelisting-script.html ] -->
			<Image name="flag=Red,technique_id=T1218.011,technique_name=Rundll32" condition="image">rundll32.exe</Image><!--Microsoft:Windows: [ https://blog.cobaltstrike.com/2016/07/22/why-is-rundll32-exe-connecting-to-the-internet/ ] -->
			<Image name="flag=Amber,technique_id=T1543.003,technique_name=Windows Service" condition="image">sc.exe</Image> <!--Microsoft:Windows: Remotely change Windows service settings from command line | Credit @ion-storm -->
			<Image name="flag=Amber,technique_id=T1047,technique_name=Windows Management Instrumentation" condition="image">wmic.exe</Image> <!--T1047--><!--Mitre T1135--><!--Microsoft:WindowsManagementInstrumentation: Credit @Cyb3rOps [ https://gist.github.com/Neo23x0/a4b4af9481e01e749409 ] -->
			<Image name="flag=Info,technique_id=T1218,technique_name=Signed Script Proxy Execution" condition="image">wscript.exe</Image> <!--Microsoft:WindowsScriptingHost: | Credit @arekfurt -->
      		<Image name="flag=Info" condition="image">driverquery.exe</Image> <!--Microsoft:Windows: Remote recognisance of system configuration, oudated/vulnerable drivers -->
			<Image name="flag=Info,technique_id=T1069,technique_name=Permission Groups Discovery" condition="image">dsquery.exe</Image>
       		<Image name="flag=Info,technique_id=T1069,technique_name=Permission Groups Discovery" condition="image">AdFind.exe</Image>
			<Image name="flag=Info" condition="image">hh.exe</Image> <!--Microsoft:Windows: HTML Help Executable, opens CHM files -->
			<Image name="flag=Info" condition="image">infDefaultInstall.exe</Image> <!--Microsoft: [ https://github.com/huntresslabs/evading-autoruns ] | Credit @KyleHanslovan -->
      		<Image name="flag=Info" condition="image">javaw.exe</Image> <!--Java: Monitor usage of vulnerable application and init from JAR files -->
			<Image name="flag=Info" condition="image">javaws.exe</Image> <!--Java: Monitor usage of vulnerable application and init from JAR files -->
			<Image name="flag=Amber,technique_id=T1543.003,technique_name=Windows Service" condition="image">mmc.exe</Image> <!--Microsoft:Windows: -->
			<Image name="flag=Amber,technique_id=T1218,technique_name=Signed Binary Proxy Execution" condition="image">msbuild.exe</Image><!--Microsoft:Windows: [ https://www.hybrid-analysis.com/sample/a314f6106633fba4b70f9d6ddbee452e8f8f44a72117749c21243dc93c7ed3ac?environmentId=100 ] -->
			<Image name="flag=Amber,technique_id=T1016,technique_name=System Network Configuration Discovery" condition="image">nbtstat.exe</Image> <!--Microsoft:Windows: NetBIOS statistics, attackers use to enumerate local network -->
			<Image name="flag=Info,technique_id=T1069,technique_name=Permission Groups Discovery" condition="image">net1.exe</Image> <!--Mitre T1018--><!--Mitre T1021.002--><!--Mitre T1087--><!--Mitre T1135--><!--Mitre T1069--><!--Mitre T1016--><!--Microsoft:Windows: Launched by "net.exe", but it may not detect connections either -->
			<Image name="flag=Info,technique_id=T1018,technique_name=Remote System Discovery" condition="image">nslookup.exe</Image> <!--Microsoft:Windows: Retrieve data over DNS -->
			<Image name="flag=Info,technique_id=T1057,technique_name=Process Discovery" condition="image">qprocess.exe</Image> <!--Microsoft:Windows: [ https://www.first.org/resources/papers/conf2017/APT-Log-Analysis-Tracking-Attack-Tools-by-Audit-Policy-and-Sysmon.pdf ] -->
			<Image name="flag=Amber,technique_id=T1057,technique_name=Process Discovery" condition="image">qwinsta.exe</Image> <!--Microsoft:Windows: Remotely query login sessions on a server or workstation | Credit @ion-storm -->
			<Image name="flag=Info,technique_id=T1218.009,technique_name=Regsvcs/Regasm" condition="image">regsvcs.exe</Image> <!--Microsoft:Windows: [ https://www.hybrid-analysis.com/sample/3f94d7080e6c5b8f59eeecc3d44f7e817b31562caeba21d02ad705a0bfc63d67?environmentId=100 ] -->
			<Image name="flag=Amber,technique_id=T1057,technique_name=Process Discovery" condition="image">rwinsta.exe</Image> <!--Microsoft:Windows: Disconnect remote sessions | Credit @ion-storm -->
			<Image name="flag=Info,technique_id=T1053,technique_name=Scheduled Task/Job" condition="image">schtasks.exe</Image> <!--Microsoft:Windows: Command and Scripting Interpreter to local and remote tasks -->
			<Image name="flag=Amber,technique_id=T1089,technique_name=Disabling Security Tools" condition="image">taskkill.exe</Image> <!--Microsoft:Windows: Kill processes, has remote ability -->
			<Image name="flag=Info,technique_id=T1057,technique_name=Process Discovery" condition="image">tasklist.exe</Image> <!--Microsoft:Windows: List processes, has remote ability -->
     		<Image name="flag=Red,technique_id=T1218,technique_name=Signed Binary Proxy Execution" condition="image">replace.exe</Image>
			<!--psecex-->
			<Image name="flag=Amber,technique_id=T1569.002,technique_name=Service Execution" condition="image">psexec.exe</Image> <!--Sysinternals:PsExec client side | Credit @Cyb3rOps -->
  			<Image name="flag=Amber,technique_id=T1569.002,technique_name=Service Execution" condition="image">psexesvc.exe</Image> <!--Sysinternals:PsExec server side | Credit @Cyb3rOps -->
			<!--Suspicious sources-->
			<Image name="flag=Amber,technique_id=T1036,technique_name=Masquerading" condition="begin with">C:\Users</Image> <!--Tools downloaded by users can use other processes for networking, but this is a very valuable indicator.-->
			<Image name="flag=Amber,technique_id=T1036,technique_name=Masquerading" condition="begin with">C:\ProgramData</Image> <!--Normally, network communications should be sourced from "Program Files" not from ProgramData, something to look at-->
			<Image name="flag=Amber,technique_id=T1036,technique_name=Masquerading" condition="begin with">C:\Windows\Temp</Image> <!--Suspicious anything would communicate from the system-level temp directory-->
			<Image name="flag=Amber,technique_id=T1036,technique_name=Masquerading" condition="begin with">C:\Temp</Image> <!--Suspicious anything would communicate from the temp directory-->
			<Image name="flag=Amber,technique_id=T1036,technique_name=Masquerading" condition="begin with">C:\PerfLogs\</Image>
			<Image name="flag=Amber,technique_id=T1036,technique_name=Masquerading" condition="begin with">C:\$Recycle.bin\</Image>
			<Image name="flag=Amber,technique_id=T1036,technique_name=Masquerading" condition="begin with">C:\Intel\Logs\</Image>
			<Image name="flag=Amber,technique_id=T1036,technique_name=Masquerading" condition="begin with">C:\Users\Default\</Image>
			<Image name="flag=Amber,technique_id=T1036,technique_name=Masquerading" condition="begin with">C:\Users\Public\</Image>
			<Image name="flag=Amber,technique_id=T1036,technique_name=Masquerading" condition="begin with">C:\Users\NetworkService\</Image>
			<Image name="flag=Amber,technique_id=T1036,technique_name=Masquerading" condition="begin with">C:\Windows\Fonts\</Image>
			<Image name="flag=Amber,technique_id=T1036,technique_name=Masquerading" condition="begin with">C:\Windows\Debug\</Image>
			<Image name="flag=Info,technique_id=T1036,technique_name=Masquerading" condition="begin with">C:\Windows\Media\</Image>
			<Image name="flag=Info,technique_id=T1036,technique_name=Masquerading" condition="begin with">C:\Windows\Help\</Image>
			<Image name="flag=Amber,technique_id=T1036,technique_name=Masquerading" condition="begin with">C:\Windows\addins\</Image>
			<Image name="flag=Info,technique_id=T1036,technique_name=Masquerading" condition="begin with">C:\Windows\repair\</Image>
			<Image name="flag=Amber,technique_id=T1036,technique_name=Masquerading" condition="begin with">C:\Windows\security\</Image>
			<Image name="flag=Amber,technique_id=T1036,technique_name=Masquerading" condition="begin with">C:\Windows\system32\config\systemprofile\</Image>
			<Image name="flag=Amber,technique_id=T1036,technique_name=Masquerading" condition="contains">\htdocs\</Image>
			<Image name="flag=Amber,technique_id=T1036,technique_name=Masquerading" condition="contains">\wwwroot\</Image>
			<!--Sync appv publishing server-->
			<Image name="flag=Info,technique_id=T1218,technique_name=Signed Binary Proxy Execution" condition="image">SyncAppvPublishingServer.exe</Image>
			<!--Windows Remote Management-->
			<DestinationPort name="flag=Info,technique_id=T1021.006,technique_name=Windows Remote Management" condition="is">5985</DestinationPort>
         	<DestinationPort name="flag=Info,technique_id=T1021.006,technique_name=Windows Remote Management" condition="is">5986</DestinationPort>
		</NetworkConnect>
	</RuleGroup>

	<RuleGroup name="" groupRelation="or">
		<NetworkConnect onmatch="exclude">

			<Image name="flag=Info" condition="is">C:\Program Files\Palo Alto Networks\Traps\cyserver.exe</Image> <!--Palo Alto Cortex XDR-->
			<!--SECTION: Microsoft-->
			<Image name="flag=Info" condition="begin with">C:\ProgramData\Microsoft\Windows Defender\Platform\</Image>
			<Image name="flag=Info" condition="end with">AppData\Local\Microsoft\Teams\current\Teams.exe</Image> <!--Microsoft: Teams-->
			<DestinationHostname condition="end with">.windowsupdate.microsoft.com</DestinationHostname> <!--Microsoft:Update delivery-->
			<DestinationHostname condition="end with">.windowsupdate.com</DestinationHostname> <!--Microsoft:Update delivery-->
			<DestinationHostname condition="end with">wustat.windows.com</DestinationHostname> <!--Microsoft:Update delivery-->
			<DestinationHostname condition="end with">go.microsoft.com</DestinationHostname> <!--Microsoft:Update delivery-->
			<DestinationHostname condition="end with">.update.microsoft.com</DestinationHostname> <!--Microsoft:Update delivery-->
			<DestinationHostname condition="end with">download.microsoft.com</DestinationHostname> <!--Microsoft:Update delivery-->
			<Image condition="end with">AppData\Roaming\Spotify\Spotify.exe</Image> <!--Spotify-->
			<DestinationHostname condition="end with">microsoft.com.akadns.net</DestinationHostname> <!--Microsoft:Update delivery-->
			<DestinationHostname condition="end with">microsoft.com.nsatc.net</DestinationHostname> <!--Microsoft:Update delivery-->
			<!--Section: Loopback Addresses-->
			<DestinationIp condition="is">127.0.0.1</DestinationIp> <!--Credit @ITProPaul-->
			<DestinationIp condition="begin with">fe80:0:0:0</DestinationIp> <!--Credit @ITProPaul-->
			
			<!--Added from Olaf-->
			<!--Dropbox-->
			<Image name="flag=Info" condition="end with">AppData\Roaming\Dropbox\bin\Dropbox.exe</Image> <!--Dropbox-->
	  		<!--Eset-->
			<Image name="flag=Info" condition="is">C:\Program Files\ESET\ESET Nod32 Antivirus\ekrn.exe</Image> <!--Credit d4ph1l -->
	  		<!--Microsoft One Drive-->
			<Image name="flag=Info" condition="image">OneDrive.exe</Image> <!--Microsoft:OneDrive-->
			<Image name="flag=Info" condition="image">OneDriveStandaloneUpdater.exe</Image> <!--Microsoft:OneDrive-->
	  		<!--Sophos-->
			<Image name="flag=Info" condition="is">C:\Program Files (x86)\Sophos\Sophos Anti-Virus\Web Intelligence\swi_service.exe</Image> <!--Credit d4ph1l -->
			<Image name="flag=Info" condition="is">C:\Program Files (x86)\Sophos\AutoUpdate\ALsvc.exe</Image> <!--Credit d4ph1l -->
			<Image name="flag=Info" condition="is">C:\Program Files (x86)\Sophos\Remote Management System\RouterNT.exe</Image> <!--Credit d4ph1l -->
			<Image name="flag=Info" condition="is">C:\Program Files (x86)\Sophos\Sophos Anti-Virus\Web Control\swc_service.exe</Image> <!--Credit d4ph1l -->
			<Image name="flag=Info" condition="is">C:\Program Files (x86)\Sophos\Sophos Anti-Virus\Web Intelligence\swi_service.exe</Image> <!--Credit d4ph1l -->
			<Image name="flag=Info" condition="is">C:\Program Files\Sophos\Sophos Network Threat Protection\bin\SntpService.exe</Image> <!--Credit d4ph1l -->
			<!--Trend Micro-->
			<Image name="flag=Info" condition="is">C:\Program files (x86)\Trend Micro\OfficeScan Client\tmlisten.exe</Image> <!--Credit d4ph1l -->
      		<Image name="flag=Info" condition="is">C:\Program Files (x86)\Trend Micro\BM\TMBMSRV.exe</Image> <!--Credit d4ph1l -->
	  		<!--SECTION: Microsoft-->
			<DestinationHostname condition="end with">microsoft.com</DestinationHostname> <!--Microsoft:Update delivery-->
			<DestinationHostname condition="end with">microsoft.com.akadns.net</DestinationHostname> <!--Microsoft:Update delivery-->
			<DestinationHostname condition="end with">microsoft.com.nsatc.net</DestinationHostname> <!--Microsoft:Update delivery-->
			<!--FortiSIEM-->
			<Image name="flag=Info" condition="image">AoWinAgt.exe</Image> <!--FortiSIEM Agent-->
			<Image name="flag=Info" condition="image">FortiESNAC.exe</Image> <!--FortiClient-->
		
		</NetworkConnect>
	</RuleGroup>

	<!--SYSMON EVENT ID 4 : RESERVED FOR SYSMON SERVICE STATUS MESSAGES-->

		<!--DATA: UtcTime, State, Version, SchemaVersion-->
		<!--Cannot be filtered.-->

	<!--SYSMON EVENT ID 5 : PROCESS ENDED [ProcessTerminate]-->
		<!--COMMENT:	Useful data in building infection timelines.-->

		<!--DATA: UtcTime, ProcessGuid, ProcessId, Image-->
	<RuleGroup name="" groupRelation="or">
		<ProcessTerminate onmatch="include">
			<Image name="flag=Info" condition="begin with">C:\Users</Image> <!--Process terminations by user binaries-->
			<Image name="flag=Amber" condition="begin with">\</Image> <!--Devices and VSC shouldn't be executing changes | Credit: @SBousseaden @ionstorm @neu5ron @PerchedSystems [ https://twitter.com/SwiftOnSecurity/status/1133167323991486464 ] -->
			<!--Users and temp folders-->
			<Image name="flag=Info" condition="begin with">C:\Users</Image> <!--Process terminations by user binaries-->
			<Image name="flag=Info" condition="begin with">C:\Temp</Image> <!--Process terminations by temp binaries-->
			<Image name="flag=Info" condition="begin with">C:\Windows\Temp</Image> <!--Process terminations by temp binaries-->	
		</ProcessTerminate>
	</RuleGroup>

	<RuleGroup name="" groupRelation="or">
		<ProcessTerminate onmatch="exclude">
		</ProcessTerminate>
	</RuleGroup>

	<!--SYSMON EVENT ID 6 : DRIVER LOADED INTO KERNEL [DriverLoad]-->
		<!--COMMENT:	Because drivers with bugs can be used to escalate to kernel permissions, be extremely selective
			about what you exclude from monitoring. Low event volume, little incentive to exclude.
			[ https://attack.mitre.org/wiki/Technique/T1014 ] -->
		<!--TECHNICAL:	Sysmon will check the signing certificate revocation status of any driver you don't exclude.-->

		<!--DATA: UtcTime, ImageLoaded, Hashes, Signed, Signature, SignatureStatus-->
	<RuleGroup name="" groupRelation="or">
		<DriverLoad onmatch="exclude">
			<!--COMMENT:	Because drivers with bugs can be used to escalate to kernel permissions, be extremely selective
				about what you exclude from monitoring. Low event volume, little incentive to exclude.-->
			<!--Exclude Microsoft drivers with valid signature-->
            <Rule groupRelation="and">
                <Signature condition="contains">Microsoft</Signature>
                <SignatureStatus condition="is">Valid</SignatureStatus>
            </Rule>
			<!--Exclude Intel drivers with valid signature-->
			<Rule groupRelation="and">
				<Signature condition="begin with">Intel </Signature>
				<SignatureStatus condition="is">Valid</SignatureStatus>
			</Rule>
		</DriverLoad>
	</RuleGroup>

	<!--SYSMON EVENT ID 7 : DLL (IMAGE) LOADED BY PROCESS [ImageLoad]-->
		<!--COMMENT:	Can cause high system load, disabled by default.-->
		<!--COMMENT:	[ https://attack.mitre.org/wiki/Technique/T1073 ] [ https://attack.mitre.org/wiki/Technique/T1038 ] [ https://attack.mitre.org/wiki/Technique/T1034 ] -->

		<!--DATA: UtcTime, ProcessGuid, ProcessId, Image, ImageLoaded, Hashes, Signed, Signature, SignatureStatus-->
	<RuleGroup name="" groupRelation="or">
		<ImageLoad onmatch="include">
			<!--NOTE: Using "include" with no rules means nothing in this section will be logged-->
			<!--Mimikatz in memery-->
			<Rule name="flag=Red,technique_id=T1003,technique_name=Credential Dumping" groupRelation="and">
				<ImageLoaded name="flag=Red,technique_id=T1003,technique_name=Credential Dumping" condition="is">C:\Windows\System32\samlib.dll</ImageLoaded> <!--Mitre T1098--> <!--Mitre T1550.002--> <!--Mitre T1003-->
				<ImageLoaded name="flag=Red,technique_id=T1003,technique_name=Credential Dumping" condition="is">C:\Windows\System32\WinSCard.dll</ImageLoaded> <!--Mitre T1098--> <!--Mitre T1550.002--> <!--Mitre T1003-->
				<ImageLoaded name="flag=Red,technique_id=T1003,technique_name=Credential Dumping" condition="is">C:\Windows\System32\cryptdll.dll</ImageLoaded> <!--Mitre T1098--> <!--Mitre T1550.002--> <!--Mitre T1003-->
				<ImageLoaded name="flag=Red,technique_id=T1003,technique_name=Credential Dumping" condition="is">C:\Windows\System32\hid.dll</ImageLoaded> <!--Mitre T1098--> <!--Mitre T1550.002--> <!--Mitre T1003-->
				<ImageLoaded name="flag=Red,technique_id=T1003,technique_name=Credential Dumping" condition="is">C:\Windows\System32\vaultcli.dll</ImageLoaded> <!--Mitre T1098--> <!--Mitre T1550.002--> <!--Mitre T1003-->
				<ImageLoaded name="flag=Red,technique_id=T1003,technique_name=Credential Dumping" condition="is">C:\Windows\System32\wlanapi.dll</ImageLoaded> <!--Mitre T1098--> <!--Mitre T1550.002--> <!--Mitre T1003-->      
			</Rule>
			<!--Office Add In-->
			<ImageLoaded name="flag=Red,technique_id=1137,technique_name=Office Application Startup" condition="end with">.wll</ImageLoaded>
	     	<ImageLoaded name="flag=Info,technique_id=T1137,technique_name=Office Application Startup" condition="end with">.xll</ImageLoaded>
			<!--Office COM Load-->
			<!-- Credit to @Antonlovesdnb https://blog.pwntario.com/team-posts/antons-posts/hunting-malicious-macros-->
			<Rule name="flag=Red,technique_id=1175,technique_name=Component Object Model and Distributed COM" groupRelation="and">
				<Image name="flag=Red,technique_id=1175,technique_name=Component Object Model and Distributed COM" condition="contains all">C:\Program Files;\Microsoft Office\root\Office</Image>
				<ImageLoaded name="flag=Red,technique_id=1175,technique_name=Component Object Model and Distributed COM" condition="is">C:\Windows\SysWOW64\combase.dll</ImageLoaded>
			</Rule>
			<Rule name="flag=Red,technique_id=1175,technique_name=Component Object Model and Distributed COM" groupRelation="and">
				<Image name="flag=Red,technique_id=1175,technique_name=Component Object Model and Distributed COM" condition="contains all">C:\Program Files;\Microsoft Office\root\Office</Image>
				<ImageLoaded name="flag=Info,technique_id=1175,technique_name=Component Object Model and Distributed COM" condition="is">C:\Windows\SysWOW64\coml2.dll</ImageLoaded>
			</Rule>
			<Rule name="flag=Red,technique_id=1175,technique_name=Component Object Model and Distributed COM" groupRelation="and">
				<Image name="flag=Red,technique_id=1175,technique_name=Component Object Model and Distributed COM" condition="contains all">C:\Program Files;\Microsoft Office\root\Office</Image>
				<ImageLoaded name="flag=Info,technique_id=1175,technique_name=Component Object Model and Distributed COM"  condition="is">C:\Windows\SysWOW64\comsvcs.dll</ImageLoaded>
			</Rule>
			<!--Office Donnet Load-->
			<!-- Credit to @Antonlovesdnb https://blog.pwntario.com/team-posts/antons-posts/hunting-malicious-macros-->
			<Rule groupRelation="and" name="flag=Red,technique_id=1055,technique_name=Process Injection">
				<Image name="flag=Red" condition="contains all">C:\Program Files;\Microsoft Office\root\Office</Image>
				<ImageLoaded name="flag=Red" condition="begin with">C:\Windows\assembly\</ImageLoaded>
			</Rule>
			<Rule groupRelation="and" name="flag=Red,technique_id=1055,technique_name=Process Injection">
				<Image name="flag=Red" condition="contains all">C:\Program Files;\Microsoft Office\root\Office</Image>
				<ImageLoaded name="flag=Red" condition="begin with">C:\Windows\Microsoft.NET\assembly\GAC_MSIL</ImageLoaded>
			</Rule>
			<Rule groupRelation="and" name="flag=Red,technique_id=1055,technique_name=Process Injection">
				<Image name="flag=Red" condition="contains all">C:\Program Files;\Microsoft Office\root\Office</Image>
				<ImageLoaded name="flag=Red" condition="end with">clr.dll</ImageLoaded>
			</Rule>      
			<!--Office vb Load-->
			<!-- Credit to @Antonlovesdnb https://blog.pwntario.com/team-posts/antons-posts/hunting-malicious-macros-->
			<Rule groupRelation="and" name="flag=Amber,technique_id=1059.005,technique_name=Command and Scripting Interpreter VBScript">
				<Image name="flag=Amber" condition="contains all">C:\Program Files;\Microsoft Office\root\Office</Image>
				<ImageLoaded name="flag=Amber" condition="end with">VBE7INTL.DLL</ImageLoaded>
			</Rule>
			<Rule groupRelation="and" name="flag=Amber,technique_id=1059.005,technique_name=Command and Scripting Interpreter VBScript">
				<Image name="flag=Amber" condition="contains all">C:\Program Files;\Microsoft Office\root\Office</Image>
				<ImageLoaded name="flag=Amber" condition="end with">VBE7.DLL</ImageLoaded>
			</Rule>
			<Rule groupRelation="and" name="flag=Amber,technique_id=1059.005,technique_name=Command and Scripting Interpreter VBScript">
				<Image name="flag=Amber" condition="contains all">C:\Program Files;\Microsoft Office\root\Office</Image>
				<ImageLoaded name="flag=Amber" condition="end with">VBEUI.DLL</ImageLoaded>
			</Rule>      
			<!--Office wmi Load-->
			<!-- Credit to @Antonlovesdnb https://blog.pwntario.com/team-posts/antons-posts/hunting-malicious-macros-->
			<Rule name="flag=Amber,technique_id=1047,technique_name=Windows Management Instrumentation" groupRelation="and">
				<Image name="flag=Amber,technique_id=1047,technique_name=Windows Management Instrumentation" condition="contains all">C:\Program Files;\Microsoft Office\root\Office</Image>
				<ImageLoaded name="flag=Amber" condition="is">C:\Windows\SysWOW64\wbem\wbemdisp.dll</ImageLoaded>
			</Rule>
			<!--Powershell-->
			<ImageLoaded name="flag=Red,technique_id=T1059.001,technique_name=PowerShell" condition="end with" >system.management.automation.ni.dll</ImageLoaded>
			<ImageLoaded name="flag=Red,technique_id=T1059.001,technique_name=PowerShell" condition="end with" >system.management.automation.dll</ImageLoaded>
			<ImageLoaded name="flag=Red,technique_id=T1059.001,technique_name=PowerShell" condition="end with" >Microsoft.PowerShell.Commands.Diagnostics.dll</ImageLoaded>
			<ImageLoaded name="flag=Red,technique_id=T1059.001,technique_name=PowerShell" condition="end with" >Microsoft.PowerShell.Commands.Management.dll</ImageLoaded>
			<ImageLoaded name="flag=Red,technique_id=T1059.001,technique_name=PowerShell" condition="end with" >Microsoft.PowerShell.Commands.Utility.dll</ImageLoaded>
			<ImageLoaded name="flag=Red,technique_id=T1059.001,technique_name=PowerShell" condition="end with" >Microsoft.PowerShell.ConsoleHost.dll</ImageLoaded>
			<ImageLoaded name="flag=Red,technique_id=T1059.001,technique_name=PowerShell" condition="end with" >Microsoft.PowerShell.Security.dll</ImageLoaded>
			<!--Scheduled Task-->
			<ImageLoaded name="flag=Info,technique_id=1053,technique_name=Scheduled Task" condition="end with">taskschd.dll</ImageLoaded>
			<!--Squiblydoo-->
			<ImageLoaded name="flag=Amber,technique_id=T1218.010,technique_name=Regsvr32" condition="end with">scrobj.dll</ImageLoaded>
			<OriginalFileName name="flag=Info,echnique_id=T1218.010,technique_name=Regsvr32" condition="is">scrobj.dll</OriginalFileName>
			<!--Suspicious Location-->
			<ImageLoaded name="flag=Red,technique_id=T1073,technique_name=DLL Side-Loading" condition="contains any">admin$;c$;\\;\appdata\;\temp\</ImageLoaded><!-- loaded from network file share -->
			<ImageLoaded name="flag=Amber,technique_id=T1073,technique_name=DLL Side-Loading" condition="begin with">c:\programdata\</ImageLoaded>
			<ImageLoaded name="flag=Info,technique_id=T1073,technique_name=DLL Side-Loading" condition="begin with" >C:\Windows\Media\</ImageLoaded>
			<ImageLoaded name="flag=Info,technique_id=T1073,technique_name=DLL Side-Loading" condition="begin with" >C:\Windows\addins\</ImageLoaded>
			<ImageLoaded name="flag=Info,technique_id=T1073,technique_name=DLL Side-Loading" condition="begin with" >C:\Windows\system32\config\systemprofile\</ImageLoaded>
			<ImageLoaded name="flag=Info,technique_id=T1073,technique_name=DLL Side-Loading" condition="begin with" >C:\Windows\Debug\</ImageLoaded> 
			<ImageLoaded name="flag=Info,technique_id=T1073,technique_name=DLL Side-Loading" condition="begin with" >C:\Windows\Temp</ImageLoaded>
			<ImageLoaded name="flag=Info,technique_id=T1073,technique_name=DLL Side-Loading" condition="begin with" >C:\PerfLogs\</ImageLoaded>
			<ImageLoaded name="flag=Info,technique_id=T1073,technique_name=DLL Side-Loading" condition="begin with" >C:\Windows\Help\</ImageLoaded>
			<ImageLoaded name="flag=Info,technique_id=T1073,technique_name=DLL Side-Loading" condition="begin with" >C:\Intel\Logs\</ImageLoaded>
			<ImageLoaded name="flag=Info,technique_id=T1073,technique_name=DLL Side-Loading" condition="begin with" >C:\Temp</ImageLoaded>
			<ImageLoaded name="flag=Info,technique_id=T1073,technique_name=DLL Side-Loading" condition="begin with" >C:\Windows\repair\</ImageLoaded>
			<ImageLoaded name="flag=Info,technique_id=T1073,technique_name=DLL Side-Loading" condition="begin with" >C:\Windows\security\</ImageLoaded>
			<ImageLoaded name="flag=Info,technique_id=T1073,technique_name=DLL Side-Loading" condition="begin with" >C:\Windows\Fonts\</ImageLoaded>
			<ImageLoaded name="flag=Info,technique_id=T1073,technique_name=DLL Side-Loading" condition="begin with" >file:</ImageLoaded>
			<ImageLoaded name="flag=Info,technique_id=T1073,technique_name=DLL Side-Loading" condition="contains">$Recycle.bin\</ImageLoaded>
			<ImageLoaded name="flag=Info,technique_id=T1073,technique_name=DLL Side-Loading" condition="contains" >\Windows\IME\</ImageLoaded>	
			<!--wmi-->
			<ImageLoaded name="flag=Amber,technique_id=T1047,technique_name=Windows Management Instrumentation" condition="end with">wmiutils.dll</ImageLoaded>
			<ImageLoaded name="flag=Info,technique_id=T1064,technique_name=Windows Scripting Host Component" condition="end with">wshom.ocx</ImageLoaded>
			<!--Detect execution of HTA using the IE Javascript engine to bypass AMSI-->
      		<!--Note: Rule placed before Windows Scriptingh to ensure it triggers on this on case any other component is used.-->
      		<!---Thanks to Carlos Perez-->
          	<Rule groupRelation="and">
            	<ImageLoaded name="flag=Info,technique_id=T1170,technique_name=MSHTA with AMSI Bypass" condition="end with">jscript9.dll</ImageLoaded>
            	<Image condition="end with">mshta.exe</Image>
         	</Rule>
			<ImageLoaded name="flag=Info,technique_id=T1064,technique_name=Windows Scripting Host Component" condition="end with">wshom.ocx</ImageLoaded>
       		<ImageLoaded name="flag=Info" condition="end with">scrrun.dll</ImageLoaded>
        	<ImageLoaded name="flag=Info" condition="end with">vbscript.dll</ImageLoaded>
			<Rule groupRelation="and">
         		<ImageLoaded name="flag=Info,echnique_id=T1170,technique_name=MSHTA with AMSI Bypass" condition="end with">jscript9.dll</ImageLoaded>
          		<Image condition="end with">mshta.exe</Image>
       		 </Rule>

		
		</ImageLoad>
	</RuleGroup>

	<!--SYSMON EVENT ID 8 : REMOTE THREAD CREATED [CreateRemoteThread]-->
		<!--COMMENT:	Monitor for processes injecting code into other processes. Often used by malware to cloak their actions. Also when Firefox loads Flash.
		[ https://attack.mitre.org/wiki/Technique/T1055 ] -->

		<!--DATA: UtcTime, SourceProcessGuid, SourceProcessId, SourceImage, TargetProcessId, TargetImage, NewThreadId, StartAddress, StartModule, StartFunction-->
	<RuleGroup name="" groupRelation="or">
		<CreateRemoteThread onmatch="include">
			<!--Clipboard monitor-->
        	<Rule name="flag=Red" groupRelation="and"> 
          		<SourceImage name="flag=Red" condition="is">c:\windows\system32\csrss.exe</SourceImage>
          		<StartFunction name="flag=Red" condition="is">CrtlRoutine</StartFunction>
         	</Rule> 
			<!--DLL injection-->
			<StartFunction name="flag=Red,technique_id=T1055,technique_name=Process Injection" condition="contains">LoadLibrary</StartFunction>
          	<TargetImage name="flag=Red,technique_id=T1055,technique_name=Process Injection" condition="is">C:\Windows\System32\rundll32.exe</TargetImage>
			<TargetImage name="flag=Red,technique_id=T1055,technique_name=Process Injection" condition="is">C:\Windows\System32\svchost.exe</TargetImage>
			<TargetImage name="flag=Red,technique_id=T1055,technique_name=Process Injection" condition="is">C:\Windows\System32\sysmon.exe</TargetImage>
			<!--Dump hashes-->
			<Rule name="flag=Red,technique_id=T1003,technique_name=Credential Dumping" groupRelation="and"> 
				<StartAddress name="flag=Red,technique_id=T1003,technique_name=Credential Dumping" condition="is">0x001A0000</StartAddress><!--default address-->
				<TargetImage name="flag=Red" condition="is">c:\windows\system32\lsass.exe</TargetImage>
			</Rule> 
			<!--Psinject-->
			<StartAddress name="flag=Red,technique_id=T1055,technique_name=Process Injection" condition="is">0x00590000</StartAddress><!--default psinject address-->
      	</CreateRemoteThread>
	</RuleGroup>
	<RuleGroup name="" groupRelation="or">
		<CreateRemoteThread onmatch="exclude">
			<!--COMMENT: Exclude mostly-safe sources and log anything else.-->
			<SourceImage name="flag=Info" condition="is">C:\Windows\system32\wbem\WmiPrvSE.exe</SourceImage>
			<SourceImage name="flag=Info" condition="is">C:\Windows\system32\svchost.exe</SourceImage>
			<SourceImage name="flag=Info" condition="is">C:\Windows\system32\wininit.exe</SourceImage>
			<SourceImage name="flag=Info" condition="is">C:\Windows\system32\csrss.exe</SourceImage>
			<SourceImage name="flag=Info" condition="is">C:\Windows\system32\services.exe</SourceImage>
			<SourceImage name="flag=Info" condition="is">C:\Windows\system32\winlogon.exe</SourceImage>
			<SourceImage name="flag=Info" condition="is">C:\Windows\system32\audiodg.exe</SourceImage>
			<StartModule condition="is">C:\Windows\system32\kernel32.dll</StartModule>
			<TargetImage name="flag=Info" condition="is">C:\Program Files (x86)\Google\Chrome\Application\chrome.exe</TargetImage>
			<!--Google Chrome-->
			<TargetImage name="flag=Info" condition="end with">Google\Chrome\Application\chrome.exe</TargetImage>
			<!--wmi-->
			<SourceImage name="flag=Info" condition="is">C:\Windows\System32\wbem\WmiPrvSE.exe</SourceImage>	
			<Rule groupRelation="and">
          		<SourceImage condition="is">C:\Windows\System32\dwm.exe</SourceImage>
		  		<TargetImage condition="is">C:\Windows\System32\csrss.exe</TargetImage>
         	</Rule>
		</CreateRemoteThread>
	</RuleGroup>

	<!--SYSMON EVENT ID 9 : RAW DISK ACCESS [RawAccessRead]-->
		<!--EVENT 9: "RawAccessRead detected"-->
		<!--COMMENT:	Can cause high system load, disabled by default.-->
		<!--COMMENT:	Monitor for raw sector-level access to the disk, often used to bypass access control lists or access locked files.
			Disabled by default since including even one entry here activates this component. Reward/performance/rule maintenance decision.
			Encourage you to experiment with this feature yourself. [ https://attack.mitre.org/wiki/Technique/T1067 ] -->
		<!--COMMENT:	You will likely want to set this to a full capture on domain controllers, where no process should be doing raw reads.-->

		<!--DATA: UtcTime, ProcessGuid, ProcessId, Image, Device-->
	<RuleGroup name="" groupRelation="or">
		<RawAccessRead onmatch="include">
			<!--NOTE: Using "include" with no rules means nothing in this section will be logged-->
		</RawAccessRead>
	</RuleGroup>

	<!--SYSMON EVENT ID 10 : INTER-PROCESS ACCESS [ProcessAccess]-->
		<!--EVENT 10: "Process accessed"-->
		<!--COMMENT:	Can cause high system load, disabled by default.-->
		<!--COMMENT:	Monitor for processes accessing other process' memory.-->

		<!--DATA: UtcTime, SourceProcessGuid, SourceProcessId, SourceThreadId, SourceImage, TargetProcessGuid, TargetProcessId, TargetImage, GrantedAccess, CallTrace-->
	<RuleGroup name="" groupRelation="or">
		<ProcessAccess onmatch="include">
			<SourceImage name="flag=Red,technique_id=T1047,technique_name=Windows PS Management Instrumentation" condition="image">wsmprovhost.exe</SourceImage>  <!-- Datc - suspicious remote powershell remoting -->
			<!--NOTE: Using "include" with no rules means nothing in this section will be logged-->
			<!--Debugging-->
			<CallTrace name="flag=Red,technique_id=T1003,technique_name=Credential Dumping" condition="contains">dbghelp.dll</CallTrace>
      		<CallTrace name="flag=Red,technique_id=T1003,technique_name=Credential Dumping" condition="contains">dbgcore.dll</CallTrace>
			<!--Desktop-->
			<!--Modified TargetFilename to TargetImage due to Error occurredd-->
			<TargetImage name="flag=Info" condition="contains">Desktop</TargetImage> <!--Files on the Desktop-->
			<!--Dump Hashes-->
			<Rule name="flag=Red,technique_id=T1003,technique_name=Credential Dumping" groupRelation="and">
				<TargetImage name="flag=Red,technique_id=T1003,technique_name=Credential Dumping" condition="is">C:\Windows\system32\csrss.exe</TargetImage> <!--Mitre T1098--> <!--Mitre T1550.002--> <!--Mitre T1003--><!-- depending on what you're running on your host, this might be noisy-->
				<GrantedAccess name="flag=Red">0x1F1FFF</GrantedAccess>
			</Rule>
			<Rule name="flag=Red,technique_id=T1003,technique_name=Credential Dumping" groupRelation="and">         
				<TargetImage name="flag=Red,technique_id=T1003,technique_name=Credential Dumping" condition="is">C:\Windows\system32\wininit.exe</TargetImage> <!--Mitre T1098--> <!--Mitre T1550.002--> <!--Mitre T1003--><!-- depending on what you're running on your host, this might be noisy-->
				<GrantedAccess name="flag=Red">0x1F1FFF</GrantedAccess>
			</Rule>            
			<Rule name="flag=Red,technique_id=T1003,technique_name=Credential Dumping" groupRelation="and">         
				<TargetImage name="flag=Red,technique_id=T1003,technique_name=Credential Dumping" condition="is">C:\Windows\system32\winlogon.exe</TargetImage> <!--Mitre T1098--> <!--Mitre T1550.002--> <!--Mitre T1003--><!-- depending on what you're running on your host, this might be noisy-->
				<GrantedAccess name="flag=Red">0x1F1FFF</GrantedAccess>
				</Rule>            
			<Rule name="flag=Red,technique_id=T1003,technique_name=Credential Dumping" groupRelation="and">         
				<TargetImage name="flag=Red,technique_id=T1003,technique_name=Credential Dumping" condition="is">C:\Windows\system32\services.exe</TargetImage> <!--Mitre T1098--> <!--Mitre T1550.002--> <!--Mitre T1003--><!-- depending on what you're running on your host, this might be noisy-->
				<GrantedAccess name="flag=Red">0x1F1FFF</GrantedAccess>                              
			</Rule>
			<!--Hook Check-->
			<GrantedAccess name="flag=Red,technique_id=T1093,technique_name=Process Hollowing">0x21410</GrantedAccess> <!-- misc::detours in Mimikatz, thanks @Carlos_Perez -->
            <!--Lsass Access-->
			<!-- In some environments this causes HIGH CPU usage by sysmon, remove this module when that occurs -->
			<Rule name="flag=Red,technique_id=T1003,technique_name=Credential Dumping" groupRelation="and">
				<TargetImage name="flag=Red,technique_id=T1003,technique_name=Credential Dumping" condition="is">C:\Windows\system32\lsass.exe</TargetImage> <!--Mitre T1098--> <!--Mitre T1550.002--> <!--Mitre T1003--><!-- depending on what you're running on your host, this might be noisy-->
				<GrantedAccess name="flag=Red">0x1FFFFF</GrantedAccess><!--Expect EDRs/AVs to also trigger this-->
			</Rule> 
			<Rule name="flag=Red,technique_id=T1003,technique_name=Credential Dumping" groupRelation="and">
				<TargetImage name="flag=Red,technique_id=T1003,technique_name=Credential Dumping" condition="is">C:\Windows\system32\lsass.exe</TargetImage> <!--Mitre T1098--> <!--Mitre T1550.002--> <!--Mitre T1003--><!-- depending on what you're running on your host, this might be noisy-->
				<GrantedAccess name="flag=Red">0x1F1FFF</GrantedAccess>
			</Rule>          
			<Rule name="flag=Red,technique_id=T1003,technique_name=Credential Dumping" groupRelation="and">
				<TargetImage name="flag=Red,technique_id=T1003,technique_name=Credential Dumping" condition="is">C:\Windows\system32\lsass.exe</TargetImage> <!--Mitre T1098--> <!--Mitre T1550.002--> <!--Mitre T1003--><!-- depending on what you're running on your host, this might be noisy-->
				<GrantedAccess name="flag=Red">0x1010</GrantedAccess>
			</Rule>          
			<Rule name="flag=Red,technique_id=T1003,technique_name=Credential Dumping" groupRelation="and">
				<TargetImage name="flag=Red,technique_id=T1003,technique_name=Credential Dumping" condition="is">C:\Windows\system32\lsass.exe</TargetImage> <!--Mitre T1098--> <!--Mitre T1550.002--> <!--Mitre T1003--><!-- depending on what you're running on your host, this might be noisy-->
				<GrantedAccess name="flag=Red">0x143A</GrantedAccess>
			</Rule>
			<!--Office Process Injection-->
			<Rule groupRelation="and" name="flag=Red,technique_id=1055,technique_name=Process Injection">
				<SourceImage name="flag=Red" condition="contains all">C:\Program Files;\Microsoft Office\Root\Office</SourceImage>
				<CallTrace name="flag=Red" condition="contains">\Microsoft Shared\VBA</CallTrace>
			</Rule>
			<!--Process Suspend Resume-->
			<GrantedAccess name="flag=Red,technique_id=T1093,technique_name=Process Hollowing">0x0800</GrantedAccess> <!-- PROCESS_SUSPEND_RESUME -->
			<GrantedAccess name="flag=Red,technique_id=T1003,technique_name=Credential Dumping">0x0810</GrantedAccess> <!-- PROCESS_SUSPEND_RESUME + PROCESS_VM_READ - possible memory dump to extract sensitive information -->
			<GrantedAccess name="flag=Red,technique_id=T1055,technique_name=Process Injection">0x0820</GrantedAccess> <!-- PROCESS_SUSPEND_RESUME + PROCESS_VM_WRITE - possible memory injection -->
			<GrantedAccess name="flag=Red,technique_id=T1093,technique_name=Process Hollowing">0x800</GrantedAccess> <!-- PROCESS_SUSPEND_RESUME -->
			<GrantedAccess name="flag=Red,technique_id=T1003,technique_name=Credential Dumping">0x810</GrantedAccess> <!-- PROCESS_SUSPEND_RESUME + PROCESS_VM_READ - possible memory dump to extract sensitive information -->
			<GrantedAccess name="flag=Red,technique_id=T1055,technique_name=Process Injection">0x820</GrantedAccess> <!-- PROCESS_SUSPEND_RESUME + PROCESS_VM_WRITE - possible memory injection -->
			<!--Suspicious Locations-->
			<SourceImage name="flag=Red,technique_id=T1036,technique_name=Masquerading" condition="begin with">C:\PerfLogs\</SourceImage>
			<SourceImage name="flag=Red,technique_id=T1036,technique_name=Masquerading" condition="begin with">C:\$Recycle.bin\</SourceImage>
			<SourceImage name="flag=Red,technique_id=T1036,technique_name=Masquerading" condition="begin with">C:\Intel\Logs\</SourceImage>
			<SourceImage name="flag=Red,technique_id=T1036,technique_name=Masquerading" condition="begin with">C:\Users\Default\</SourceImage>
			<SourceImage name="flag=Red,technique_id=T1036,technique_name=Masquerading" condition="begin with">C:\Users\Public\</SourceImage>
			<SourceImage name="flag=Red,technique_id=T1036,technique_name=Masquerading" condition="begin with">C:\Users\NetworkService\</SourceImage>
			<SourceImage name="flag=Red,technique_id=T1036,technique_name=Masquerading" condition="begin with">C:\Windows\Fonts\</SourceImage>
			<SourceImage name="flag=Red,technique_id=T1036,technique_name=Masquerading" condition="begin with">C:\Windows\Debug\</SourceImage>
			<SourceImage name="flag=Red,technique_id=T1036,technique_name=Masquerading" condition="begin with">C:\Windows\Media\</SourceImage>
			<SourceImage name="flag=Red,technique_id=T1036,technique_name=Masquerading" condition="begin with">C:\Windows\Help\</SourceImage>
			<SourceImage name="flag=Red,technique_id=T1036,technique_name=Masquerading" condition="begin with">C:\Windows\addins\</SourceImage>
			<SourceImage name="flag=Red,technique_id=T1036,technique_name=Masquerading" condition="begin with">C:\Windows\repair\</SourceImage>
			<SourceImage name="flag=Red,technique_id=T1036,technique_name=Masquerading" condition="begin with">C:\Windows\security\</SourceImage>
			<SourceImage name="flag=Red,technique_id=T1036,technique_name=Masquerading" condition="begin with">C:\Windows\system32\config\systemprofile\</SourceImage>
			<SourceImage name="flag=Red,technique_id=T1036,technique_name=Masquerading" condition="contains">VolumeShadowCopy</SourceImage>
			<SourceImage name="flag=Red,technique_id=T1036,technique_name=Masquerading" condition="contains">\htdocs\</SourceImage>
			<SourceImage name="flag=Red,technique_id=T1036,technique_name=Masquerading" condition="contains">\wwwroot\</SourceImage>
			<SourceImage name="flag=Red,technique_id=T1036,technique_name=Masquerading" condition="contains">\Temp\</SourceImage>
			<!--Suspicious Powershell-->
			<Rule name="flag=Red,technique_id=T1086,technique_name=PowerShell" groupRelation="and">
				<CallTrace name="flag=Red,technique_id=T1059.001,technique_name=PowerShell" condition="contains">System.Management.Automation.ni.dll</CallTrace>
				<SourceImage name="flag=Red" condition="is not">C:\Windows\System32\WindowsPowerShell\v1.0\powershell.exe</SourceImage>
			</Rule>
		</ProcessAccess>
	</RuleGroup>
	<RuleGroup name="" groupRelation="or">
		<ProcessAccess onmatch="exclude">
			<!--Carbon Black Response-->
			<SourceImage name="flag=Info" condition="is">C:\Windows\CarbonBlack\cb.exe</SourceImage><!--CarbonBlack:Response-->
			<!--Cisco amp-->
			<SourceImage name="flag=Info" condition="contains all">C:\Program Files\Cisco\AMP\;sfc.exe</SourceImage><!--Cisco AMP-->
			<!--couchbase sigar-->
			<SourceImage name="flag=Info" condition="is">c:\Program Files\Couchbase\Server\bin\sigar_port.exe</SourceImage>
			<!--ivanti-->
			<SourceImage name="flag=Info" condition="is">C:\Program Files (x86)\Ivanti\Workspace Control\cpushld.exe</SourceImage>
			<SourceImage name="flag=Info" condition="is">C:\Program Files (x86)\RES Software\Workspace Manager\cpushld.exe</SourceImage>        
			<SourceImage name="flag=Info" condition="is">C:\Program Files\Ivanti\Workspace Control\cpushld.exe</SourceImage>
			<SourceImage name="flag=Info" condition="is">C:\Program Files\RES Software\Workspace Manager\cpushld.exe</SourceImage>
			<!--Lsass noise-->
			<SourceImage name="flag=Info" condition="end with">wmiprvse.exe</SourceImage>
			<SourceImage name="flag=Info" condition="end with">GoogleUpdate.exe</SourceImage>
			<SourceImage name="flag=Info" condition="end with">LTSVC.exe</SourceImage>
			<SourceImage name="flag=Info" condition="end with">taskmgr.exe</SourceImage>
			<SourceImage name="flag=Info" condition="end with">VBoxService.exe</SourceImage> <!-- Virtual Box -->
			<SourceImage name="flag=Info" condition="end with">vmtoolsd.exe</SourceImage> <!-- VMWare -->
			<SourceImage name="flag=Info" condition="end with">\Citrix\System32\wfshell.exe</SourceImage> <!--Citrix process in C:\Program Files (x86)\Citrix\System32\wfshell.exe -->
			<SourceImage name="flag=Info" condition="is">C:\Windows\System32\lsm.exe</SourceImage> <!-- System process under C:\Windows\System32\lsm.exe -->
			<SourceImage name="flag=Info" condition="end with">Microsoft.Identity.AadConnect.Health.AadSync.Host.exe</SourceImage> <!-- Microsoft Azure AD Connect Health Sync Agent -->
			<SourceImage name="flag=Info" condition="begin with">C:\Program Files (x86)\Symantec\Symantec Endpoint Protection</SourceImage> <!-- Symantec -->
			<GrantedAccess name="flag=Red">0x1000</GrantedAccess> <!-- PROCESS_QUERY_LIMITED_INFORMATION Generic call, quite noisy and tells not much-->
			<GrantedAccess name="flag=Red">0x1400</GrantedAccess> <!-- PROCESS_QUERY_LIMITED_INFORMATION + PROCESS_QUERY_INFORMATION Generic call, quite noisy and tells nothing-->
			<GrantedAccess name="flag=Red">0x101400</GrantedAccess> <!-- PROCESS_QUERY_LIMITED_INFORMATION + PROCESS_QUERY_INFORMATION + SYNCHRONIZE Generic call, quite noisy and tells nothing-->
			<GrantedAccess name="flag=Red">0x101000</GrantedAccess> <!-- PROCESS_QUERY_LIMITED_INFORMATION + SYNCHRONIZE Generic call, quite noisy and tells nothing-->
			<!--McAfee Endpoint-->
			<SourceImage name="flag=Info" condition="is">C:\Program Files\McAfee\Endpoint Security\Endpoint Security Platform\mfeesp.exe</SourceImage><!--McAfee:Endpoint Security Platform-->
			<SourceImage name="flag=Info" condition="is">C:\Program Files\McAfee\Agent\x86\macompatsvc.exe</SourceImage><!--McAfee:Agent-->
			<!--Microsoft Windows Defender-->
			<SourceImage name="flag=Info" condition="is">C:\Program Files\Microsoft Security Client\MsMpEng.exe</SourceImage>
    		<SourceImage name="flag=Info" condition="is">C:\Program Files\Windows Defender\MsMpEng.exe</SourceImage>
			<!--Mobaxterm-->
			<SourceImage name="flag=Info" condition="is">C:\Program Files (x86)\Mobatek\MobaXterm\MobaXterm.exe</SourceImage>
			<!--Razr sdk-->
			<SourceImage name="flag=Info" condition="is">C:\Program Files (x86)\Razer Chroma SDK\bin\RzSDKService.exe</SourceImage>
			<!--Sccm-->
			<SourceImage name="flag=Info" condition="is">C:\WINDOWS\CCM\CcmExec.exe</SourceImage>
			<!--Splunk-->
			<SourceImage name="flag=Info" condition="is">C:\Program Files\Splunk\bin\splunkd.exe</SourceImage>
			<!--VMware Player-->
			<SourceImage name="flag=Info" condition="is">C:\Program Files (x86)\VMware\VMWare Player\vmware-authd.exe</SourceImage>
			<!--VMWare Workstation-->
			<SourceImage name="flag=Info" condition="is">C:\Program Files (x86)\VMware\VMware Workstation\vmware-authd.exe</SourceImage>
			<!--WinZip-->
			<SourceImage name="flag=Info" condition="is">C:\Program Files\WinZip\FAHWindow64.exe</SourceImage>
		</ProcessAccess>
	</RuleGroup>

	<!--SYSMON EVENT ID 11 : FILE CREATED [FileCreate]-->
		<!--EVENT 11: "File created"-->
		<!--NOTE:	Other filesystem "minifilters" can make it appear to Sysmon that some files are being written twice. This is not a Sysmon issue, per Mark Russinovich.-->
		<!--NOTE:	You may not see files detected by antivirus. Other filesystem minifilters, like antivirus, can act before Sysmon receives the alert a file was written.-->

		<!--DATA: UtcTime, ProcessGuid, ProcessId, Image, TargetFilename, CreationUtcTime-->
	<RuleGroup name="" groupRelation="or">
		<FileCreate onmatch="include">
			<TargetFilename name="flag=Info,T1023" condition="contains">\Start Menu</TargetFilename> <!--Windows: Startup links and shortcut modification [ https://attack.mitre.org/wiki/Technique/T1023 ] -->
			<TargetFilename name="flag=Info,T1165" condition="contains">\Startup\</TargetFilename> <!--Microsoft:Changes to user's auto-launched files and shortcuts-->
			<TargetFilename name="flag=Info,OutlookAttachment" condition="contains">\Content.Outlook\</TargetFilename> <!--Microsoft:Outlook: attachments-->
			<TargetFilename name="flag=Info,Downloads" condition="contains">\Downloads\</TargetFilename> <!--Downloaded files. Does not include "Run" files in IE-->
			<TargetFilename name="flag=Info" condition="end with">.application</TargetFilename> <!--Microsoft:ClickOnce: [ https://blog.netspi.com/all-you-need-is-one-a-clickonce-love-story/ ] -->
			<TargetFilename name="flag=Info" condition="end with">.appref-ms</TargetFilename> <!--Microsoft:ClickOnce application | Credit @ion-storm -->
			<TargetFilename name="flag=Info" condition="end with">.bat</TargetFilename> <!--Batch scripting-->
			<TargetFilename name="flag=Info" condition="end with">.chm</TargetFilename>
			<TargetFilename name="flag=Info" condition="end with">.cmd</TargetFilename> <!--Batch scripting: Batch scripts can also use the .cmd extension | Credit: @mmazanec -->
			<TargetFilename name="flag=Info" condition="end with">.cmdline</TargetFilename> <!--Microsoft:dotNet: Executed by cvtres.exe-->
			<TargetFilename name="flag=Info,T1176" condition="end with">.crx</TargetFilename> <!--Chrome extension-->
			<TargetFilename name="flag=Info" condition="end with">.dmp</TargetFilename> <!--Process dumps [ (fr) http://blog.gentilkiwi.com/securite/mimikatz/minidump ] -->
			<TargetFilename name="flag=Info" condition="end with">.docm</TargetFilename> <!--Microsoft:Office:Word: Macro-->
			<TargetFilename name="flag=Amber,DLL" condition="end with">.dll</TargetFilename> <!--Microsoft:Office:Word: Macro-->
			<TargetFilename name="flag=Amber,EXE" condition="end with">.exe</TargetFilename> <!--Executable-->
			<TargetFilename name="flag=Amber,ProcessHostingdotNETCode" condition="end with">.exe.log</TargetFilename> <!-- [ https://github.com/bitsadmin/nopowershell ] | Credit: @SBousseaden [ https://twitter.com/SBousseaden/status/1137493597769687040 ]  -->
			<TargetFilename name="flag=Amber" condition="end with">.jar</TargetFilename> <!--Java applets-->
			<TargetFilename name="flag=Info" condition="end with">.jnlp</TargetFilename> <!--Java applets-->
			<TargetFilename name="flag=Info" condition="end with">.jse</TargetFilename> <!--Scripting [ Example: https://www.sophos.com/en-us/threat-center/threat-analyses/viruses-and-spyware/Mal~Phires-C/detailed-analysis.aspx ] -->
			<TargetFilename name="flag=Amber" condition="end with">.hta</TargetFilename> <!--Scripting-->
			<TargetFilename name="flag=Info" condition="end with">.job</TargetFilename> <!--Scheduled task-->
			<TargetFilename name="flag=Amber" condition="end with">.pptm</TargetFilename> <!--Microsoft:Office:Word: Macro-->
			<TargetFilename name="flag=Amber" condition="end with">.ps1</TargetFilename> <!--PowerShell [ More information: http://www.hexacorn.com/blog/2014/08/27/beyond-good-ol-run-key-part-16/ ] -->
			<TargetFilename name="flag=Amber" condition="end with">.sys</TargetFilename> <!--System driver files-->
			<TargetFilename name="flag=Amber" condition="end with">.scr</TargetFilename> <!--System driver files-->
			<TargetFilename name="flag=Info" condition="end with">.vbe</TargetFilename> <!--VisualBasicScripting-->
			<TargetFilename name="flag=Amber" condition="end with">.vbs</TargetFilename> <!--VisualBasicScripting-->
			<TargetFilename name="flag=Amber" condition="end with">.xlsm</TargetFilename> <!--Microsoft:Office:Word: Macro-->
			<TargetFilename name="flag=Info" condition="end with">proj</TargetFilename><!--Microsoft:MSBuild:Script: More information: https://twitter.com/subTee/status/885919612969394177-->
			<TargetFilename name="flag=Info" condition="end with">.sln</TargetFilename><!--Microsoft:MSBuild:Script: More information: https://twitter.com/subTee/status/885919612969394177-->
			<TargetFilename name="flag=Info,DefaultUserModified" condition="begin with">C:\Users\Default</TargetFilename> <!--Windows: Changes to default user profile-->
			<TargetFilename name="flag=Red" condition="begin with">C:\Windows\system32\Drivers</TargetFilename> <!--Microsoft: Drivers dropped here-->
			<TargetFilename name="flag=Red" condition="begin with">C:\Windows\SysWOW64\Drivers</TargetFilename> <!--Microsoft: Drivers dropped here-->
			<TargetFilename name="flag=Red,T1037,T1484" condition="begin with">C:\Windows\system32\GroupPolicy\Machine\Scripts</TargetFilename> <!--Group policy [ More information: http://www.hexacorn.com/blog/2017/01/07/beyond-good-ol-run-key-part-52/ ] -->
			<TargetFilename name="flag=Red,T1037,T1484" condition="begin with">C:\Windows\system32\GroupPolicy\User\Scripts</TargetFilename> <!--Group policy [ More information: http://www.hexacorn.com/blog/2017/01/07/beyond-good-ol-run-key-part-52/ ] -->
			<TargetFilename name="flag=Amber" condition="begin with">C:\Windows\system32\Wbem</TargetFilename> <!--Microsoft:WMI: [ More information: http://2014.hackitoergosum.org/slides/day1_WMI_Shell_Andrei_Dumitrescu.pdf ] -->
			<TargetFilename name="flag=Amber" condition="begin with">C:\Windows\SysWOW64\Wbem</TargetFilename> <!--Microsoft:WMI: [ More information: http://2014.hackitoergosum.org/slides/day1_WMI_Shell_Andrei_Dumitrescu.pdf ] -->
			<TargetFilename name="flag=Red" condition="begin with">C:\Windows\system32\WindowsPowerShell</TargetFilename> <!--Microsoft:Powershell: Look for modifications for persistence [ https://www.malwarearchaeology.com/cheat-sheets ] -->
			<TargetFilename name="flag=Red" condition="begin with">C:\Windows\SysWOW64\WindowsPowerShell</TargetFilename> <!--Microsoft:Powershell: Look for modifications for persistence [ https://www.malwarearchaeology.com/cheat-sheets ] -->
			<TargetFilename name="flag=Info,T1053" condition="begin with">C:\Windows\Tasks\</TargetFilename> <!--Microsoft:ScheduledTasks [ https://attack.mitre.org/wiki/Technique/T1053 ] -->
			<TargetFilename name="flag=Info,T1053" condition="begin with">C:\Windows\system32\Tasks</TargetFilename> <!--Microsoft:ScheduledTasks [ https://attack.mitre.org/wiki/Technique/T1053 ] -->
			<TargetFilename name="flag=Info,T1053" condition="begin with">C:\Windows\SysWOW64\Tasks</TargetFilename> <!--Microsoft:ScheduledTasks [ https://attack.mitre.org/wiki/Technique/T1053 ] -->
			<Image name="flag=Info" condition="begin with">\Device\HarddiskVolumeShadowCopy</Image> <!--Nothing should be executing from VSC | Credit: @SBousseaden [ https://twitter.com/SBousseaden/status/1133030955407630336 ] -->
			<!--Windows application compatibility-->
			<TargetFilename name="flag=Amber" condition="begin with">C:\Windows\AppPatch\Custom</TargetFilename> <!--Windows: Application compatibility shims [ https://www.fireeye.com/blog/threat-research/2017/05/fin7-shim-databases-persistence.html ] -->
			<TargetFilename name="flag=Amber" condition="contains">VirtualStore</TargetFilename> <!--Windows: UAC virtualization [ https://blogs.msdn.microsoft.com/oldnewthing/20150902-00/?p=91681 ] -->
			<!--Exploitable file names-->
			<TargetFilename name="flag=Amber" condition="end with">.xls</TargetFilename> <!--Legacy Office files are often used for attacks-->
			<TargetFilename name="flag=Amber" condition="end with">.ppt</TargetFilename> <!--Legacy Office files are often used for attacks-->
			<TargetFilename name="flag=Amber" condition="end with">.rtf</TargetFilename> <!--RTF files often 0day malware vectors when opened by Office-->
			<!--Appc shim-->
			<TargetFilename name="flag=Info,technique_id=T1546.011,technique_name=Application Shimming" condition="contains">C:\Windows\AppPatch\Custom</TargetFilename>
			<!--Batch files-->
			<TargetFilename name="flag=Info" condition="end with">.bat</TargetFilename> <!--Batch scripting-->
			<TargetFilename name="flag=Amber" condition="end with">.cmd</TargetFilename> <!--Batch scripting: Batch scripts can also use the .cmd extension | Credit: @mmazanec -->
			<!--chm files-->
			<TargetFilename name="flag=Info,technique_id=T1064,technique_name=Scripting" condition="end with">.chm</TargetFilename><!--Scripting, thanks to Darkoperator-->
			<!--Default profile changes-->
			<TargetFilename name="flag=Info" condition="begin with">C:\Users\Default</TargetFilename> <!--Microsoft:Windows: Changes to default user profile-->
			<!--Desktop-->
			<TargetFilename name="flag=Info" condition="contains">Desktop</TargetFilename> <!--Files on the Desktop-->
			<!--Dotnet-->
			<TargetFilename name="flag=Amber,technique_id=1218,technique_name=Office Signed Binary Proxy Execution" condition="contains">AppData\Local\Microsoft\CLR_v2.0\UsageLogs\</TargetFilename><!--Dotnet v2 binary started-->
			<TargetFilename name="flag=Info,technique_id=1218,technique_name=Office Signed Binary Proxy Execution" condition="end with">\UsageLogs\cscript.exe.log</TargetFilename> 
			<TargetFilename name="flag=Info,technique_id=1218,technique_name=Office Signed Binary Proxy Execution" condition="end with">\UsageLogs\wscript.exe.log</TargetFilename> 
			<TargetFilename name="flag=Info,technique_id=1218,technique_name=Office Signed Binary Proxy Execution" condition="end with">\UsageLogs\wmic.exe.log</TargetFilename> 
			<TargetFilename name="flag=Info,technique_id=1218,technique_name=Office Signed Binary Proxy Execution" condition="end with">\UsageLogs\mshta.exe.log</TargetFilename> 
			<TargetFilename name="flag=Info,technique_id=1218,technique_name=Office Signed Binary Proxy Execution" condition="end with">\UsageLogs\svchost.exe.log</TargetFilename> 
			<TargetFilename name="flag=Info,technique_id=1218,technique_name=Office Signed Binary Proxy Execution" condition="end with">\UsageLogs\regsvr32.exe.log</TargetFilename> 
			<TargetFilename name="flag=Info,technique_id=1218,technique_name=Office Signed Binary Proxy Execution" condition="end with">\UsageLogs\rundll32.exe.log</TargetFilename> 
			<!--Downloaded Files-->
			<TargetFilename name="flag=Amber" condition="contains">\Downloads\</TargetFilename> <!--Downloaded files. Does not include "Run" files in IE--> <!--PRIVACY WARNING-->
			<!--Drivers added-->
			<TargetFilename name="flag=Amber" condition="begin with">C:\Windows\System32\Drivers</TargetFilename> <!--Microsoft: Drivers dropped here-->
			<TargetFilename name="flag=Info" condition="begin with">C:\Windows\SysWOW64\Drivers</TargetFilename> <!--Microsoft: Drivers dropped here-->
			<!--Executables-->
			<TargetFilename name="flag=Info" condition="end with">.exe</TargetFilename> <!--Executable-->
			<!--Group Policy Changes-->
			<TargetFilename name="flag=Info" condition="begin with">C:\Windows\System32\GroupPolicy\Machine\Scripts</TargetFilename> <!--Group policy [ More information: http://www.hexacorn.com/blog/2017/01/07/beyond-good-ol-run-key-part-52/ ] -->
			<TargetFilename name="flag=Info" condition="begin with">C:\Windows\System32\GroupPolicy\User\Scripts</TargetFilename> <!--Group policy [ More information: http://www.hexacorn.com/blog/2017/01/07/beyond-good-ol-run-key-part-52/ ] -->
			<!--HTA Scripts-->
			<TargetFilename name="flag=Info,technique_id=T1218.005,technique_name=Mshta" condition="end with">.hta</TargetFilename><!--Scripting-->
			<!--ISO-->
			<TargetFilename name="flag=Info" condition="end with">.iso</TargetFilename><!--often ignored by AV/EDR but opens like a zip file in windows-->
      		<TargetFilename name="flag=Info" condition="end with">.img</TargetFilename><!--often ignored by AV/EDR but opens like a zip file in windows-->
			<!--Kirbi-->
			<TargetFilename name="flag=Red" condition="end with">.kirbi</TargetFilename><!--Mimikatz or kekeo default kerberos ticket file extention-->
			<!--Links-->
			<TargetFilename name="flag=Red,technique_id=T1187,technique_name=Forced Authentication" condition="end with">.lnk</TargetFilename> 
    		<TargetFilename name="flag=Red,technique_id=T1187,technique_name=Forced Authentication" condition="end with">.scf</TargetFilename>
			<!--Microsoft clickonce-->
			<TargetFilename name="flag=Info" condition="end with">.application</TargetFilename> <!--Microsoft:ClickOnce: [ https://blog.netspi.com/all-you-need-is-one-a-clickonce-love-story/ ] -->
			<TargetFilename name="flag=Info" condition="end with">.appref-ms</TargetFilename> <!--Microsoft:ClickOnce application | Credit @ion-storm -->
			<!--Microsoft Msbuild script-->
			<TargetFilename name="flag=Info,technique_id=T1127,technique_name=Trusted Developer Utilities Proxy Execution" condition="end with">.*proj</TargetFilename><!--Microsoft:MSBuild:Script More information: https://twitter.com/subTee/status/885919612969394177-->
			<TargetFilename name="flag=Info,technique_id=T1127,technique_name=Trusted Developer Utilities Proxy Execution" condition="end with">.sln</TargetFilename><!--Microsoft:MSBuild:Script More information: https://twitter.com/subTee/status/885919612969394177-->			
			<!--Microsoft setting content ms-->
			<TargetFilename name="flag=Info" condition="end with">.settingcontent-ms</TargetFilename> <!--Microsoft:Windows:SettingContent-MS (https://posts.specterops.io/the-tale-of-settingcontent-ms-files-f1ea253e4d39)-->
			<!--Microsoft Office documents with macros-->
			<TargetFilename name="flag=Amber" condition="end with">.docm</TargetFilename> <!--Microsoft:Office:Word: With Macro-->
			<TargetFilename name="flag=Amber" condition="end with">.pptm</TargetFilename> <!--Microsoft:Office:PowerPoint: With Macro-->
			<TargetFilename name="flag=Amber" condition="end with">.xlsm</TargetFilename> <!--Microsoft:Office:Excel: With Macro-->
			<TargetFilename name="flag=Amber" condition="end with">.xlm</TargetFilename> <!--Microsoft:Office:Excel: Legacy Excel With Macro-->
			<TargetFilename name="flag=Amber" condition="end with">.dotm</TargetFilename> <!--Microsoft:Office:Word: Template With Macro-->
			<TargetFilename name="flag=Amber" condition="end with">.xltm</TargetFilename> <!--Microsoft:Office:Excel: Template With Macro-->
			<TargetFilename name="flag=Amber" condition="end with">.potm</TargetFilename> <!--Microsoft:Office:PowerPoint: Template With Macro-->
			<TargetFilename name="flag=Amber" condition="end with">.ppsm</TargetFilename> <!--Microsoft:Office:PowerPoint: Slideshow With Macro-->
			<TargetFilename name="flag=Amber" condition="end with">.sldm</TargetFilename> <!--Microsoft:Office:PowerPoint: Slide With Macro-->
			<TargetFilename name="flag=Amber" condition="end with">.xlam</TargetFilename> <!--Microsoft:Office:Excel: Add-in Possibly With Macro-->
			<TargetFilename name="flag=Amber" condition="end with">.xla</TargetFilename> <!--Microsoft:Office:Excel: Add-in Possibly With Macro-->
			<!--Microsoft Office excel iqy slk-->
			<!--Info on how these are abused: https://www.vmray.com/cyber-security-blog/forgotten-ms-office-features-used-deliver-malware/-->
			<TargetFilename name="flag=Amber" condition="end with">.iqy</TargetFilename> <!--Microsoft:Office:Excel: IQY file used to pull down dropper-->
			<TargetFilename name="flag=Red" condition="end with">.slk</TargetFilename> <!--Microsoft:Office:Excel: SLK file used for command execution-->
			<!--Outlook attachments-->
			<TargetFilename name="flag=Info" condition="contains">\Content.Outlook\</TargetFilename> <!--Microsoft:Outlook: attachments--> <!--PRIVACY WARNING-->
			<!--Overlooked extensions-->
			<TargetFilename name="flag=Info" condition="end with">.rft</TargetFilename> 
			<TargetFilename name="flag=Info" condition="end with">.jsp</TargetFilename> 
			<TargetFilename name="flag=Info" condition="end with">.jspx</TargetFilename> 
			<TargetFilename name="flag=Info" condition="end with">.asp</TargetFilename> 
			<TargetFilename name="flag=Info" condition="end with">.aspx</TargetFilename> 
			<TargetFilename name="flag=Info" condition="end with">.php</TargetFilename> 
			<TargetFilename name="flag=Info" condition="end with">.war</TargetFilename>
			<TargetFilename name="flag=Info" condition="end with">.ace</TargetFilename><!-- https://www.bleepingcomputer.com/news/security/over-100-exploits-found-for-19-year-old-winrar-rce-bug/ -->
			<!--Powershell changes-->
			<TargetFilename name="flag=Amber,technique_id=T1059.001,technique_name=PowerShell" condition="begin with">C:\Windows\System32\WindowsPowerShell</TargetFilename> <!--Microsoft:Powershell: Look for modifications for persistence [ https://www.malwarearchaeology.com/cheat-sheets ] -->
			<TargetFilename name="flag=Amber,technique_id=T1059.001,technique_name=PowerShell" condition="begin with">C:\Windows\SysWOW64\WindowsPowerShell</TargetFilename> <!--Microsoft:Powershell: Look for modifications for persistence [ https://www.malwarearchaeology.com/cheat-sheets ] -->
			<!--Powershell scripts-->
			<TargetFilename name="flag=Amber,technique_id=T1059.001,technique_name=PowerShell" condition="end with">.ps1</TargetFilename> <!--PowerShell [ More information: http://www.hexacorn.com/blog/2014/08/27/beyond-good-ol-run-key-part-16/ ] -->
			<TargetFilename name="flag=Amber,technique_id=T1059.001,technique_name=PowerShell" condition="end with">.ps2</TargetFilename> <!--PowerShell -->
			<!--Python scripts-->
			<TargetFilename name="flag=Info" condition="end with">.py</TargetFilename> <!--Python [ More information: https://attack.mitre.org/wiki/Group/G0035 ] -->
			<TargetFilename name="flag=Info" condition="end with">.pyc</TargetFilename> <!--Python compiled code -->
           	<TargetFilename name="flag=Info" condition="end with">.pyw</TargetFilename> <!--Python script to be ran with console suppressed -->
			<!--Rundll32-->
			<Image name="flag=Info" condition="image">rundll32.exe</Image> <!-- Thanks to @c_APT-ure -->
			<!--Scheduled task changes-->
			<TargetFilename name="flag=Info" condition="begin with">C:\Windows\System32\Tasks</TargetFilename> <!--Mitre T1053--><!--Microsoft:ScheduledTasks-->
			<TargetFilename name="flag=Info" condition="begin with">C:\Windows\Tasks\</TargetFilename> <!--Mitre T1053--><!--Microsoft:ScheduledTasks-->
			<!--Start menu items-->
			<TargetFilename name="flag=Info" condition="contains">\Start Menu</TargetFilename> <!--Microsoft:Windows: Startup links and shortcut modification-->
			<!--Startup items-->
			<TargetFilename name="flag=Info" condition="contains">\Startup</TargetFilename> <!--Microsoft:Office: Changes to user's autoloaded files under AppData-->
			<!--System driver files-->
			<TargetFilename name="flag=Amber" condition="end with">.sys</TargetFilename> <!--System driver files-->
			<!--Taskmanager lsass-->
			<TargetFilename name="flag=Amber" condition="contains">\*lsass*.dmp\</TargetFilename> <!-- Capture LSASS dump from task manager -->
			<Image name="flag=Info" condition="image">taskmgr.exe</Image>
			<!--URL-->
			<TargetFilename name="flag=Info" condition="end with">.url</TargetFilename>
			<!--Visual Basic scripts-->
			<TargetFilename name="flag=Info" condition="end with">.vb</TargetFilename> <!--VisualBasicScripting files-->
			<TargetFilename name="flag=Info" condition="end with">.vbe</TargetFilename> <!--VisualBasicScripting files-->
			<TargetFilename name="flag=Info" condition="end with">.vbs</TargetFilename> <!--VisualBasicScripting files-->
			<!--WMI changes-->
			<TargetFilename name="flag=Amber,technique_id=T1047,technique_name=Windows Management Instrumentation" condition="begin with">C:\Windows\System32\Wbem</TargetFilename> <!--Microsoft:WMI: [ More information: http://2014.hackitoergosum.org/slides/day1_WMI_Shell_Andrei_Dumitrescu.pdf ] -->
			<TargetFilename name="flag=Amber,technique_id=T1047,technique_name=Windows Management Instrumentation" condition="begin with">C:\Windows\SysWOW64\Wbem</TargetFilename> <!--Microsoft:WMI: [ More information: http://2014.hackitoergosum.org/slides/day1_WMI_Shell_Andrei_Dumitrescu.pdf ] -->
      		<Image name="flag=Amber,technique_id=T1047,technique_name=Windows Management Instrumentation" condition="begin with">C:\WINDOWS\system32\wbem\scrcons.exe</Image> <!-- https://www.eideon.com/2018-03-02-THL03-WMIBackdoors/ -->
			<!--Writable folders-->
			<TargetFilename name="flag=Info,technique_id=T1546.008,technique_name=Services File Permissions Weakness" condition="begin with">C:\Windows\Temp\</TargetFilename> 
       		<TargetFilename name="flag=Info,technique_id=T1546.008,technique_name=Services File Permissions Weakness" condition="begin with">C:\Program\</TargetFilename>  
			<TargetFilename name="flag=Info,technique_id=T1047,technique_name=File System Permissions Weakness" condition="begin with">C:\Temp\</TargetFilename> 
			<TargetFilename name="flag=Info,technique_id=T1047,technique_name=File System Permissions Weakness" condition="begin with">C:\PerfLogs\</TargetFilename> 
			<TargetFilename name="flag=Info,technique_id=T1047,technique_name=File System Permissions Weakness" condition="begin with">C:\Users\Public\</TargetFilename> 
			<TargetFilename name="flag=Info,technique_id=T1047,technique_name=File System Permissions Weakness" condition="contains">\AppData\Temp\</TargetFilename>            

			<TargetFilename name="flag=Info" condition="contains">Roaming\Microsoft\Outlook\VbaProject.OTM</TargetFilename> <!--https://www.mdsec.co.uk/2020/11/a-fresh-outlook-on-mail-based-persistence/-->
     		<TargetFilename name="flag=Info" condition="end with">.rwz</TargetFilename> 
      		<TargetFilename name="flag=Info" condition="contains">Roaming\Microsoft\Outlook\Outlook.xml</TargetFilename><!--https://labs.f-secure.com/archive/malicous-outlook-rules/ works in combination with exclude_outlook_profile.xml -->
		
		</FileCreate>
	</RuleGroup>

	<RuleGroup name="" groupRelation="or">
		<FileCreate onmatch="exclude">
			<!--SECTION: Microsoft-->
			<Image name="flag=Info" condition="is">C:\Program Files (x86)\EMET 5.5\EMET_Service.exe</Image> <!--Microsoft:EMET: Writes to C:\Windows\AppPatch\-->
			<!--SECTION: Microsoft:Office:Click2Run-->
			<Image name="flag=Info" condition="is">C:\Program Files\Common Files\Microsoft Shared\ClickToRun\OfficeC2RClient.exe</Image> <!-- Microsoft:Office Click2Run-->
			<!--SECTION: Windows-->
			<Image name="flag=Info" condition="is">C:\Windows\system32\smss.exe</Image> <!-- Windows: Session Manager SubSystem: Creates swapfile.sys,pagefile.sys,hiberfile.sys-->
			<Image name="flag=Info" condition="is">C:\Windows\system32\CompatTelRunner.exe</Image> <!-- Windows: Windows 10 app, creates tons of cache files-->
			<Image name="flag=Info" condition="is">\\?\C:\Windows\system32\wbem\WMIADAP.EXE</Image> <!-- Windows: WMI Performance updates-->
			<Image name="flag=Info" condition="is">C:\Windows\system32\mobsync.exe</Image> <!--Windows: Network file syncing-->
			<TargetFilename name="flag=Info" condition="begin with">C:\Windows\system32\DriverStore\Temp\</TargetFilename> <!-- Windows: Temp files by DrvInst.exe-->
			<TargetFilename name="flag=Info" condition="begin with">C:\Windows\system32\wbem\Performance\</TargetFilename> <!-- Windows: Created in wbem by WMIADAP.exe-->
			<TargetFilename name="flag=Info" condition="begin with">C:\Windows\Installer\</TargetFilename> <!--Windows:Installer: Ignore MSI installer files caching-->
			<!--SECTION: Windows:Updates-->
			<TargetFilename name="flag=Info" condition="begin with">C:\$WINDOWS.~BT\Sources\</TargetFilename> <!-- Windows: Feature updates containing lots of .exe and .sys-->
			<Image name="flag=Info" condition="begin with">C:\Windows\winsxs\amd64_microsoft-windows</Image> <!-- Windows: Windows update-->

			<!--Added from Olaf-->
			<!--SECTION: Dell-->
			<Image name="flag=Info" condition="is">C:\Program Files (x86)\Dell\CommandUpdate\InvColPC.exe</Image>
			<!--SECTION: Intel-->
			<Image name="flag=Info" condition="is">C:\Windows\system32\igfxCUIService.exe</Image> <!--Intel: Drops bat and other files in \Windows in normal operation-->
			<!--Ivanti res-->
			<Image name="flag=Info" condition="is">C:\Program Files (x86)\Ivanti\Workspace Control\pfwsmgr.exe</Image>
            <Image name="flag=Info" condition="is">C:\Program Files (x86)\RES Software\Workspace Manager\pfwsmgr.exe</Image>
			<!--Microsoft services-->
			<Image name="flag=Info" condition="is">C:\Windows\System32\smss.exe</Image> <!-- Microsoft:Windows: Session Manager SubSystem: Creates swapfile.sys,pagefile.sys,hiberfile.sys-->
			<Image name="flag=Info" condition="is">C:\Windows\system32\CompatTelRunner.exe</Image> <!-- Microsoft:Windows: Windows 10 app, creates tons of cache files-->
			<Image name="flag=Info" condition="is">C:\Windows\system32\wbem\WMIADAP.EXE</Image> <!-- Microsoft:Windows: WMI Performance updates-->
			<TargetFilename name="flag=Info" condition="begin with">C:\Windows\System32\DriverStore\Temp\</TargetFilename> <!-- Microsoft:Windows: Temp files by DrvInst.exe-->
			<TargetFilename name="flag=Info" condition="begin with">C:\Windows\System32\wbem\Performance\</TargetFilename> <!-- Microsoft:Windows: Created in wbem by WMIADAP.exe-->
			<TargetFilename name="flag=Info" condition="end with">WRITABLE.TST</TargetFilename> <!-- Microsoft:Windows: Created in wbem by svchost-->
			<!--Microsoft windows recent files-->
			<TargetFilename name="flag=Info" condition="contains">\AppData\Roaming\Microsoft\Windows\Recent\</TargetFilename><!--Microsoft:Windows:RecentFiles-->
			<!--msdatp-->
			<Image name="flag=Info" condition="is">c:\Program Files\Microsoft Security Client\MsMpEng.exe</Image>
			<!--Provtool-->
			<!--SECTION: Microsoft:Windows-->
			<Image name="flag=Info" condition="is">c:\windows\system32\provtool.exe</Image> <!-- Microsoft:Windows:Provisioning package runtime processing tool -->
			<!--Sccm-->
			<Image name="flag=Info" condition="is">C:\WINDOWS\CCM\CcmExec.exe</Image>
      		<TargetFilename name="flag=Info" condition="begin with">C:\Windows\CCM</TargetFilename>
			<!--scheduled task noise-->
			<!--SECTION: Microsoft:Windows-->
			<TargetFilename name="flag=Info" condition="begin with">C:\Windows\System32\Tasks\Microsoft\Windows\PLA\FabricTraces</TargetFilename> <!-- Microsoft:Windows: -->
	    	<TargetFilename name="flag=Info" condition="begin with">C:\Windows\System32\Tasks\Microsoft\Windows\SoftwareProtectionPlatform\SvcRestartTask</TargetFilename> <!-- Microsoft:Windows: -->
			<TargetFilename name="flag=Info" condition="begin with">C:\Windows\System32\Tasks\Microsoft\Windows\Customer Experience Improvement Program\Server\ServerRoleUsageCollector</TargetFilename> <!-- Microsoft:Windows: Customer Experience Improvement Program-->
	  		<TargetFilename name="flag=Info" condition="begin with">C:\Windows\System32\Tasks\Microsoft\Windows\Customer Experience Improvement Program\Server\ServerCeipAssistant</TargetFilename> <!-- Microsoft:Windows: Customer Experience Improvement Program-->
			<!--svchost-->
			<Image name="flag=Info" condition="is">C:\WINDOWS\system32\svchost.exe</Image>

			<Rule groupRelation="and">
               <Image name="flag=Info" condition="image">Outlook.exe</Image><!--Outlook will write on every close, external tampering is still important-->
               <TargetFilename name="flag=Info" condition="contains">Roaming\Microsoft\Outlook\Outlook.xml</TargetFilename><!--https://labs.f-secure.com/archive/malicous-outlook-rules/-->
            </Rule>


		</FileCreate>
	</RuleGroup>

	<!--SYSMON EVENT ID 12 & 13 & 14 : REGISTRY MODIFICATION [RegistryEvent]-->
		<!--EVENT 12: "Registry object added or deleted"-->
		<!--EVENT 13: "Registry value set"-->
		<!--EVENT 14: "Registry objected renamed"-->

		<!--NOTE:	Windows writes hundreds or thousands of registry keys a minute, so just because you're not changing things, doesn't mean these rules aren't being run.-->
		<!--NOTE:	You do not have to spend a lot of time worrying about performance, CPUs are fast, but it's something to consider. Every rule and condition type has a small cost.-->
		<!--NOTE:	"contains" works by finding the first letter, then matching the second, etc, so the first letters should be as low-occurrence as possible.-->
		<!--NOTE:	[ https://attack.mitre.org/wiki/Technique/T1112 ] -->

		<!--TECHNICAL:	You cannot filter on the "Details" attribute, due to performance issues when very large keys are written, and variety of data formats-->
		<!--TECHNICAL:	Possible prefixes are HKLM, HKCR, and HKU-->
		<!--CRITICAL:	Schema version 3.30 and higher change HKLM\="\REGISTRY\MACHINE\" and HKU\="\REGISTRY\USER\" and HKCR\="\REGISTRY\MACHINE\SOFTWARE\Classes\" and CurrentControlSet="ControlSet001"-->
		<!--CRITICAL:	Due to a bug, Sysmon versions BEFORE 7.01 may not properly log with the new prefix style for registry keys that was originally introduced in schema version 3.30-->
		<!--NOTE:	Because Sysmon runs as a service, it has no filtering ability for, or concept of, HKCU or HKEY_CURRENT_USER. Use "contains" or "end with" to get around this limitation-->

		<!-- ! CRITICAL NOTE !:	It may appear this section is MISSING important entries, but SOME RULES MONITOR MANY KEYS, so look VERY CAREFULLY to see if something is already covered.
								Sysmon's wildcard monitoring along with highly-tuned generic strings cuts the rulesets down immensely, compared to doing this in other tools.
								For example, most COM hijacking in CLSID's across the registry is covered by a single rule monitoring a InProcServer32 wildcard-->

		<!--DATA: EventType, UtcTime, ProcessGuid, ProcessId, Image, TargetObject, Details (can't filter on), NewName (can't filter on)-->
	<RuleGroup name="" groupRelation="or">
		<RegistryEvent onmatch="include">
			<!--Autorun or Startups-->
				<!--ADDITIONAL REFERENCE: [ http://www.ghacks.net/2016/06/04/windows-automatic-startup-locations/ ] -->
				<!--ADDITIONAL REFERENCE: [ https://view.officeapps.live.com/op/view.aspx?src=https://arsenalrecon.com/downloads/resources/Registry_Keys_Related_to_Autorun.ods ] -->
				<!--ADDITIONAL REFERENCE: [ http://www.silentrunners.org/launchpoints.html ] -->
				<!--ADDITIONAL REFERENCE: [ https://www.microsoftpressstore.com/articles/article.aspx?p=2762082&seqNum=2 ] -->
				<!--ADDITIONAL REFERENCE: [ https://web.archive.org/web/20200116001643/http://scholarworks.rit.edu/cgi/viewcontent.cgi?article=1533&context=theses | Understanding malware autostart techniques - Matthew Gottlieb ] -->
			
			<TargetObject name="flag=Amber,technique_id=T1562.002,technique_name=Disable Windows Event Logging" condition="contains all">REGISTRY\MACHINE\SYSTEM\ControlSet001\Service\EventLog;Retention</TargetObject>
       		<TargetObject name="flag=Amber,technique_id=T1562.002,technique_name=Disable Windows Event Logging" condition="contains all">REGISTRY\MACHINE\SYSTEM\ControlSet001\Service\EventLog;MaxSize</TargetObject>
			<TargetObject name="flag=Info,technique_id=T1547.001,technique_name=Registry Run Keys / Start Folder" condition="contains">\CurrentVersion\Run</TargetObject><!--Microsoft:Windows: Run keys, incld RunOnce, RunOnceEx, RunServices, RunServicesOnce [Also covers terminal server] -->
			<TargetObject name="flag=Info,technique_id=T1547.001,technique_name=Registry Run Keys / Start Folder" condition="contains">\Policies\Explorer\Run</TargetObject><!--Microsoft:Windows -->
			<TargetObject name="flag=Info,technique_id=T1037,technique_name=Boot or Logon Initialization Scripts" condition="contains">\Windows\System\Scripts</TargetObject> <!--Microsoft:Windows: Logon, Loggoff, Shutdown-->
			<TargetObject name="flag=Amber,T1484" condition="contains">Group Policy\Scripts</TargetObject> <!--Windows: Group policy scripts-->
			<TargetObject name="flag=Amber,technique_id=T1037,technique_name=Logon Scripts" condition="contains">\Windows\System\Scripts</TargetObject> <!--Microsoft:Windows: Logon, Loggoff, Shutdown-->
			<TargetObject name="flag=Info,T1060" condition="contains">CurrentVersion\Windows\Load</TargetObject> <!--Windows: [ https://msdn.microsoft.com/en-us/library/jj874148.aspx ] -->
			<TargetObject name="flag=Info,T1060" condition="contains">CurrentVersion\Windows\Run</TargetObject> <!--Windows: [ https://msdn.microsoft.com/en-us/library/jj874148.aspx ] -->
			<TargetObject name="flag=Info,T1060" condition="contains">CurrentVersion\Winlogon\Shell</TargetObject> <!--Windows: [ https://msdn.microsoft.com/en-us/library/ms838576(v=winembedded.5).aspx ] -->
			<TargetObject name="flag=Amber,T1060" condition="contains">CurrentVersion\Winlogon\System</TargetObject> <!--Windows [ https://www.exterminate-it.com/malpedia/regvals/zlob-dns-changer/118 ] -->
			<TargetObject name="flag=Amber,technique_id=T1547.004,technique_name=Winlogon Helper DLL" condition="begin with">HKLM\SOFTWARE\Microsoft\Windows NT\CurrentVersion\Winlogon\Notify</TargetObject><!--Microsoft:Windows: Autorun location [ https://www.cylance.com/windows-registry-persistence-part-2-the-run-keys-and-search-order ] -->
			<TargetObject name="flag=Amber,technique_id=T1547.004,technique_name=Winlogon Helper DLL" condition="begin with">HKLM\SOFTWARE\Microsoft\Windows NT\CurrentVersion\Winlogon\Userinit</TargetObject> <!--Microsoft:Windows: Autorun location [ https://www.cylance.com/windows-registry-persistence-part-2-the-run-keys-and-search-order ] -->
      		<TargetObject name="flag=Amber,technique_id=T1547.004,technique_name=Winlogon Helper DLL" condition="begin with">HKLM\SOFTWARE\Microsoft\Windows NT\CurrentVersion\Winlogon\Shell</TargetObject>
			<TargetObject name="flag=Info" condition="begin with">HKLM\Software\WOW6432Node\Microsoft\Windows NT\CurrentVersion\Drivers32</TargetObject> <!--Windows: Legacy driver loading | Credit @ion-storm -->
			<TargetObject name="flag=Info,technique_id=T1547.001,technique_name=Registry Run Keys / Start Folder" condition="begin with">HKLM\SYSTEM\CurrentControlSet\Control\Session Manager\BootExecute</TargetObject> <!--Microsoft:Windows: Autorun | Credit @ion-storm | [ https://www.cylance.com/windows-registry-persistence-part-2-the-run-keys-and-search-order ] -->
			<TargetObject name="flag=Amber,technique_id=T1546.001,technique_name=Change Default File Association" condition="contains">\Explorer\FileExts</TargetObject><!--Microsoft:Windows: Changes to file extension mapping-->
			<TargetObject name="flag=Amber" condition="begin with">HKLM\Software\Microsoft\Windows NT\CurrentVersion\AeDebug</TargetObject> <!--Windows: Automatic program crash debug program [ https://www.symantec.com/security_response/writeup.jsp?docid=2007-050712-5453-99&tabid=2 ] -->
			<TargetObject name="flag=Info" condition="contains">UserInitMprLogonScript</TargetObject> <!--Windows: Legacy logon script environment variable [ http://www.hexacorn.com/blog/2014/11/14/beyond-good-ol-run-key-part-18/ ] -->
			<TargetObject name="flag=Info,T1112,ChangeStartupFolderPath" condition="end with">user shell folders\startup</TargetObject> <!--Monitor changes to Startup folder location for monitoring evasion | Credit @SBousseaden-->
			<TargetObject name="flag=Amber" condition="contains">\shell\install\command</TargetObject> <!--Microsoft:Windows: Sensitive subkey under file associations and CLSID that map to launch command-->
			<TargetObject name="flag=Amber" condition="contains">\shell\open\command</TargetObject> <!--Microsoft:Windows: Sensitive subkey under file associations and CLSID that map to launch command-->
			<TargetObject name="flag=Info" condition="contains">\shell\open\ddeexec</TargetObject> <!--Microsoft:Windows: Sensitive subkey under file associations and CLSID that map to launch command-->
			<TargetObject name="flag=Info,technique_id=T1547.001,technique_name=Registry Run Keys / Start Folder" condition="contains">Software\Microsoft\Windows\CurrentVersion\Explorer\User Shell Folders\Startup</TargetObject>
			<!--Services-->
			<TargetObject name="flag=Info,T1031,T1050" condition="end with">\ServiceDll</TargetObject> <!--Windows: Points to a service's DLL [ https://blog.cylance.com/windows-registry-persistence-part-1-introduction-attack-phases-and-windows-services ] -->
			<TargetObject name="flag=Info,T1031,T1050" condition="end with">\ServiceManifest</TargetObject> <!--Windows: Manifest pointing to service's DLL [ https://www.geoffchappell.com/studies/windows/win32/services/svchost/index.htm ] -->
			<TargetObject name="flag=Info,T1031,T1050" condition="end with">\ImagePath</TargetObject> <!--Windows: Points to a service's EXE [ https://attack.mitre.org/wiki/Technique/T1050 ] -->
			<TargetObject name="flag=Info,T1031,T1050" condition="end with">\Start</TargetObject> <!--Windows: Services start mode changes (Disabled, Automatically, Manual)-->
			<!--RDP-->
			<TargetObject name="flag=Amber,RDP port change" condition="end with">Control\Terminal Server\WinStations\RDP-Tcp\PortNumber</TargetObject> <!--Windows: RDP port change under Control [ https://blog.menasec.net/2019/02/of-rdp-hijacking-part1-remote-desktop.html ]-->
			<TargetObject name="flag=Red,RDP port change" condition="end with">Control\Terminal Server\fSingleSessionPerUser</TargetObject> <!--Windows: Allow same user to have mutliple RDP sessions, to hide from admin being impersonated-->
			<TargetObject name="flag=Red,ModifyRemoteDesktopState" condition="end with">fDenyTSConnections</TargetObject> <!--Windows: Attacker turning on RDP-->
			<TargetObject name="flag=Amber" condition="end with">LastLoggedOnUser</TargetObject> <!--Windows: Changing last-logged in user-->
			<TargetObject name="flag=Red,ModifyRemoteDesktopPort" condition="end with">RDP-tcp\PortNumber</TargetObject> <!--Windows: Changing RDP port to evade IDS-->
			<TargetObject name="flag=Red" condition="end with">Services\PortProxy\v4tov4</TargetObject> <!--Windows: Changing RDP port to evade IDS-->
			<!--CLSID launch commands and Default File Association changes-->
			<TargetObject name="flag=Info,T1042" condition="contains">\command\</TargetObject> <!--Windows: Sensitive sub-key under file associations and CLSID that map to launch command-->
			<TargetObject name="flag=Info,T1122" condition="contains">\ddeexec\</TargetObject> <!--Windows: Sensitive sub-key under file associations and CLSID that map to launch command-->
			<TargetObject name="flag=Info,T1122" condition="contains">{86C86720-42A0-1069-A2E8-08002B30309D}</TargetObject> <!--Windows: Tooltip handler-->
			<TargetObject name="flag=Info,T1042" condition="contains">exefile</TargetObject> <!--Windows Executable handler, to log any changes not already monitored-->
			<!--Windows COM-->
			<TargetObject name="flag=Amber,T1122" condition="end with">\InprocServer32\(Default)</TargetObject> <!--Windows:COM Object Hijacking [ https://blog.gdatasoftware.com/2014/10/23941-com-object-hijacking-the-discreet-way-of-persistence ] | Credit @ion-storm -->
			<!--Windows shell visual modifications used by malware-->
			<TargetObject name="flag=Red,T1158" condition="end with">\Hidden</TargetObject> <!--Windows:Explorer: Some types of malware try to hide their hidden system files from the user, good signal event -->
			<TargetObject name="flag=Red,T1158" condition="end with">\ShowSuperHidden</TargetObject> <!--Windows:Explorer: Some types of malware try to hide their hidden system files from the user, good signal event [ Example: https://www.symantec.com/security_response/writeup.jsp?docid=2007-061811-4341-99&tabid=2 ] -->
			<TargetObject name="flag=Red,T1158" condition="end with">\HideFileExt</TargetObject> <!--Windows:Explorer: Some malware hides file extensions to make diagnosis/disinfection more daunting to novice users -->
			<!--Windows shell hijack and modifications-->
			<TargetObject name="flag=Info" condition="contains">Classes\*\</TargetObject> <!--Windows:Explorer: [ http://www.silentrunners.org/launchpoints.html ] -->
			<TargetObject name="flag=Info" condition="contains">Classes\AllFilesystemObjects\</TargetObject> <!--Windows:Explorer: [ http://www.silentrunners.org/launchpoints.html ] -->
			<TargetObject name="flag=Info" condition="contains">Classes\Directory\</TargetObject> <!--Windows:Explorer: [ https://stackoverflow.com/questions/1323663/windows-shell-context-menu-option ] -->
			<TargetObject name="flag=Info" condition="contains">Classes\Drive\</TargetObject> <!--Windows:Explorer: [ https://stackoverflow.com/questions/1323663/windows-shell-context-menu-option ] -->
			<TargetObject name="flag=Info" condition="contains">Classes\Folder\</TargetObject> <!--Windows:Explorer: ContextMenuHandlers, DragDropHandlers, CopyHookHandlers, [ https://stackoverflow.com/questions/1323663/windows-shell-context-menu-option ] -->
			<TargetObject name="flag=Info" condition="contains">Classes\PROTOCOLS\</TargetObject> <!--Windows:Explorer: Protocol handlers-->
			<TargetObject name="flag=Info" condition="contains">ContextMenuHandlers\</TargetObject> <!--Windows: [ http://oalabs.openanalysis.net/2015/06/04/malware-persistence-hkey_current_user-shell-extension-handlers/ ] -->
			<TargetObject name="flag=Info" condition="contains">CurrentVersion\Shell</TargetObject> <!--Windows: Shell Folders, ShellExecuteHooks, ShellIconOverloadIdentifers, ShellServiceObjects, ShellServiceObjectDelayLoad [ http://oalabs.openanalysis.net/2015/06/04/malware-persistence-hkey_current_user-shell-extension-handlers/ ] -->
			<TargetObject name="flag=Info" condition="begin with">HKLM\Software\Microsoft\Windows\CurrentVersion\explorer\ShellExecuteHooks</TargetObject> <!--Windows: ShellExecuteHooks-->
			<TargetObject name="flag=Info" condition="begin with">HKLM\Software\Microsoft\Windows\CurrentVersion\explorer\ShellServiceObjectDelayLoad</TargetObject> <!--Windows: ShellExecuteHooks-->
			<TargetObject name="flag=Info" condition="begin with">HKLM\Software\Microsoft\Windows\CurrentVersion\explorer\ShellIconOverlayIdentifiers</TargetObject> <!--Windows: ShellExecuteHooks-->
			<!--AppPaths hijacking-->
			<TargetObject name="flag=Info" condition="begin with">HKLM\Software\Microsoft\Windows\CurrentVersion\App Paths\</TargetObject> <!--Windows: Credit to @Hexacorn [ http://www.hexacorn.com/blog/2013/01/19/beyond-good-ol-run-key-part-3/ ] -->
			<!--Terminal service boobytrap-->
			<TargetObject name="flag=Amber" condition="begin with">HKLM\SYSTEM\CurrentControlSet\Control\Terminal Server\WinStations\RDP-Tcp\InitialProgram</TargetObject> <!--Windows:RDP: Note other Terminal Server run keys are handled by another wildcard already-->
			<!--Group Policy integrity-->
			<TargetObject name="flag=Red,T1484" condition="begin with">HKLM\Software\Microsoft\Windows NT\CurrentVersion\Winlogon\GPExtensions\</TargetObject> <!--Windows: Group Policy internally uses a plug-in architecture that nothing should be modifying-->
			<!--Winsock and Winsock2-->
			<TargetObject name="flag=Info" condition="begin with">HKLM\SYSTEM\CurrentControlSet\Services\WinSock</TargetObject> <!--Windows: Wildcard, includes Winsock and Winsock2-->
			<TargetObject name="flag=Info" condition="end with">\ProxyServer</TargetObject> <!--Windows: System and user proxy server-->
			<!--Credential providers-->
			<TargetObject name="flag=Red" condition="begin with">HKLM\Software\Microsoft\Windows\CurrentVersion\Authentication\Credential Provider</TargetObject> <!--Wildcard, includes Credential Providers and Credential Provider Filters-->
			<TargetObject name="flag=Info,technique_id=T1547.002,technique_name=Authentication Package" condition="begin with">HKLM\SYSTEM\CurrentControlSet\Control\Lsa\Authentication</TargetObject>
          	<TargetObject name="flag=Info,technique_id=T1547.002,technique_name=Authentication Package" condition="begin with">HKLM\SYSTEM\CurrentControlSet\Control\Lsa\RunAsPPL</TargetObject><!--When set, forces and dll loaded by lsass to be MS signed, monitor for change-->
			<TargetObject name="flag=Red" condition="begin with">HKLM\SYSTEM\CurrentControlSet\Control\SecurityProviders\</TargetObject> <!--Windows: Changes to WDigest-UseLogonCredential for password scraping [ https://www.trustedsec.com/april-2015/dumping-wdigest-creds-with-meterpreter-mimikatzkiwi-in-windows-8-1/ ] -->
			<TargetObject name="flag=Info" condition="begin with">HKLM\Software\Microsoft\Netsh</TargetObject> <!--Windows: Netsh helper DLL [ https://attack.mitre.org/wiki/Technique/T1128 ] -->
			<!--Networking-->
			<TargetObject name="flag=Red,T1089" condition="end with">\EnableFirewall</TargetObject> <!--Windows: Monitor for firewall disablement, all firewall profiles [ https://attack.mitre.org/wiki/Technique/T1089 ] -->
			<TargetObject name="flag=Red,T1089" condition="end with">\DoNotAllowExceptions</TargetObject> <!--Windows: Monitor for firewall disablement, all firewall profiles [ https://attack.mitre.org/wiki/Technique/T1089 ] -->
			<TargetObject name="flag=Info" condition="begin with">HKLM\SYSTEM\CurrentControlSet\Services\SharedAccess\Parameters\FirewallPolicy\StandardProfile\AuthorizedApplications\List</TargetObject> <!--Windows Firewall authorized applications for all networks| Credit @ion-storm -->
			<TargetObject name="flag=Info" condition="begin with">HKLM\SYSTEM\CurrentControlSet\Services\SharedAccess\Parameters\FirewallPolicy\DomainProfile\AuthorizedApplications\List</TargetObject> <!--Windows Firewall authorized applications for domain networks -->
			<!--DLLs that get injected into every process at launch-->
			<TargetObject name="flag=Amber,T1103" condition="begin with">HKLM\Software\Microsoft\Windows NT\CurrentVersion\Windows\Appinit_Dlls</TargetObject> <!--Windows: Feature disabled by default [ https://attack.mitre.org/wiki/Technique/T1103 ] -->
			<TargetObject name="flag=Info,T1103" condition="begin with">HKLM\Software\Wow6432Node\Microsoft\Windows NT\CurrentVersion\Windows\Appinit_Dlls</TargetObject> <!--Windows: Feature disabled by default [ https://attack.mitre.org/wiki/Technique/T1103 ] -->
			<TargetObject name="flag=Info" condition="begin with">HKLM\SYSTEM\CurrentControlSet\Control\Session Manager\AppCertDlls\</TargetObject> <!--Windows: Credit to @Hexacorn [ http://www.hexacorn.com/blog/2013/01/19/beyond-good-ol-run-key-part-3/ ] [ https://blog.comodo.com/malware/trojware-win32-trojanspy-volisk-a/ ] -->
			<!--Office-->
			<TargetObject name="flag=Amber,T1137" condition="contains">Microsoft\Office\Outlook\Addins\</TargetObject> <!--Microsoft:Office: Outlook add-ins, access to sensitive data and often cause issues-->
			<TargetObject name="flag=Amber,T1137" condition="contains">Office Test\</TargetObject> <!-- Microsoft:Office: Persistence method [ http://www.hexacorn.com/blog/2014/04/16/beyond-good-ol-run-key-part-10/ ] | Credit @Hexacorn -->
			<TargetObject name="flag=Info,Context,ProtectedModeExitOrMacrosUsed" condition="contains">Security\Trusted Documents\TrustRecords</TargetObject> <!--Microsoft:Office: Monitor when "Enable editing" or "Enable macros" is used | Credit @OutflankNL | [ https://outflank.nl/blog/2018/01/16/hunting-for-evil-detect-macros-being-executed/ ] -->
			<!--IE-->
			<TargetObject name="flag=Info,T1176" condition="contains">Internet Explorer\Toolbar\</TargetObject> <!--Microsoft:InternetExplorer: Machine and user [ Example: https://www.exterminate-it.com/malpedia/remove-mywebsearch ] -->
			<TargetObject name="flag=Info,T1176" condition="contains">Internet Explorer\Extensions\</TargetObject> <!--Microsoft:InternetExplorer: Machine and user [ Example: https://www.exterminate-it.com/malpedia/remove-mywebsearch ] -->
			<TargetObject name="flag=Info,T1176" condition="contains">Browser Helper Objects\</TargetObject> <!--Microsoft:InternetExplorer: Machine and user [ https://msdn.microsoft.com/en-us/library/bb250436(v=vs.85).aspx ] -->
			<TargetObject name="flag=Amber" condition="end with">\DisableSecuritySettingsCheck</TargetObject>
			<TargetObject name="flag=Info" condition="end with">\3\1206</TargetObject> <!--Microsoft:InternetExplorer: Malware sometimes assures scripting is on in Internet Zone [ https://support.microsoft.com/en-us/help/182569/internet-explorer-security-zones-registry-entries-for-advanced-users ] -->
			<TargetObject name="flag=Amber" condition="end with">\3\2500</TargetObject> <!--Microsoft:InternetExplorer: Malware sometimes disables Protected Mode in Internet Zone [ https://blog.avast.com/2013/08/12/your-documents-are-corrupted-from-image-to-an-information-stealing-trojan/ ] -->
			<TargetObject name="flag=Amber" condition="end with">\3\1809</TargetObject> <!--Microsoft:InternetExplorer: Malware sometimes disables Pop-up Blocker in Internet Zone [ https://support.microsoft.com/en-us/help/182569/internet-explorer-security-zones-registry-entries-for-advanced-users ] -->
			<!--Magic registry keys-->
			<TargetObject name="flag=Info" condition="begin with">HKLM\Software\Classes\CLSID\{AB8902B4-09CA-4BB6-B78D-A8F59079A8D5}\</TargetObject> <!--Windows: Thumbnail cache autostart [ http://blog.trendmicro.com/trendlabs-security-intelligence/poweliks-levels-up-with-new-autostart-mechanism/ ] -->
			<TargetObject name="flag=Info" condition="begin with">HKLM\Software\Classes\WOW6432Node\CLSID\{AB8902B4-09CA-4BB6-B78D-A8F59079A8D5}\</TargetObject> <!--Windows: Thumbnail cache autostart [ http://blog.trendmicro.com/trendlabs-security-intelligence/poweliks-levels-up-with-new-autostart-mechanism/ ] -->
			<TargetObject name="flag=Info" condition="begin with">HKLM\Software\Classes\CLSID\{083863F1-70DE-11d0-BD40-00A0C911CE86}\</TargetObject> <!--Windows: DirectX instances-->
			<TargetObject name="flag=Info" condition="begin with">HKLM\Software\Classes\WOW6432Node\CLSID\{083863F1-70DE-11d0-BD40-00A0C911CE86}\</TargetObject> <!--Windows: DirectX instances-->
			<!--Install/Run artifacts-->
			<TargetObject name="flag=Info" condition="end with">\UrlUpdateInfo</TargetObject> <!--Microsoft:ClickOnce: Source URL is stored in this value [ https://subt0x10.blogspot.com/2016/12/mimikatz-delivery-via-clickonce-with.html ] -->
			<TargetObject name="flag=Info" condition="end with">\InstallSource</TargetObject> <!--Windows: Source folder for certain program and component installations-->
			<TargetObject name="flag=Info,Alert,Sysinternals Tool Used" condition="end with">\EulaAccepted</TargetObject> <!--Sysinternals tool launched. Lots of useful abilities for attackers -->
			<!--Antivirus tampering-->
			<TargetObject name="flag=Red,T1089,Tamper-Defender" condition="end with">\DisableAntiSpyware</TargetObject> <!--Windows:Defender: State modified via registry-->
			<TargetObject name="flag=Red,T1089,Tamper-Defender" condition="end with">\DisableAntiVirus</TargetObject> <!--Windows:Defender: State modified via registry-->
			<TargetObject name="flag=Red,T1089,Tamper-Defender" condition="end with">\SpynetReporting</TargetObject> <!--Windows:Defender: State modified via registry-->
			<TargetObject name="flag=Red,T1089,Tamper-Defender" condition="end with">DisableRealtimeMonitoring</TargetObject> <!--Windows:Defender: State modified via registry-->
			<TargetObject name="flag=Red,T1089,Tamper-Defender" condition="end with">\SubmitSamplesConsent</TargetObject> <!--Windows:Defender: State modified via registry-->
			<!--Windows UAC tampering-->
			<TargetObject name="flag=Info,T1088" condition="end with">HKLM\Software\Microsoft\Windows\CurrentVersion\Policies\System\EnableLUA</TargetObject> <!--Detect: UAC Tampering | Credit @ion-storm -->
			<TargetObject name="flag=Info,T1088" condition="end with">HKLM\Software\Microsoft\Windows\CurrentVersion\Policies\System\LocalAccountTokenFilterPolicy</TargetObject> <!--Detect: UAC Tampering | Credit @ion-storm -->
			<!--Microsoft Security Center tampering | Credit @ion-storm -->
			<TargetObject name="flag=Info,T1089,Tamper-SecCenter" condition="end with">HKLM\Software\Microsoft\Security Center\</TargetObject> <!-- [ https://attack.mitre.org/wiki/Technique/T1089 ] -->
			<TargetObject name="flag=Info,T1089,Tamper-SecCenter" condition="end with">SOFTWARE\Microsoft\Windows\CurrentVersion\Policies\Explorer\HideSCAHealth</TargetObject> <!--Windows:Security Center: Malware sometimes disables [ https://blog.avast.com/2013/08/12/your-documents-are-corrupted-from-image-to-an-information-stealing-trojan/ ] -->
			<!--Windows application compatibility-->
			<TargetObject name="flag=Amber,T1546.011,AppCompatShim" condition="begin with">HKLM\Software\Microsoft\Windows NT\CurrentVersion\AppCompatFlags\Custom</TargetObject> <!--Windows: AppCompat [ https://www.fireeye.com/blog/threat-research/2017/05/fin7-shim-databases-persistence.html ] -->
			<TargetObject name="flag=Amber,T1546.011,AppCompatShim" condition="begin with">HKLM\Software\Microsoft\Windows NT\CurrentVersion\AppCompatFlags\InstalledSDB</TargetObject> <!--Windows: AppCompat [ https://attack.mitre.org/wiki/Technique/T1138 ] -->
			<TargetObject name="flag=Amber" condition="contains">VirtualStore</TargetObject> <!--Windows: Registry virtualization, something's wrong if it's in use [ https://msdn.microsoft.com/en-us/library/windows/desktop/aa965884(v=vs.85).aspx ] -->
			<!--Windows internals integrity monitoring-->
			<TargetObject name="flag=Red,T1183,IFEO" condition="begin with">HKLM\Software\Microsoft\Windows NT\CurrentVersion\Image File Execution Options\</TargetObject> <!--Windows: Malware likes changing IFEO, like adding Debugger to disable antivirus EXE-->
			<TargetObject name="flag=Info" condition="begin with">HKLM\Software\Microsoft\Windows\CurrentVersion\WINEVT\</TargetObject> <!--Windows: Event log system integrity and ACLs-->
			<TargetObject name="flag=Red,Tamper-Safemode" condition="begin with">HKLM\SYSTEM\CurrentControlSet\Control\Safeboot\</TargetObject> <!--Windows: Services approved to load in safe mode. Almost nothing should ever modify this.-->
			<TargetObject name="flag=Red,Tamper-Winlogon" condition="begin with">HKLM\SYSTEM\CurrentControlSet\Control\Winlogon\</TargetObject> <!--Windows: Providers notified by WinLogon-->
			<TargetObject name="flag=Info,Context,DeviceConntectedOrUpdated" condition="end with">\FriendlyName</TargetObject> <!--Windows: New devices connected and remembered-->
			<TargetObject name="flag=Info,Context,MsiInstallerStarted" condition="is">HKLM\Software\Microsoft\Windows\CurrentVersion\Installer\InProgress\(Default)</TargetObject> <!--Windows: See when WindowsInstaller is engaged, useful for timeline matching with other events-->
			<TargetObject name="flag=Red,Tamper-Tracing" condition="begin with">HKLM\Software\Microsoft\Tracing\RASAPI32</TargetObject> <!--Windows: Malware sometimes disables tracing to obfuscate tracks-->
			<!--Windows inventory events-->
			<TargetObject name="flag=Info,InvDB-Path" condition="end with">\LowerCaseLongPath</TargetObject> <!-- [ https://binaryforay.blogspot.com/2017/10/amcache-still-rules-everything-around.html ] -->
			<TargetObject name="flag=Info,InvDB-Pub" condition="end with">\Publisher</TargetObject> <!-- [ https://binaryforay.blogspot.com/2017/10/amcache-still-rules-everything-around.html ] -->
			<TargetObject name="flag=Info,InvDB-Ver" condition="end with">\BinProductVersion</TargetObject> <!-- [ https://docs.microsoft.com/en-us/windows/privacy/basic-level-windows-diagnostic-events-and-fields-1709 ] -->
			<TargetObject name="flag=Info,InvDB-DriverVer" condition="end with">\DriverVersion</TargetObject> <!-- [ https://df-stream.com/2015/02/leveraging-devicecontainers-key/ ] -->
			<TargetObject name="flag=Info,InvDB-DriverVer" condition="end with">\DriverVerVersion</TargetObject> <!-- [ https://df-stream.com/2015/02/leveraging-devicecontainers-key/ ] -->
			<TargetObject name="flag=Info,InvDB-CompileTimeClaim" condition="end with">\LinkDate</TargetObject> <!-- Compile time of EXE, may not be reliable [ https://en.wikipedia.org/wiki/Link_time ] -->
			<TargetObject name="flag=Info,InvDB" condition="contains">Compatibility Assistant\Store\</TargetObject> <!-- Inventory -->
			<!--Suspicious sources-->
			<Image name="flag=Info,Suspicious,ImageBeginWithBackslash" condition="begin with">\</Image> <!--Devices and VSC shouldn't be executing changes | Credit: @SBousseaden @ionstorm @neu5ron @PerchedSystems [ https://twitter.com/SwiftOnSecurity/status/1133167323991486464 ] -->
			<!--Added from Olaf-->
			<!--Accessibility Features-->
			<TargetObject name="flag=Amber,technique_id=T1015,technique_name=Accessibility Features" condition="is">HKLM\SOFTWARE\Microsoft\Windows NT\CurrentVersion\Image File Execution Options</TargetObject>
			<!--Appc Shim-->
			<TargetObject name="flag=Amber,technique_id=T1546.011,technique_name=Application Shimming" condition="contains">HKLM\SOFTWARE\Microsoft\Windows NT\CurrentVersion\AppCompatFlags\InstalledSDB</TargetObject>
      	    <TargetObject name="flag=Info,technique_id=T1546.011,technique_name=Application Shimming" condition="contains">HKLM\SOFTWARE\Microsoft\Windows NT\CurrentVersion\AppCompatFlags\Custom</TargetObject>
			<!--Authen package-->
			<TargetObject name="flag=Red,technique_id=T1547.002,technique_name=Authentication Package" condition="begin with">HKLM\SYSTEM\CurrentControlSet\Control\Lsa</TargetObject>
			<!--bypass uac-->
			<TargetObject name="flag=Red,technique_id=T1548.002,technique_name=Bypass User Access Control" condition="contains">\mscfile\shell\open\command</TargetObject>
		    <TargetObject name="flag=Info,technique_id=T1548.002,technique_name=Bypass User Access Control" condition="contains">ms-settings\shell\open\command</TargetObject>
      	    <TargetObject name="flag=Info,technique_id=T1548.002,technique_name=Bypass User Access Control" condition="contains">Classes\exefile\shell\runas\command\isolatedCommand</TargetObject> <!-- Credit cyb3rop -->
			<!--Component Hijack-->
			<TargetObject name="flag=Amber,technique_id=T1546.015,technique_name=Component Object Model Hijacking" condition="contains">Software\Classes\CLSID</TargetObject><!--Appears in HKLM and HKCU-->
			<!--diasble pw change-->
			<TargetObject name="flag=Red,technique_id=T1098,technique_name=Account Manipulation" condition="contains">\services\Netlogon\Parameters\DisablePasswordChange</TargetObject>
			<!--dll injection at process launch-->
			<TargetObject name="flag=Info,technique_id=T1546.010,technique_name=Appinit DLLs" condition="begin with">HKLM\SOFTWARE\Microsoft\Windows NT\CurrentVersion\Windows\Appinit_Dlls</TargetObject><!--Microsoft:Windows: [ https://msdn.microsoft.com/en-us/library/windows/desktop/dd744762(v=vs.85).aspx ] -->
			<TargetObject name="flag=Info,technique_id=T1546.010,technique_name=Appinit DLLs" condition="begin with">HKLM\SOFTWARE\Wow6432Node\Microsoft\Windows NT\CurrentVersion\Windows\Appinit_Dlls</TargetObject><!--Microsoft:Windows: [ https://msdn.microsoft.com/en-us/library/windows/desktop/dn280412(v=vs.85).aspx ] -->
			<!--dns server dll injection-->
			<TargetObject name="flag=Red,technique_id=T1546.010,technique_name=Appinit DLLs" condition="is">REGISTRY\MACHINE\SYSTEM\ControlSet001\Services\DNS\Parameters\ServerLevelPluginDll</TargetObject>
			<!--dotnet ETW tampering-->
			<TargetObject name="flag=Info,technique_id=T1562.006,technique_name=Impair Defenses - Indicator Blocking" condition="end with">SOFTWARE\Microsoft\.NETFramework\ETWEnabled</TargetObject> <!-- @Cyb3rWard0g and  https://twitter.com/_xpn_/status/1268712093928378368-->
	
			<TargetObject name="flag=Amber,technique_id=T1562.002,technique_name=Disable Windows Event Logging" condition="contains all">REGISTRY\MACHINE\SYSTEM\ControlSet001\Service\EventLog;Retention</TargetObject>
         	<TargetObject name="flag=Amber,technique_id=T1562.002,technique_name=Disable Windows Event Logging" condition="contains all">REGISTRY\MACHINE\SYSTEM\ControlSet001\Service\EventLog;MaxSize</TargetObject>
			<!--Group Policy integrity-->
			<TargetObject name="flag=Info" condition="begin with">HKLM\SOFTWARE\Microsoft\Windows NT\CurrentVersion\Winlogon\GPExtensions</TargetObject> <!--Microsoft:Windows: Group Policy internally uses a plugin architecture that nothing should be modifying-->
			<!--image file exec options-->
			<TargetObject name="flag=Amber,technique_id=T1546.012,technique_name=Image File Execution Options Injection" condition="begin with">HKLM\Software\Microsoft\Windows NT\CurrentVersion\Image File Execution Options</TargetObject>
  			<TargetObject name="flag=Amber,technique_id=T1546.012,technique_name=Image File Execution Options Injection" condition="begin with">HKLM\SOFTWARE\Wow6432Node\Microsoft\Windows NT\CurrentVersion\Image File Execution Options</TargetObject>
			<!--Internet Explorer extentions helpers or toolbars-->
			<TargetObject name="flag=Info" condition="contains">\Internet Explorer\Toolbar</TargetObject> <!--Microsoft:InternetExplorer: Machine and user-->
			<TargetObject name="flag=Info" condition="contains">\Internet Explorer\Extensions</TargetObject> <!--Microsoft:InternetExplorer: Machine and user-->
			<TargetObject name="flag=Info" condition="contains">\Browser Helper Objects</TargetObject> <!--Microsoft:InternetExplorer: Machine and user [ https://msdn.microsoft.com/en-us/library/bb250436(v=vs.85).aspx ] -->
			<!--local port monitor-->
			<TargetObject name="flag=Amber,technique_id=Port Monitors,technique_name=Port Monitors" condition="begin with">HKLM\SYSTEM\CurrentControlSet\Control\Print\Monitors</TargetObject>
			<!--netsh-->
			<TargetObject name="flag=Amber,technique_id=T1546.007,technique_name=Netsh Helper DLL" condition="contains">SOFTWARE\Microsoft\Netsh</TargetObject>
			<!--Microsoft:Office:ClickOnce-->
			<TargetObject name="flag=Info" condition="end with">\UrlUpdateInfo</TargetObject> <!--Microsoft:Office:ClickOnce: [ https://subt0x10.blogspot.com/2016/12/mimikatz-delivery-via-clickonce-with.html ] -->
			<!--Office macros-->
			<TargetObject name="flag=Info" condition="contains">\Security\Trusted Documents\TrustRecords</TargetObject> <!--Microsoft:Office: Trusted Documents, Macros Enabled-->
			<!--Office outlook addins-->
			<TargetObject name="flag=Info" condition="contains">\Microsoft\Office\Outlook\Addins</TargetObject> <!--Microsoft:Office: Outlook add-ins-->
			<TargetObject name="flag=Info" condition="contains">\Software\Microsoft\VSTO\Security\Inclusion</TargetObject> <!-- Uncommon place to load add-ins, especially in HKCU-->
			<TargetObject name="flag=Info" condition="contains">\Software\Microsoft\VSTO\SolutionMetadata</TargetObject><!--Uncommon place to declare add-in metadata, especially in HKCU-->
			<!--RDP logon execution-->
			<TargetObject name="flag=Amber,technique_id=T1021.001,technique_name=Remote Desktop Protocol" condition="is">HKLM\SOFTWARE\Policies\Microsoft\Windows NT\Terminal Services</TargetObject>
			<!--Security support provider-->
			<TargetObject name="flag=Info,technique_id=T1547.005,technique_name=Security Support Provider" condition="contains">SOFTWARE\Microsoft\Windows NT\CurrentVersion\Image File Execution Options\LSASS.exe</TargetObject>
			<!--SIP and Trust provider hijacking-->
			<TargetObject name="flag=Amber,technique_id=T1553.003,technique_name=SIP and Trust Provider Hijacking" condition="begin with">HKLM\SOFTWARE\Microsoft\Cryptography\OID</TargetObject>
			<TargetObject name="flag=Info,technique_id=T1553.003,technique_name=SIP and Trust Provider Hijacking" condition="begin with">HKLM\SOFTWARE\WOW6432Node\Microsoft\Cryptography\OID</TargetObject>
			<TargetObject name="flag=Info,technique_id=T1553.003,technique_name=SIP and Trust Provider Hijacking" condition="begin with">HKLM\SOFTWARE\Microsoft\Cryptography\Providers\Trust</TargetObject>
			<TargetObject name="flag=Info,technique_id=T1553.003,technique_name=SIP and Trust Provider Hijacking" condition="begin with">HKLM\SOFTWARE\WOW6432Node\Microsoft\Cryptography\Providers\Trust</TargetObject>
			<!--sysinternal-->
			<TargetObject name="flag=Info,technique_id=T1569.002,technique_name=Service Execution" condition="end with">\PsExec\EulaAccepted</TargetObject>
			<TargetObject name="flag=Info,technique_id=T1105,technique_name=Ingress Tool Transfer" condition="end with">\PsFile\EulaAccepted</TargetObject>
			<TargetObject name="flag=Info,technique_id=T1033,technique_name=System Owner/User Discovery" condition="end with">\PsGetSID\EulaAccepted</TargetObject>
			<TargetObject name="flag=Info,technique_id=T1057,technique_name=Process Discovery" condition="end with">\PsInfo\EulaAccepted</TargetObject>
			<TargetObject name="flag=Info,technique_id=T1089,technique_name=Disabling Security Tools" condition="end with">\PsKill\EulaAccepted</TargetObject>
			<TargetObject name="flag=Info,technique_id=T1057,technique_name=Process Discovery" condition="end with">\PsList\EulaAccepted</TargetObject>
			<TargetObject name="flag=Info,technique_id=T1033,technique_name=System Owner/User Discovery" condition="end with">\PsLoggedOn\EulaAccepted</TargetObject>
			<TargetObject name="flag=Info,technique_id=T1569.002,technique_name=Service Execution" condition="end with">\PsLogList\EulaAccepted</TargetObject>
			<TargetObject name="flag=Info,technique_id=T1098,technique_name=Account Manipulation" condition="end with">\PsPasswd\EulaAccepted</TargetObject>
			<TargetObject name="flag=Info,technique_id=T1569.002,technique_name=Service Execution" condition="end with">\PsService\EulaAccepted</TargetObject>
			<TargetObject name="flag=Info,undefined" condition="end with">\PsShutDown\EulaAccepted</TargetObject>
			<TargetObject name="flag=Info,undefined" condition="end with">\PsSuspend\EulaAccepted</TargetObject>
			<!--sysmon-->
			<TargetObject name="flag=Red,technique_id=T1089,technique_name=Disabling Security Tools" condition="contains">SYSTEM\CurrentControlSet\services\SysmonDrv</TargetObject><!--Mitre T1089--><!--Mitre T1054-->
			<TargetObject name="flag=Red,technique_id=T1089,technique_name=Disabling Security Tools" condition="contains">SYSTEM\CurrentControlSet\services\Sysmon</TargetObject><!--Mitre T1089--><!--Mitre T1054-->
			<!--Terminal service execution-->
			<TargetObject name="flag=Info,technique_id=T1547.001,technique_name=Registry Run Keys / Start Folder" condition="begin with">HKLM\SYSTEM\CurrentControlSet\Control\Terminal Server\WinStations\RDP-Tcp\InitialProgram</TargetObject>
			<!--w32 time providers-->
			<TargetObject name="flag=Info,technique_id=T1547.003,technique_name=Time Providers" condition="contains">HKEY_LOCAL_MACHINE\System\CurrentControlSet\Services\W32Time\TimeProviders</TargetObject>
			<!--Windows address book-->
			<TargetObject name="flag=Amber,technique_id=T1218,technique_name=Signed Binary Proxy Execution" condition="begin with">HKLM\Software\Microsoft\WAB\DLLPath</TargetObject>
			<!--Windows AppPaths hijacking-->
			<TargetObject name="flag=Info" condition="begin with">HKLM\SOFTWARE\Microsoft\Windows\CurrentVersion\App Paths</TargetObject> <!--Microsoft:Windows: Credit to @Hexacorn [ http://www.hexacorn.com/blog/2013/01/19/beyond-good-ol-run-key-part-3/ ] -->
			<TargetObject name="flag=Info,technique_id=T1546.009,technique_name=AppCert DLLs" condition="begin with">HKLM\SYSTEM\CurrentControlSet\Control\Session Manager\AppCertDlls</TargetObject><!--Microsoft:Windows: Credit to @Hexacorn [ http://www.hexacorn.com/blog/2013/01/19/beyond-good-ol-run-key-part-3/ ] -->
			<!--Windows component objects hihacking-->
			<TargetObject name="flag=Info,technique_id=T1546.015,technique_name=Component Object Model Hijacking" condition="end with">\InprocServer32\(Default)</TargetObject> <!--Microsoft:Windows:COM Object Hijacking [ https://blog.gdatasoftware.com/2014/10/23941-com-object-hijacking-the-discreet-way-of-persistence ] | Credit @ion-storm -->
			<TargetObject name="flag=Info,technique_id=T1546.015,technique_name=Component Object Model Hijacking" condition="contains all">Classes\CLSID\;TreatAs</TargetObject><!--https://bohops.com/2018/08/18/abusing-the-com-registry-structure-part-2-loading-techniques-for-evasion-and-persistence/-->
			<!--Windows consent-->
			<TargetObject name="flag=Amber,technique_id=T1125,technique_name=Video Capture" condition="contains">\SOFTWARE\Microsoft\Windows\CurrentVersion\CapabilityAccessManager\ConsentStore\webcam</TargetObject> <!--https://medium.com/@7a616368/can-you-track-processes-accessing-the-camera-and-microphone-7e6885b37072-->
			<TargetObject name="flag=Amber,technique_id=T1123,technique_name=Audio Capture" condition="contains">\SOFTWARE\Microsoft\Windows\CurrentVersion\CapabilityAccessManager\ConsentStore\microphone</TargetObject> <!--https://medium.com/@7a616368/can-you-track-processes-accessing-the-camera-and-microphone-7e6885b37072-->
			<TargetObject name="flag=Amber,technique_id=T1123,technique_name=Audio Capture" condition="contains">\SOFTWARE\Microsoft\Windows\CurrentVersion\CapabilityAccessManager\ConsentStore\bluetooth</TargetObject>
			<TargetObject name="flag=Info,technique_id=T1005,technique_name=Data from Local System" condition="contains">\SOFTWARE\Microsoft\Windows\CurrentVersion\CapabilityAccessManager\ConsentStore\usb</TargetObject>
			<TargetObject name="flag=Info,technique_id=T1005,technique_name=Data from Local System" condition="contains">\SOFTWARE\Microsoft\Windows\CurrentVersion\CapabilityAccessManager\ConsentStore\location</TargetObject>
			<TargetObject name="flag=Info,technique_id=T1005,technique_name=Data from Local System" condition="contains">\SOFTWARE\Microsoft\Windows\CurrentVersion\CapabilityAccessManager\ConsentStore\contacts</TargetObject>
			<TargetObject name="flag=Info,technique_id=T1056.001,technique_name=Input Capture - Keylogging" condition="contains">\SOFTWARE\Microsoft\Windows\CurrentVersion\CapabilityAccessManager\ConsentStore\hunmanInterfaceDevice</TargetObject>
			<!--Credential providers-->
			<TargetObject name="flag=Info" condition="begin with">HKLM\SOFTWARE\Microsoft\Windows\CurrentVersion\Authentication\Credential Provider</TargetObject> <!--Wildcard, includes Credental Providers and Credential Provider Filters-->
			<TargetObject name="flag=Info" condition="begin with">HKLM\SYSTEM\CurrentControlSet\Control\Lsa</TargetObject>
			<TargetObject name="flag=Info,technique_id=T1003,technique_name=Credential Dumping" condition="begin with">HKLM\SYSTEM\CurrentControlSet\Control\SecurityProviders\</TargetObject><!--Microsoft:Windows: Changes to WDigest-UseLogonCredential for password scraping [ https://www.trustedsec.com/april-2015/dumping-wdigest-creds-with-meterpreter-mimikatzkiwi-in-windows-8-1/ ] -->
			<TargetObject name="flag=Red,technique_id=T1003,technique_name=Credential Dumping" condition="contains">\Control\SecurityProviders\WDigest</TargetObject>
			<!--Windows Defender tampering | Credit @ion-storm -->
			<TargetObject name="flag=Red,technique_id=T1089,technique_name=Disabling Security Tools" condition="begin with">HKLM\SOFTWARE\Microsoft\Security Center\AntiVirusDisableNotify</TargetObject>
			<TargetObject name="flag=Red,technique_id=T1089,technique_name=Disabling Security Tools" condition="begin with">HKLM\SOFTWARE\Policies\Microsoft\Windows Defender\DisableAntiSpyware</TargetObject>
			<TargetObject name="flag=Red,technique_id=T1089,technique_name=Disabling Security Tools" condition="begin with">HKLM\SOFTWARE\Policies\Microsoft\Windows Defender\DisableAntiVirus</TargetObject>
			<TargetObject name="flag=Red,technique_id=T1089,technique_name=Disabling Security Tools" condition="begin with">HKLM\SOFTWARE\Policies\Microsoft\Windows Defender\Real-Time Protection\DisableBehaviorMonitoring</TargetObject>
			<TargetObject name="flag=Red,technique_id=T1089,technique_name=Disabling Security Tools" condition="begin with">HKLM\SOFTWARE\Policies\Microsoft\Windows Defender\Real-Time Protection\DisableOnAccessProtection</TargetObject>
			<TargetObject name="flag=Red,technique_id=T1089,technique_name=Disabling Security Tools" condition="begin with">HKLM\SOFTWARE\Policies\Microsoft\Windows Defender\Real-Time Protection\DisableScanOnRealtimeEnable</TargetObject>
			<TargetObject name="flag=Red,technique_id=T1089,technique_name=Disabling Security Tools" condition="begin with">HKLM\SOFTWARE\Policies\Microsoft\Windows Defender\Spynet\SpyNetReporting</TargetObject>
			<TargetObject name="flag=Red,technique_id=T1089,technique_name=Disabling Security Tools" condition="begin with">HKLM\SOFTWARE\Policies\Microsoft\Windows Defender</TargetObject> <!--Microsoft:Defender: Detect changes to Defender administrative settings to monitor for disablement-->
			<!--Microsoft Firewall tampering-->
			<TargetObject name="flag=Info,technique_id=T1089,technique_name=Disabling Security Tools" condition="begin with">HKLM\SYSTEM\CurrentControlSet\Services\SharedAccess\Parameters\FirewallPolicy\StandardProfile\AuthorizedApplications\List</TargetObject> <!--Windows Firewall authorized applications | Credit @ion-storm -->
			<TargetObject name="flag=Info,technique_id=T1089,technique_name=Disabling Security Tools" condition="begin with">HKLM\SOFTWARE\Microsoft\Security Center\FirewallDisableNotify</TargetObject>
			<TargetObject name="flag=Info,technique_id=T1089,technique_name=Disabling Security Tools" condition="begin with">HKLM\SOFTWARE\Microsoft\Security Center\FirewallOverride</TargetObject>
			<!--Windows internals integrity monitoring-->
			<TargetObject name="flag=Info" condition="begin with">HKLM\SOFTWARE\Microsoft\Windows NT\CurrentVersion\Image File Execution Options</TargetObject> <!--Microsoft:Windows: Malware likes changing IFEO-->
			<TargetObject name="flag=Info" condition="begin with">HKLM\SOFTWARE\Microsoft\Windows\CurrentVersion\WINEVT</TargetObject> <!--Microsoft:Windows: Event log system integrity and ACLs-->
			<TargetObject name="flag=Info" condition="begin with">HKLM\SYSTEM\CurrentControlSet\Control\Safeboot</TargetObject> <!--Microsoft:Windows: Services approved to load in safe mode-->
			<TargetObject name="flag=Info" condition="begin with">HKLM\SYSTEM\CurrentControlSet\Control\Winlogon</TargetObject> <!--Microsoft:Windows: Providers notified by WinLogon-->
			<TargetObject name="flag=Info" condition="end with">\FriendlyName</TargetObject> <!--Microsoft:Windows: New devices connected and remembered-->
			<TargetObject name="flag=Info" condition="is">HKLM\SOFTWARE\Microsoft\Windows\CurrentVersion\Installer\InProgress\(Default)</TargetObject> <!--Microsoft:Windows: See when WindowsInstaller is engaged-->
			<Rule name="flag=Red,technique_id=T1548.002,technique_name=Bypass User Access Control" groupRelation="and">
				<TargetObject name="flag=Red,technique_id=T1548.002,technique_name=Bypass User Access Control" condition="begin with">HKLM\SOFTWARE\Microsoft\Windows\CurrentVersion\Policies\System</TargetObject> <!--Microsoft:Windows:UAC: Detect malware changes to UAC prompt level-->
				<Image name="flag=Info" condition="is not">C:\Windows\System32\svchost.exe</Image>
			</Rule> 
			<!--Networking-->
			<TargetObject name="flag=Info" condition="begin with">HKLM\SYSTEM\CurrentControlSet\Control\NetworkProvider\Order</TargetObject> <!--Microsoft:Windows: Order of network providers that are checked to connect to destination [ https://www.malwarearchaeology.com/cheat-sheets ] -->
			<TargetObject name="flag=Info" condition="begin with">HKLM\SOFTWARE\Microsoft\Windows NT\CurrentVersion\NetworkList\Profiles</TargetObject> <!--Microsoft:Windows: | Credit @ion-storm -->

			<TargetObject name="flag=Red,technique_id=T1089,technique_name=Disabling Security Tools" condition="begin with">HKLM\SOFTWARE\Policies\Microsoft\Windows\PowerShell\ModuleLogging</TargetObject>
      		<TargetObject name="flag=Red,technique_id=T1089,technique_name=Disabling Security Tools" condition="begin with">HKLM\SOFTWARE\Policies\Microsoft\Windows\PowerShell\ScriptBlockLogging</TargetObject>
        	<TargetObject name="flag=Amber,technique_id=T1089,technique_name=Disabling Security Tools" condition="begin with">HKLM\SOFTWARE\Policies\Microsoft\Windows\PowerShell\Transcription</TargetObject>
			<!--Port monitor-->
			<TargetObject name="flag=Info,technique_id=T1547.010,technique_name=Boot or Logon Autostart Execution - Port Monitors" condition="begin with">HKLM\SOFTWARE\Microsoft\Windows NT\CurrentVersion\Ports</TargetObject> <!--Microsoft:Windows: Printer port changes as used in CVE-2020-1048 [ https://windows-internals.com/printdemon-cve-2020-1048/ ] -->
			<TargetObject name="flag=Amber,technique_id=T1547.010,technique_name=Boot or Logon Autostart Execution - Port Monitors" condition="begin with">HKCU\SOFTWARE\Microsoft\Windows NT\CurrentVersion\Ports</TargetObject> <!--Microsoft:Windows: Printer port changes as used in CVE-2020-1048 [ https://windows-internals.com/printdemon-cve-2020-1048/ ] -->
	  		<!--root certs-->
			<TargetObject name="flag=Red,technique_id=T1130,technique_name=Install Root Certificate" condition="begin with">HKLM\SOFTWARE\Microsoft\EnterpriseCertificates\Root\Certificates</TargetObject>
			<TargetObject name="flag=Info,technique_id=T1130,technique_name=Install Root Certificate" condition="contains">\Microsoft\SystemCertificates\Root\Certificates</TargetObject>
			<!--Microsoft Security Center tampering | Credit @ion-storm -->
			<TargetObject name="flag=Info,technique_id=T1089,technique_name=Disabling Security Tools" condition="begin with">HKLM\SOFTWARE\Microsoft\Security Center\AllAlertsDisabled</TargetObject>
			<TargetObject name="flag=Info,technique_id=T1089,technique_name=Disabling Security Tools" condition="begin with">HKLM\SOFTWARE\Microsoft\Security Center\DisableMonitoring</TargetObject>
			<!--Windows shell hijack-->
			<TargetObject name="flag=Info" condition="contains">\Classes\AllFilesystemObjects</TargetObject> <!--Microsoft:Windows:Explorer: [ http://www.silentrunners.org/launchpoints.html ] -->
			<TargetObject name="flag=Info" condition="contains">\Classes\Directory</TargetObject> <!--Microsoft:Windows:Explorer: [ https://stackoverflow.com/questions/1323663/windows-shell-context-menu-option ] -->
			<TargetObject name="flag=Info" condition="contains">\Classes\Drive</TargetObject> <!--Microsoft:Windows:Explorer: [ https://stackoverflow.com/questions/1323663/windows-shell-context-menu-option ] -->
			<TargetObject name="flag=Info" condition="contains">\Classes\Folder</TargetObject> <!--Microsoft:Windows:Explorer: ContextMenuHandlers, DragDropHandlers, CopyHookHandlers, [ https://stackoverflow.com/questions/1323663/windows-shell-context-menu-option ] -->
			<TargetObject name="flag=Info" condition="contains">\ContextMenuHandlers</TargetObject> <!--Microsoft:Windows: [ http://oalabs.openanalysis.net/2015/06/04/malware-persistence-hkey_current_user-shell-extension-handlers/ ] -->
			<TargetObject name="flag=Info" condition="contains">\CurrentVersion\Shell</TargetObject> <!--Microsoft:Windows: Shell Folders, ShellExecuteHooks, ShellIconOverloadIdentifers, ShellServiceObjects, ShellServiceObjectDelayLoad [ http://oalabs.openanalysis.net/2015/06/04/malware-persistence-hkey_current_user-shell-extension-handlers/ ] -->
			<TargetObject name="flag=Info" condition="begin with">HKLM\Software\Microsoft\Windows\CurrentVersion\explorer\ShellExecuteHooks</TargetObject> <!--Microsoft:Windows: ShellExecuteHooks-->
			<TargetObject name="flag=Info" condition="begin with">HKLM\Software\Microsoft\Windows\CurrentVersion\explorer\ShellServiceObjectDelayLoad</TargetObject> <!--Microsoft:Windows: ShellExecuteHooks-->
			<!--Windows store tampering-->
			<TargetObject name="flag=Red,technique_id=T1548.002,technique_name=Bypass User Access Control" condition="begin with">HKCU\Software\Classes\AppX82a6gwre4fdg3bt635tn5ctqjf8msdd2\Shell\open\command</TargetObject><!--https://lolbas-project.github.io/lolbas/Binaries/Wsreset/-->
			<!--Windows:Thumbnail:Autostart-->
			<TargetObject name="flag=Red" condition="contains">{AB8902B4-09CA-4bb6-B78D-A8F59079A8D5}</TargetObject> <!--Microsoft:Windows: Thumbnail cache autostart [ http://blog.trendmicro.com/trendlabs-security-intelligence/poweliks-levels-up-with-new-autostart-mechanism/ ] -->
			<!--Windows UAC tampering-->
			<TargetObject name="flag=Red,technique_id=T1548.002,technique_name=Bypass User Access Control" condition="begin with">HKLM\Software\Microsoft\Windows\CurrentVersion\Policies\System\EnableLUA</TargetObject> <!--Detect: UAC Tampering | Credit @ion-storm -->
			<TargetObject name="flag=Red,technique_id=T1548.002,technique_name=Bypass User Access Control" condition="begin with">HKLM\Software\Microsoft\Windows\CurrentVersion\Policies\System\LocalAccountTokenFilterPolicy</TargetObject> <!--Detect: UAC Tampering | Credit @ion-storm -->
			<TargetObject name="flag=Red,technique_id=T1548.002,technique_name=Bypass User Access Control" condition="begin with">HKLM\SOFTWARE\Microsoft\Security Center\UacDisableNotify</TargetObject>
			<TargetObject name="flag=Red,technique_id=T1548.002,technique_name=Bypass User Access Control" condition="begin with">HKLM\SOFTWARE\Microsoft\Security Center\UpdatesDisableNotify</TargetObject>
			<!--Windows update auto start-->
			<TargetObject name="flag=Info" condition="is">HKLM\SOFTWARE\Microsoft\Windows\CurrentVersion\WindowsUpdate\Setup\ServiceStartup</TargetObject>
			<!--Winsock and Winsock2-->
			<TargetObject name="flag=Info" condition="begin with">HKLM\SYSTEM\CurrentControlSet\Services\WinSock</TargetObject> <!--Microsoft:Windows: Wildcard, includes Winsock and Winsock2-->
			<TargetObject name="flag=Info" condition="end with">\ProxyServer</TargetObject> <!--Microsoft:Windows: System and user proxy server-->
			<!-- Win32_OSRecoveryConfiguration class C2 maps to a change in values within the following key: -->
         	<TargetObject name="flag=Info,technique_id=T1047,technique_name=Windows Management Instrumentation" condition="contains">SYSTEM\CurrentControlSet\Control\CrashControl</TargetObject>

			<TargetObject name="flag=Info" condition="contains">\Software\Microsoft\Office\16.0\Outlook\Security</TargetObject><!--https://www.mdsec.co.uk/2020/11/a-fresh-outlook-on-mail-based-persistence/-->
		
			<!--Windows Powershell logging tampering -->
			<TargetObject name="flag=Red,technique_id=T1089,technique_name=Disabling Security Tools" condition="begin with">HKLM\SOFTWARE\Policies\Microsoft\Windows\PowerShell\ModuleLogging</TargetObject>
			<TargetObject name="flag=Red,technique_id=T1089,technique_name=Disabling Security Tools" condition="begin with">HKLM\SOFTWARE\Policies\Microsoft\Windows\PowerShell\ScriptBlockLogging</TargetObject>
			<TargetObject name="flag=Amber,technique_id=T1089,technique_name=Disabling Security Tools" condition="begin with">HKLM\SOFTWARE\Policies\Microsoft\Windows\PowerShell\Transcription</TargetObject>
		
		</RegistryEvent>
	</RuleGroup>

	<RuleGroup name="" groupRelation="or">
		<RegistryEvent onmatch="exclude">
		<!--COMMENT:	Remove low-information noise. Often these hide a procress recreating an empty key and do not hide the values created subsequently.-->
		<!--NOTE:	A lot of noise can be removed by excluding CreateKey events, which are largely innocuous-->
			<TargetObject name="flag=Info" condition="contains">\{CAFEEFAC-</TargetObject>
			<EventType condition="is">CreateKey</EventType>
			<TargetObject name="flag=Info" condition="begin with">HKLM\COMPONENTS</TargetObject>
			<!--Inventory noise-->
			<TargetObject name="flag=Info" condition="begin with">HKLM\Software\Microsoft\Windows\CurrentVersion\AppModel\StateRepository\Cache</TargetObject>
			<!--Misc-->
			
			<TargetObject name="flag=Info" condition="end with">\CurrentVersion\App Paths</TargetObject> <!--Microsoft:Windows: Remove noise from the "\Windows\CurrentVersion\App Paths" wildcard-->
			<TargetObject name="flag=Info" condition="end with">\CurrentVersion\Image File Execution Options</TargetObject> <!--Microsoft:Windows: Remove noise from the "\Windows\CurrentVersion\Image File Execution Options" wildcard-->
			<TargetObject name="flag=Info" condition="end with">\CurrentVersion\Shell Extensions\Cached</TargetObject> <!--Microsoft:Windows: Remove noise from the "\CurrentVersion\Shell Extensions\Cached" wildcard-->
			<TargetObject name="flag=Info" condition="end with">\CurrentVersion\Shell Extensions\Approved</TargetObject> <!--Microsoft:Windows: Remove noise from the "\CurrentVersion\Shell Extensions\Approved" wildcard-->
			<TargetObject name="flag=Info" condition="end with">Toolbar\WebBrowser</TargetObject> <!--Microsoft:IE: Extraneous activity-->
			<TargetObject name="flag=Info" condition="end with">Browser\ITBar7Height</TargetObject> <!--Microsoft:IE: Extraneous activity, covers ShellBrowser and WebBrowser-->
			<TargetObject name="flag=Info" condition="end with">Browser\ITBar7Layout</TargetObject> <!--Microsoft:IE: Extraneous activity-->
			<TargetObject name="flag=Info" condition="end with">Internet Explorer\Toolbar\Locked</TargetObject> <!--Windows:Explorer: Extraneous activity-->
			<TargetObject name="flag=Info" condition="end with">Toolbar\WebBrowser\{47833539-D0C5-4125-9FA8-0819E2EAAC93}</TargetObject> <!--Windows:Explorer: Extraneous activity-->
			<TargetObject name="flag=Info" condition="end with">}\PreviousPolicyAreas</TargetObject> <!--Windows: Remove noise from \Winlogon\GPExtensions by svchost.exe-->
			<TargetObject name="flag=Info" condition="contains">\Control\WMI\Autologger\</TargetObject> <!--Windows: Remove noise from monitoring "\Start"-->
			<TargetObject name="flag=Info" condition="end with">HKLM\SYSTEM\CurrentControlSet\Services\UsoSvc\Start</TargetObject> <!--Windows: Remove noise from monitoring "\Start"-->
			<TargetObject name="flag=Info" condition="end with">\Lsa\OfflineJoin\CurrentValue</TargetObject> <!--Windows: Sensitive value during domain join-->
			<TargetObject name="flag=Info" condition="end with">\Components\TrustedInstaller\Events</TargetObject> <!--Microsoft:Windows: Remove noise monitoring Winlogon-->
			<TargetObject name="flag=Info" condition="end with">\Components\TrustedInstaller</TargetObject> <!--Microsoft:Windows: Remove noise monitoring Winlogon-->
			<TargetObject name="flag=Info" condition="end with">\Components\Wlansvc</TargetObject> <!--Microsoft:Windows: Remove noise monitoring Winlogon-->
			<TargetObject name="flag=Info" condition="end with">\Components\Wlansvc\Events</TargetObject> <!--Microsoft:Windows: Remove noise monitoring Winlogon-->
			<TargetObject name="flag=Info" condition="begin with">HKLM\SOFTWARE\Microsoft\Windows\CurrentVersion\Installer\UserData\S-1-5-18\</TargetObject> <!--Microsoft:Windows: Remove noise monitoring installations run as system-->
			<TargetObject name="flag=Info" condition="begin with">HKLM\Software\Microsoft\Windows\CurrentVersion\Installer\UserData\S-1-5-18\</TargetObject> <!--Windows: Remove noise monitoring installations run as system-->
			<TargetObject name="flag=Info" condition="end with">\Directory\shellex</TargetObject> <!--Microsoft:Windows: Remove noise monitoring Classes-->
			<TargetObject name="flag=Info" condition="end with">\Directory\shellex\DragDropHandlers</TargetObject> <!--Microsoft:Windows: Remove noise monitoring Classes-->
			<TargetObject name="flag=Info" condition="end with">\Drive\shellex</TargetObject> <!--Microsoft:Windows: Remove noise monitoring Classes-->
			<TargetObject name="flag=Info" condition="end with">\Drive\shellex\DragDropHandlers</TargetObject> <!--Microsoft:Windows: Remove noise monitoring Classes-->
			<TargetObject name="flag=Info" condition="contains">_Classes\AppX</TargetObject> <!--Windows: Remove noise monitoring "Shell\open\command"--> <!--Win8+-->
			<TargetObject name="flag=Info" condition="begin with">HKLM\Software\Microsoft\Windows\CurrentVersion\WINEVT\Publishers\</TargetObject> <!--Windows: SvcHost Noise-->
			<TargetObject name="flag=Info" condition="begin with">HKLM\SOFTWARE\Microsoft\Windows\CurrentVersion\WINEVT\Publishers\</TargetObject> <!--Microsoft:Windows: SvcHost Noise-->
			<TargetObject name="flag=Info" condition="is">HKLM\SOFTWARE\Policies\Microsoft\SystemCertificates\Root\Certificates</TargetObject>
			<Image name="flag=Info" condition="is">C:\Windows\SystemApps\Microsoft.Windows.Cortana_cw5n1h2txyewy\SearchUI.exe</Image> <!--Microsoft:Windows: Remove noise from Windows 10 Cortana | Credit @ion-storm--> <!--Win10-->
	      	<Image name="flag=Info" condition="begin with">C:\$WINDOWS.~BT\</Image> <!--Microsoft:Windows: Update/Upgrade noise -->
			<!--Bootup Control noise-->
			<TargetObject name="flag=Info" condition="end with">HKLM\SYSTEM\CurrentControlSet\Control\Lsa\LsaPid</TargetObject> <!--Windows:lsass.exe: Boot noise-->
			<TargetObject name="flag=Info" condition="end with">HKLM\SYSTEM\CurrentControlSet\Control\Lsa\SspiCache</TargetObject> <!--Windows:lsass.exe: Boot noise--> <!--Win8+-->
			<TargetObject name="flag=Info" condition="end with">HKLM\SYSTEM\CurrentControlSet\Control\Lsa\Kerberos\Domains</TargetObject> <!--Windows:lsass.exe: Boot noise--> <!--Win8+-->
			<!--Services startup settings noise, some low-risk services routinely change it and this can be ignored-->
			<TargetObject name="flag=Info" condition="end with">\Services\BITS\Start</TargetObject> <!--Windows: Remove noise from monitoring "\Start"-->
			<TargetObject name="flag=Info" condition="end with">\services\clr_optimization_v2.0.50727_32\Start</TargetObject> <!--Microsoft:dotNet: Windows 7-->
			<TargetObject name="flag=Info" condition="end with">\services\clr_optimization_v2.0.50727_64\Start</TargetObject> <!--Microsoft:dotNet: Windows 7-->
			<TargetObject name="flag=Info" condition="end with">\services\clr_optimization_v4.0.30319_32\Start</TargetObject> <!--Microsoft:dotNet: Windows 10-->
			<TargetObject name="flag=Info" condition="end with">\services\clr_optimization_v4.0.30319_64\Start</TargetObject> <!--Microsoft:dotNet: Windows 10-->
			<TargetObject name="flag=Info" condition="end with">\services\deviceAssociationService\Start</TargetObject> <!--Windows: Remove noise from monitoring "\Start"-->
			<TargetObject name="flag=Info" condition="end with">\services\fhsvc\Start</TargetObject> <!--Windows: File History Service-->
			<TargetObject name="flag=Info" condition="end with">\services\nal\Start</TargetObject> <!--Intel: Network adapter diagnostic driver-->
			<TargetObject name="flag=Info" condition="end with">\services\trustedInstaller\Start</TargetObject> <!--Windows: Remove noise from monitoring "\Start"-->
			<TargetObject name="flag=Info" condition="end with">\services\tunnel\Start</TargetObject> <!--Windows: Remove noise from monitoring "\Start"-->
			<TargetObject name="flag=Info" condition="end with">\services\usoSvc\Start</TargetObject> <!--Windows: Remove noise from monitoring "\Start"-->
			<!--FileExts noise filtering-->
			<TargetObject name="flag=Info" condition="end with">\UserChoice\ProgId</TargetObject> <!--Windows: Remove noise from monitoring "FileExts"--> <!--Win8+-->
			<TargetObject name="flag=Info" condition="end with">\UserChoice\Hash</TargetObject> <!--Windows: Remove noise from monitoring "FileExts"--> <!--Win8+-->
			<TargetObject name="flag=Info" condition="end with">\OpenWithList\MRUList</TargetObject> <!--Windows: Remove noise from monitoring "FileExts"-->
			<TargetObject name="flag=Info" condition="contains">Shell Extentions\Cached</TargetObject> <!--Windows: Remove noise generated by explorer.exe on monitored ShellCached binary keys--> <!--Win8+-->
			<!--Group Policy noise-->
			<TargetObject name="flag=Info" condition="end with">HKLM\System\CurrentControlSet\Control\Lsa\Audit\SpecialGroups</TargetObject> <!--Windows: Routinely set through Group Policy, not especially important to log-->
			<TargetObject name="flag=Info" condition="end with">SOFTWARE\Microsoft\Windows\CurrentVersion\Group Policy\Scripts\Startup\0\PSScriptOrder</TargetObject> <!--Windows:Group Policy: Noise below the actual key while building-->
			<TargetObject name="flag=Info" condition="end with">SOFTWARE\Microsoft\Windows\CurrentVersion\Group Policy\Scripts\Startup\0\SOM-ID</TargetObject> <!--Windows:Group Policy: Noise below the actual key while building-->
			<TargetObject name="flag=Info" condition="end with">SOFTWARE\Microsoft\Windows\CurrentVersion\Group Policy\Scripts\Startup\0\GPO-ID</TargetObject> <!--Windows:Group Policy: Noise below the actual key while building-->
			<TargetObject name="flag=Info" condition="end with">SOFTWARE\Microsoft\Windows\CurrentVersion\Group Policy\Scripts\Startup\0\0\IsPowershell</TargetObject> <!--Windows:Group Policy: Noise below the actual key while building-->
			<TargetObject name="flag=Info" condition="end with">SOFTWARE\Microsoft\Windows\CurrentVersion\Group Policy\Scripts\Startup\0\0\ExecTime</TargetObject> <!--Windows:Group Policy: Noise below the actual key while building-->
			<TargetObject name="flag=Info" condition="end with">SOFTWARE\Microsoft\Windows\CurrentVersion\Group Policy\Scripts\Shutdown\0\PSScriptOrder</TargetObject> <!--Windows:Group Policy: Noise below the actual key while building-->
			<TargetObject name="flag=Info" condition="end with">SOFTWARE\Microsoft\Windows\CurrentVersion\Group Policy\Scripts\Shutdown\0\SOM-ID</TargetObject> <!--Windows:Group Policy: Noise below the actual key while building-->
			<TargetObject name="flag=Info" condition="end with">SOFTWARE\Microsoft\Windows\CurrentVersion\Group Policy\Scripts\Shutdown\0\GPO-ID</TargetObject> <!--Windows:Group Policy: Noise below the actual key while building-->
			<TargetObject name="flag=Info" condition="end with">SOFTWARE\Microsoft\Windows\CurrentVersion\Group Policy\Scripts\Shutdown\0\0\IsPowershell</TargetObject> <!--Windows:Group Policy: Noise below the actual key while building-->
			<TargetObject name="flag=Info" condition="end with">SOFTWARE\Microsoft\Windows\CurrentVersion\Group Policy\Scripts\Shutdown\0\0\ExecTime</TargetObject> <!--Windows:Group Policy: Noise below the actual key while building-->
			<TargetObject name="flag=Info" condition="contains">\safer\codeidentifiers\0\HASHES\{</TargetObject> <!--Windows: Software Restriction Policies. Can be used to disable security tools, but very noisy to monitor if you use it-->
			<!--SECTION: Office C2R-->
			<TargetObject name="flag=Info" condition="contains">VirtualStore\MACHINE\SOFTWARE\Microsoft\Office\ClickToRun\</TargetObject> <!--Microsoft: SearchProtocolHost writes to OfficeC2R registry for Outlook, seemingly regarding mail indexing-->
			<TargetObject name="flag=Info" condition="begin with">HKLM\SOFTWARE\Microsoft\Office\ClickToRun\</TargetObject> <!--Microsoft: Virtual registry for Office-->
			<!--SECTION: 3rd party-->
			<Image name="flag=Info" condition="is">C:\Program Files\WIDCOMM\Bluetooth Software\btwdins.exe</Image> <!--Constantly writes to HKLM-->
			<TargetObject name="flag=Info" condition="begin with">HKCR\VLC.</TargetObject> <!--VLC update noise-->
			<TargetObject name="flag=Info" condition="begin with">HKCR\iTunes.</TargetObject> <!--Apple: iTunes update noise-->
			<!--WINEVT publishers noise-->
			<TargetObject name="flag=Info" condition="is">HKLM\Software\Microsoft\Windows\CurrentVersion\WINEVT\Publishers\{945a8954-c147-4acd-923f-40c45405a658}</TargetObject> <!--Windows update-->
			<!--Added from Olaf-->
			<!--Cisco:Anyconnect ISE Posture module-->
			<Image name="flag=Info" condition="is">C:\Program Files (x86)\Cisco\Cisco AnyConnect Secure Mobility Client\aciseposture.exe</Image>
			<!--Cisco:Anyconnect VPN Agent-->
			<Image name="flag=Info" condition="is">C:\Program Files (x86)\Cisco\Cisco AnyConnect Secure Mobility Client\vpnagent.exe</Image>
			<!--SECTION: InternetExplorer-->
			<TargetObject name="flag=Info" condition="end with">Toolbar\WebBrowser</TargetObject> <!--Microsoft:IE: Extraneous activity-->
			<TargetObject name="flag=Info" condition="end with">Toolbar\WebBrowser\ITBar7Height</TargetObject> <!--Microsoft:IE: Extraneous activity-->
			<TargetObject name="flag=Info" condition="end with">Toolbar\ShellBrowser\ITBar7Layout</TargetObject> <!--Microsoft:Windows:Explorer: Extraneous activity-->
			<TargetObject name="flag=Info" condition="end with">Internet Explorer\Toolbar\Locked</TargetObject> <!--Microsoft:Windows:Explorer: Extraneous activity-->
			<TargetObject name="flag=Info" condition="end with">ShellBrowser</TargetObject> <!--Microsoft:InternetExplorer: Noise-->
			<!--Ivanti-->
			<Image name="flag=Info" condition="is">C:\Program Files (x86)\Ivanti\Workspace Control\pfwsmgr.exe</Image>
      		<Image name="flag=Info" condition="is">C:\Program Files\RES Software\Workspace Manager\pfwsmgr.exe</Image>
			<!--McAfee:Endpoint Encryption Agent-->
			<Image name="flag=Info" condition="is">C:\Program Files\McAfee\Endpoint Encryption Agent\MfeEpeHost.exe</Image>
			<!--McAfee:Endpoint Security Adaptive Threat Protection-->
			<Image name="flag=Info" condition="is">C:\Program Files\McAfee\Endpoint Security\Adaptive Threat Protection\mfeatp.exe</Image>
			<!--McAfee:Endpoint Security Platform-->
			<Image name="flag=Info" condition="is">C:\Program Files\McAfee\Endpoint Security\Endpoint Security Platform\mfeesp.exe</Image>
			<!--McAfee:AMCore Updater-->
			<Image name="flag=Info" condition="is">C:\Program Files\Common Files\McAfee\Engine\AMCoreUpdater\amupdate.exe</Image>
			<!--McAfee:Agent-->
			<Image name="flag=Info" condition="is">C:\Program Files\McAfee\Agent\masvc.exe</Image>
			<!--McAfee:Agent-->
			<Image name="flag=Info" condition="is">C:\Program Files\McAfee\Agent\x86\mfemactl.exe</Image>
			<!--McAfee:Agent-->
			<Image name="flag=Info" condition="is">C:\Program Files\McAfee\Agent\x86\McScript_InUse.exe</Image>
			<!--McAfee:Agent Compatibility Service-->
			<Image name="flag=Info" condition="is">C:\Program Files\McAfee\Agent\x86\macompatsvc.exe</Image>
			<!--McAfee:Endpoint Security Threat Prevention-->
			<Image name="flag=Info" condition="is">C:\Program Files\McAfee\Endpoint Security\Threat Prevention\mfeensppl.exe</Image>
			<!--McAfee:Scan Engine-->
			<Image name="flag=Info" condition="begin with">C:\Program Files\Common Files\McAfee\Engine\scanners</Image>
			<!--McAfee:MCShield-->
			<Image name="flag=Info" condition="is">C:\Program Files\Common Files\McAfee\AVSolution\mcshield.exe</Image>
			<!--Webroot-->
			<Image name="flag=Info" condition="is">C:\Program Files (x86)\Webroot\WRSA.exe</Image> <!--Webroot-->
			<!--WIDCOMM:Bluetooth-->
			<Image name="flag=Info" condition="is">C:\Program Files\WIDCOMM\Bluetooth Software\btwdins.exe</Image> <!--Constantly writes to HKLM-->
			<!--Windows:Bootup Control-->
			<TargetObject name="flag=Info" condition="end with">HKLM\SYSTEM\CurrentControlSet\Control\Lsa\Audit</TargetObject> <!--Microsoft:Windows:lsass.exe: Boot noise--> <!--Win8+-->
			<TargetObject name="flag=Info" condition="end with">HKLM\SYSTEM\CurrentControlSet\Control\Lsa\Audit\AuditPolicy</TargetObject> <!--Microsoft:Windows:lsass.exe: Boot noise--> <!--Win8+-->
			<TargetObject name="flag=Info" condition="end with">HKLM\SYSTEM\CurrentControlSet\Control\Lsa\Audit\PerUserAuditing\System</TargetObject> <!--Microsoft:Windows:lsass.exe: Boot noise--> <!--Win8+-->
			<TargetObject name="flag=Info" condition="end with">HKLM\SYSTEM\CurrentControlSet\Control\Lsa\SspiCache</TargetObject> <!--Microsoft:Windows:lsass.exe: Boot noise--> <!--Win8+-->
			<TargetObject name="flag=Info" condition="end with">HKLM\SYSTEM\CurrentControlSet\Control\Lsa\Kerberos\Domains</TargetObject> <!--Microsoft:Windows:lsass.exe: Boot noise--> <!--Win8+-->
			<TargetObject name="flag=Info" condition="end with">HKLM\SOFTWARE\Microsoft\Windows\CurrentVersion\Policies\System\Audit</TargetObject> <!--Microsoft:Windows:lsass.exe: Boot noise--> <!--Win8+-->
			<!--Windows File exts-->
			<TargetObject name="flag=Info" condition="contains">\OpenWithProgids</TargetObject> <!--Microsoft:Windows: Remove noise from monitoring "FileExts"-->
			<TargetObject name="flag=Info" condition="end with">\OpenWithList</TargetObject> <!--Microsoft:Windows: Remove noise from monitoring "FileExts"-->
			<TargetObject name="flag=Info" condition="end with">\UserChoice</TargetObject> <!--Microsoft:Windows: Remove noise from monitoring "FileExts"-->
			<TargetObject name="flag=Info" condition="end with">\UserChoice\ProgId</TargetObject> <!--Microsoft:Windows: Remove noise from monitoring "FileExts"--> <!--Win8+-->
			<TargetObject name="flag=Info" condition="end with">\UserChoice\Hash</TargetObject> <!--Microsoft:Windows: Remove noise from monitoring "FileExts"--> <!--Win8+-->
			<TargetObject name="flag=Info" condition="end with">\OpenWithList\MRUList</TargetObject> <!--Microsoft:Windows: Remove noise from monitoring "FileExts"-->
			<TargetObject name="flag=Info" condition="end with">} 0xFFFF</TargetObject> <!--Microsoft:Windows: Remove noise from explorer.exe from monitoring ShellCached binary keys--> <!--Win8+-->
			<!--Windows generic binaries-->
			<Image name="flag=Info" condition="end with">Office\root\integration\integrator.exe</Image> <!--Microsoft:Office: C2R client-->
			<Image name="flag=Info" condition="image">C:\WINDOWS\system32\backgroundTaskHost.exe</Image> <!--Microsoft:Windows: Changes association registry keys-->
			<Image name="flag=Info" condition="is">C:\Program Files\Common Files\Microsoft Shared\ClickToRun\OfficeClickToRun.exe</Image> <!--Microsoft:Office: C2R client-->
			<Image name="flag=Info" condition="is">C:\Program Files\Windows Defender\MsMpEng.exe</Image> <!--Microsoft:Windows:Defender-->
			<Image name="flag=Info" condition="is">C:\Windows\SystemApps\Microsoft.Windows.Cortana_cw5n1h2txyewy\SearchUI.exe</Image> <!--Microsoft:Cortana-->
			<Image name="flag=Info" condition="is">C:\Program Files\Microsoft Application Virtualization\Client\AppVClient.exe</Image>
			<!--Sevices autostart-->
			<TargetObject name="flag=Info" condition="end with">\services\clr_optimization_v2.0.50727_32\Start</TargetObject> <!--Microsoft:dotNet: Windows 7-->
			<TargetObject name="flag=Info" condition="end with">\services\clr_optimization_v2.0.50727_64\Start</TargetObject> <!--Microsoft:dotNet: Windows 7-->
			<TargetObject name="flag=Info" condition="end with">\services\clr_optimization_v4.0.30319_32\Start</TargetObject> <!--Microsoft:dotNet: Windows 10-->
			<TargetObject name="flag=Info" condition="end with">\services\clr_optimization_v4.0.30319_64\Start</TargetObject> <!--Microsoft:dotNet: Windows 10-->
			<TargetObject name="flag=Info" condition="end with">\services\DeviceAssociationService\Start</TargetObject> <!--Microsoft:Windows: Remove noise from monitoring "\Start"-->
			<TargetObject name="flag=Info" condition="end with">\services\BITS\Start</TargetObject> <!--Microsoft:Windows: Remove noise from monitoring "\Start"-->
			<TargetObject name="flag=Info" condition="end with">\services\TrustedInstaller\Start</TargetObject> <!--Microsoft:Windows: Remove noise from monitoring "\Start"-->
			<TargetObject name="flag=Info" condition="end with">\services\tunnel\Start</TargetObject> <!--Microsoft:Windows: Remove noise from monitoring "\Start"-->
			<TargetObject name="flag=Info" condition="end with">\services\UsoSvc\Start</TargetObject> <!--Microsoft:Windows: Remove noise from monitoring "\Start"-->
		</RegistryEvent>
	</RuleGroup>

	<!--SYSMON EVENT ID 15 : ALTERNATE DATA STREAM CREATED [FileCreateStreamHash]-->
		<!--EVENT 15: "File stream created"-->
		<!--COMMENT:	Any files created with an NTFS Alternate Data Stream which match these rules will be hashed and logged.
			[ https://blogs.technet.microsoft.com/askcore/2013/03/24/alternate-data-streams-in-ntfs/ ]
			ADS's are used by browsers and email clients to mark files as originating from the Internet or other foreign sources.
			[ https://textslashplain.com/2016/04/04/downloads-and-the-mark-of-the-web/ ] -->
		<!--NOTE: Other filesystem minifilters can make it appear to Sysmon that some files are being written twice. This is not a Sysmon issue, per Mark Russinovich.-->

		<!--DATA: UtcTime, ProcessGuid, ProcessId, Image, TargetFilename, CreationUtcTime, Hash-->
		
	<RuleGroup name="" groupRelation="or">
		<FileCreateStreamHash onmatch="include">
			<TargetFilename name="flag=Info" condition="contains">Downloads</TargetFilename> <!--Downloaded files. Does not include "Run" files in IE-->
			<TargetFilename name="flag=Info" condition="contains">Temp\7z</TargetFilename> <!--7zip extractions-->
			<TargetFilename name="flag=Amber" condition="contains">Startup</TargetFilename> <!--ADS startup | Example: [ https://www.hybrid-analysis.com/sample/a314f6106633fba4b70f9d6ddbee452e8f8f44a72117749c21243dc93c7ed3ac?environmentId=100 ] -->
			<TargetFilename name="flag=Info" condition="end with">.bat</TargetFilename> <!--Batch scripting-->
			<TargetFilename name="flag=Info" condition="end with">.cmd</TargetFilename> <!--Batch scripting | Credit @ion-storm -->
			<TargetFilename name="flag=Info" condition="end with">.doc</TargetFilename> <!--Office doc potentially with macro -->
			<TargetFilename name="flag=Info" condition="end with">.hta</TargetFilename> <!--Scripting--><!--Mitre T1218.005-->
			<TargetFilename name="flag=Amber" condition="end with">.lnk</TargetFilename> <!--Shortcut file | Credit @ion-storm -->
			<TargetFilename name="flag=Info" condition="end with">.ppt</TargetFilename> <!--Office doc potentially with macros-->
			<TargetFilename name="flag=Amber" condition="end with">.ps1</TargetFilename> <!--PowerShell-->
			<TargetFilename name="flag=Amber" condition="end with">.ps2</TargetFilename> <!--PowerShell-->
			<TargetFilename name="flag=Info" condition="end with">.reg</TargetFilename> <!--Registry File-->
			<TargetFilename name="flag=Info" condition="end with">.jse</TargetFilename> <!--Registry File-->
			<TargetFilename name="flag=Amber" condition="end with">.vb</TargetFilename> <!--VisualBasicScripting files-->
			<TargetFilename name="flag=Amber" condition="end with">.vbe</TargetFilename> <!--VisualBasicScripting files-->
			<TargetFilename name="flag=Amber" condition="end with">.vbs</TargetFilename> <!--VisualBasicScripting files-->
			<!--Added from Olaf-->
			<TargetFilename name="flag=Red" condition="end with">Temp\debug.bin</TargetFilename> <!--Bin files https://github.com/GhostPack/SafetyKatz creates debug.bin in a temp folder-->
			<TargetFilename name="flag=Info" condition="contains">Desktop</TargetFilename> <!--Desktop file-->
			<TargetFilename name="flag=Red" condition="end with">.exe</TargetFilename>
			<TargetFilename name="flag=Red" condition="contains">Content.Outlook</TargetFilename> <!--Microsoft:Outlook: Attachments--> <!--PRIVACY WARNING-->
		</FileCreateStreamHash>
	</RuleGroup>

	<RuleGroup name="" groupRelation="or">
		<FileCreateStreamHash onmatch="exclude">
		</FileCreateStreamHash>
	</RuleGroup>

	<!--SYSMON EVENT ID 16 : SYSMON CONFIGURATION CHANGE-->
		<!--EVENT 16: "Sysmon config state changed"-->
		<!--COMMENT:	This ONLY logs if the hash of the configuration changes. Running "sysmon.exe -c" with the current configuration will not be logged with Event 16-->
		
		<!--DATA: UtcTime, Configuration, ConfigurationFileHash-->
		<!--Cannot be filtered.-->

	<!--SYSMON EVENT ID 17 & 18 : PIPE CREATED / PIPE CONNECTED [PipeEvent]-->
		<!--EVENT 17: "Pipe Created"-->
		<!--EVENT 18: "Pipe Connected"-->

		<!--ADDITIONAL REFERENCE: [ https://www.cobaltstrike.com/help-smb-beacon ] -->
		<!--ADDITIONAL REFERENCE: [ https://blog.cobaltstrike.com/2015/10/07/named-pipe-pivoting/ ] -->

		<!--DATA: UtcTime, ProcessGuid, ProcessId, PipeName, Image-->
	<RuleGroup name="" groupRelation="or">
		<PipeEvent onmatch="include">
			<!--NOTE: Using incide with no rules means nothing in this section will be logged-->
			<!--Added from Olaf-->
			<!--Atsvc-->
			<PipeName name="flag=Red,technique_id=T1021.002,technique_name=SMB/Windows Admin Shares" condition="begin with">\atsvc</PipeName>
			<!--Cobaltstrike-->
			<PipeName name="flag=Red,technique_id=T1021.002,technique_name=SMB/Windows Admin Shares" condition="begin with">\msagent_</PipeName><!-- default cobalt strike pipe name-->
			<!--Metasploit-->
			<PipeName name="flag=Red,technique_id=T1021.002,technique_name=SMB/Windows Admin Shares" condition="begin with">\msf-pipe</PipeName><!-- default metasploit pipe name-->
			<!--psexec-->
			<PipeName name="flag=Amber,technique_id=T1021.002,technique_name=SMB/Windows Admin Shares" condition="begin with">\PSEXESVC</PipeName>
			<!--srvsvc-->
			<PipeName name="flag=Info,technique_id=T1049,technique_name=System Network Connections Discovery" condition="begin with">\srvsvc</PipeName><!--session enumeration-->
			<!--winreg-->
			<PipeName name="flag=Amber,technique_id=T1033,technique_name=System Owner/User Discovery" condition="begin with">\winreg</PipeName><!--also used in lateral movement-->
		</PipeEvent>
	</RuleGroup>

	<RuleGroup name="" groupRelation="or">
		<PipeEvent onmatch="exclude">
			<!--Added from Olaf-->
			<!--Azure Sentinel Agent-->
			<Image name="flag=Info" condition="is">"C:\Program Files\Microsoft Monitoring Agent\Agent\MonitoringHost.exe"</Image> <!--Microsoft Sentinel SIEM agent, based on MOM - thanks d4ph1l -->           
			<!--Citrix-->
			<Image name="flag=Info" condition="is">Program Files (x86)\Citrix\ICA Client\SelfServicePlugin\SelfService.exe</Image>
			<Image name="flag=Info" condition="is">Program Files (x86)\Citrix\ICA Client\Receiver\Receiver.exe</Image>
			<Image name="flag=Info" condition="is">Program Files (x86)\Citrix\ICA Client\wfcrun32.exe</Image>
			<Image name="flag=Info" condition="is">Program Files (x86)\Citrix\ICA Client\concentr.exe</Image>
			<!--IBM watson explorer-->
			<PipeName condition="begin with">\Vivisimo Velocity</PipeName>
			<!--MSSQL-->
			<PipeName condition="is">\SQLLocal\MSSQLSERVER</PipeName>
			<PipeName condition="is">\SQLLocal\INSTANCE01</PipeName>
			<PipeName condition="is">\SQLLocal\SQLEXPRESS</PipeName>
			<PipeName condition="is">\SQLLocal\COMMVAULT</PipeName>
			<PipeName condition="is">\SQLLocal\RTCLOCAL</PipeName>
			<PipeName condition="is">\SQLLocal\RTC</PipeName>
			<PipeName condition="is">\SQLLocal\TMSM</PipeName>      
			<Image name="flag=Info" condition="is">Program Files (x86)\Microsoft SQL Server\110\DTS\binn\dtexec.exe</Image>
			<!--postgres-->
			<Image name="flag=Info" condition="end with">PostgreSQL\9.6\bin\postgres.exe</Image>
         	<PipeName condition="contains">\pgsignal_</PipeName>
			<!--Qilk sense-->
			<Image name="flag=Info" condition="is">Program Files\Qlik\Sense\Engine\Engine.exe</Image>
			<!--Splunk-->
			<Image name="flag=Info" condition="end with">Program Files\SplunkUniversalForwarder\bin\splunkd.exe</Image>
			<Image name="flag=Info" condition="end with">Program Files\SplunkUniversalForwarder\bin\splunk.exe</Image>
			<Image name="flag=Info" condition="end with">Program Files\SplunkUniversalForwarder\bin\splunk-MonitorNoHandle.exe</Image>      
			<!--Trend Micro-->
			<Image name="flag=Info" condition="end with">Program Files (x86)\Trend Micro\OfficeScan\PCCSRV\CMAgent\OfcCMAgent.exe</Image>
			<Image name="flag=Info" condition="end with">Program Files (x86)\Trend Micro\OfficeScan\PCCSRV\web\service\ofcservice.exe</Image>
			<Image name="flag=Info" condition="end with">Program Files (x86)\Trend Micro\OfficeScan\PCCSRV\Web\Service\DbServer.exe</Image>                    
			<Image name="flag=Info" condition="end with">Program Files (x86)\Trend Micro\OfficeScan\PCCSRV\web\service\verconn.exe</Image>  
			<Image name="flag=Info" condition="end with">Program Files (x86)\Trend Micro\OfficeScan\PCCSRV\WEB_OSCE\WEB\CGI\cgiOnClose.exe</Image>  
			<Image name="flag=Info" condition="end with">Program Files (x86)\Trend Micro\OfficeScan\PCCSRV\WEB_OSCE\WEB\CGI\cgiRqHotFix.exe</Image>
			<Image name="flag=Info" condition="end with">Program Files (x86)\Trend Micro\OfficeScan\PCCSRV\LWCS\LWCSService.exe</Image>
			<Image name="flag=Info" condition="end with">Program Files (x86)\Trend Micro\OfficeScan\PCCSRV\WSS\iCRCService.exe</Image>
			<Image name="flag=Info" condition="end with">Program Files\Trend\SPROTECT\x64\tsc.exe</Image>
			<Image name="flag=Info" condition="end with">Program Files\Trend\SPROTECT\x64\tsc64.exe</Image>
			<Image name="flag=Info" condition="end with">Program Files (x86)\Trend Micro\OfficeScan\PCCSRV\web\service\osceintegrationservice.exe</Image>
			<Image name="flag=Info" condition="end with">Program Files (x86)\Trend Micro\OfficeScan\PCCSRV\web\service\OfcLogReceiverSvc.exe</Image>
			<PipeName condition="is">\Trend Micro OSCE Command Handler Manager</PipeName>
			<PipeName condition="is">\Trend Micro OSCE Command Handler2 Manager</PipeName>
			<PipeName condition="is">\Trend Micro Endpoint Encryption ToolBox Command Handler Manager</PipeName>
			<PipeName condition="is">\OfcServerNamePipe</PipeName>
			<!--Windows generic-->
			<PipeName condition="is">\ntapvsrq</PipeName>
			<PipeName condition="is">\srvsvc</PipeName>
			<PipeName condition="is">\wkssvc</PipeName>
			<PipeName condition="is">\lsass</PipeName>
			<PipeName condition="is">\winreg</PipeName>
			<PipeName condition="is">\spoolss</PipeName>
			<PipeName condition="contains">Anonymous Pipe</PipeName>
			<Image name="flag=Info" condition="is">c:\windows\system32\inetsrv\w3wp.exe</Image>
		</PipeEvent>
	</RuleGroup>

	<!--SYSMON EVENT ID 19 & 20 & 21 : WMI EVENT MONITORING [WmiEvent]-->
		<!--EVENT 19: "WmiEventFilter activity detected"-->
		<!--EVENT 20: "WmiEventConsumer activity detected"-->
		<!--EVENT 21: "WmiEventConsumerToFilter activity detected"-->

		<!--ADDITIONAL REFERENCE: [ https://www.darkoperator.com/blog/2017/10/15/sysinternals-sysmon-610-tracking-of-permanent-wmi-events ] -->
		<!--ADDITIONAL REFERENCE: [ https://rawsec.lu/blog/posts/2017/Sep/19/sysmon-v610-vs-wmi-persistence/ ] -->

		<!--DATA: EventType, UtcTime, Operation, User, Name, Type, Destination, Consumer, Filter-->
	<RuleGroup name="" groupRelation="or">
		<WmiEvent onmatch="include">
			<!--WMI create-->
			<Operation name="flag=Amber,technique_id=T1047,technique_name=Windows Management Instrumentation" condition="is">Created</Operation>
		</WmiEvent>
	</RuleGroup>

	<RuleGroup name="" groupRelation="or">
		<WmiEvent onmatch="exclude">
			<!--NOTE: Using exclude with no rules means everything will be logged-->
		</WmiEvent>
	</RuleGroup>

	<!--SYSMON EVENT ID 22 : DNS QUERY [DnsQuery]-->
		<!--EVENT 22: "Dns query"-->

		<!--NOTE:	Due to the volume of events that DNS queries generate, some orgs may want to remove this section from their configuration to reduce Sysmon log turnover. -->

		<!--COMMENT:	DNS logging is a very nuanced challenge in monitoring due to event volume. Legitimate domains can be used to host malware/C2, but lookup itself is not very informative.
						It's fine to exclude monitoring these bulk low-value lookups, but at same time, you would not have a full log of how malware communicated, potentially missing C2.
						This section of Sysmon configuration will require your full judgement and knowledge of your org's priorities. There is no correct answer.-->

		<!--OPERATIONS:	Chrome and Firefox prefetch DNS lookups, or use alternate DNS lookup methods Sysmon won't capture. You need to turn these off.
						Search for Group Policy for these browsers to configure this.-->

		<!--OPERATIONS:	Most DNS traffic is web advertising. To significantly reduce DNS queries and malware ads, enable client-side advertising filtering via Group Policy. This is easy.
				Internet Explorer: https://decentsecurity.com/adblocking-for-internet-explorer-deployment/
				Chrome: https://decentsecurity.com/ublock-for-google-chrome-deployment/
				Firefox: ToDo
						Also note, this configuration is designed for United States computers. Your country's users will may need customization to reduce noise.
			-->

		<!--CONFIG:	DNS poisoning is an issue during threat investigations. Try to only exclude ROUTINE system-level queries you know are strongly validated with HTTPS or code signing.-->
		<!--CONFIG:	If you exclude microsoft.com, someone could register malware-microsoft.com and it wouldn't be logged. Use "END WITH" with leading . or "IS" operators.-->
		<!--CONFIG:	Be very specific in exclusions. Threat actors use legitimate services, too. Dont exclude all of AWS or Azure or Google or CDNs!-->
		<!--CONFIG: Popularity data: [ http://s3-us-west-1.amazonaws.com/umbrella-static/index.html ] [ https://better.fyi/trackers/alexa-top-500-news/ ] -->

		<!--CRITICAL:	Do NOT exclude "wpad" lookups. This is a MitM vector routinely used by attackers. Disable WPAD or enforce client-side DNSSEC for AD domain lookups.-->
		<!--CRITICAL:	Do NOT exclude IPv6 lookups.-->

		<!--DATA: RuleName, UtcTime, ProcessGuid, ProcessId, QueryName, QueryType, QueryStatus, QueryResults (can't filter on)-->

		<!--BELOW: These domains should not be excluded at the top level. Be specific if you want to reduce noise under them.-->
		<!-- Rejected: .cloudapp.net, customer content [ https://blogs.technet.microsoft.com/ptsblog/2012/06/18/security-consideration-when-using-cloudapp-net-domain-as-production-environment-in-windows-azure/ ] -->
		<!-- Rejected: .googleapis.com, customer content [ https://www.zdnet.com/article/this-business-email-scam-spreads-trojans-through-google-cloud-storage/ ] -->
		<!-- Rejected: .cloudfront.net, customer content -->
		<!-- Rejected: .windows.net, customer content -->
		<!-- Rejected: *github.com, customer content, including open-source malware components -->

	<RuleGroup name="" groupRelation="or">
		<DnsQuery onmatch="exclude">
			<!--Network noise-->
			<QueryName condition="end with">.arpa.</QueryName> <!--Design decision to not log reverse DNS lookups. You will need to decide.-->
			<QueryName condition="end with">.arpa</QueryName> <!--Design decision to not log reverse DNS lookups. You will need to decide.-->
			<QueryName condition="end with">.msftncsi.com</QueryName> <!--Microsoft proxy detection | Microsoft default exclusion-->
			<QueryName condition="is">..localmachine</QueryName>
			<QueryName condition="is">localhost</QueryName>
			<!--Microsoft-->
			<QueryName condition="end with">-pushp.svc.ms</QueryName> <!--Microsoft: Doesn't appear to host customer content or subdomains-->
			<QueryName condition="end with">.b-msedge.net</QueryName> <!--Microsoft: Doesn't appear to host customer content or subdomains-->
			<QueryName condition="end with">.bing.com</QueryName> <!-- Microsoft | Microsoft default exclusion -->
			<QueryName condition="end with">.hotmail.com</QueryName> <!--Microsoft | Microsoft default exclusion-->
			<QueryName condition="end with">.live.com</QueryName> <!--Microsoft | Microsoft default exclusion-->
			<QueryName condition="end with">.live.net</QueryName> <!--Microsoft | Microsoft default exclusion-->
			<QueryName condition="end with">.s-microsoft.com</QueryName> <!--Microsoft-->
			<QueryName condition="end with">.microsoft.com</QueryName> <!--Microsoft | Microsoft default exclusion-->
			<QueryName condition="end with">.microsoftonline.com</QueryName> <!--Microsoft | Microsoft default exclusion-->
			<QueryName condition="end with">.microsoftstore.com</QueryName> <!--Microsoft | Microsoft default exclusion-->
			<QueryName condition="end with">.ms-acdc.office.com</QueryName> <!--Microsoft: Doesn't appear to host customer content or subdomains-->
			<QueryName condition="end with">.msedge.net</QueryName> <!--Microsoft: Doesn't appear to host customer content or subdomains-->
			<QueryName condition="end with">.msn.com</QueryName> <!--Microsoft | Microsoft default exclusion-->
			<QueryName condition="end with">.msocdn.com</QueryName> <!--Microsoft-->
			<QueryName condition="end with">.skype.com</QueryName> <!--Microsoft | Microsoft default exclusion-->
			<QueryName condition="end with">.skype.net</QueryName> <!--Microsoft | Microsoft default exclusion-->
			<QueryName condition="end with">.windows.com</QueryName> <!--Microsoft-->
			<QueryName condition="end with">.windows.net.nsatc.net</QueryName> <!--Microsoft-->
			<QueryName condition="end with">.windowsupdate.com</QueryName> <!--Microsoft-->
			<QueryName condition="end with">.xboxlive.com</QueryName> <!--Microsoft-->
			<QueryName condition="is">login.windows.net</QueryName> <!--Microsoft-->
			<Image name="flag=Info" condition="begin with">C:\ProgramData\Microsoft\Windows Defender\Platform\</Image> <!--Microsoft: https://docs.microsoft.com/en-us/windows/security/threat-protection/microsoft-defender-atp/network-protection -->
			<!--Microsoft:Office365/AzureAD-->
			<QueryName condition="end with">.activedirectory.windowsazure.com</QueryName> <!--Microsoft: AzureAD-->
			<QueryName condition="end with">.aria.microsoft.com</QueryName> <!--Microsoft: OneDrive/SharePoint-->
			<QueryName condition="end with">.msauth.net</QueryName>
			<QueryName condition="end with">.msftauth.net</QueryName>
			<QueryName condition="end with">.opinsights.azure.com</QueryName> <!--Microsoft: AzureAD/InTune client event monitoring-->
			<QueryName condition="end with">osi.office.net</QueryName> <!--Microsoft: Office-->
			<QueryName condition="is">loki.delve.office.com</QueryName> <!--Microsoft: Office-->
			<QueryName condition="is">management.azure.com</QueryName> <!--Microsoft: AzureAD/InTune-->
			<QueryName condition="is">messaging.office.com</QueryName> <!--Microsoft: Office-->
			<QueryName condition="is">outlook.office365.com</QueryName> <!--Microsoft: Protected by HSTS-->
			<QueryName condition="is">portal.azure.com</QueryName> <!--Microsoft: AzureAD/InTune-->
			<QueryName condition="is">protection.outlook.com</QueryName> <!--Microsoft: Office-->
			<QueryName condition="is">substrate.office.com</QueryName> <!--Microsoft: Office-->
			<QueryName condition="is">osi.office.net</QueryName> <!--Microsoft: Office-->
			<!--3rd-party applications-->
			<QueryName condition="end with">.mozaws.net</QueryName> <!--Mozilla-->
			<QueryName condition="end with">.mozilla.com</QueryName> <!--Mozilla-->
			<QueryName condition="end with">.mozilla.net</QueryName> <!--Mozilla-->
			<QueryName condition="end with">.mozilla.org</QueryName> <!--Mozilla-->
			<QueryName condition="end with">.spotify.com</QueryName> <!--Spotify-->
			<QueryName condition="end with">.spotify.map.fastly.net</QueryName> <!--Spotify-->
			<QueryName condition="is">clients1.google.com</QueryName> <!--Google-->
			<QueryName condition="is">clients2.google.com</QueryName> <!--Google-->
			<QueryName condition="is">clients3.google.com</QueryName> <!--Google-->
			<QueryName condition="is">clients4.google.com</QueryName> <!--Google-->
			<QueryName condition="is">clients5.google.com</QueryName> <!--Google-->
			<QueryName condition="is">clients6.google.com</QueryName> <!--Google-->
			<QueryName condition="is">safebrowsing.googleapis.com</QueryName> <!--Google-->
			<!--Goodlist CDN-->
			<QueryName condition="end with">.akadns.net</QueryName> <!--AkamaiCDN, extensively used by Microsoft | Microsoft default exclusion-->
			<!--  <QueryName condition="end with">.netflix.com</QueryName>  -->
			<QueryName condition="end with">aspnetcdn.com</QueryName> <!--Microsoft [ https://docs.microsoft.com/en-us/aspnet/ajax/cdn/overview ]-->
			<QueryName condition="is">ajax.googleapis.com</QueryName>
			<QueryName condition="is">cdnjs.cloudflare.com</QueryName> <!--Cloudflare: Hosts popular javascript libraries-->
			<QueryName condition="is">fonts.googleapis.com</QueryName> <!--Google fonts-->
			<QueryName condition="end with">.typekit.net</QueryName> <!--Adobe fonts-->
			<QueryName condition="is">cdnjs.cloudflare.com</QueryName>
			<QueryName condition="end with">.stackassets.com</QueryName> <!--Stack Overflow-->
			<QueryName condition="end with">.steamcontent.com</QueryName>
			<!--Web resources-->
			<QueryName condition="end with">.disqus.com</QueryName> <!--Microsoft default exclusion-->
			<QueryName condition="end with">.fontawesome.com</QueryName>
			<QueryName condition="is">disqus.com</QueryName> <!--Microsoft default exclusion-->
			<!--Ads-->
			<QueryName condition="end with">.1rx.io</QueryName> <!--Ads-->
			<QueryName condition="end with">.2mdn.net</QueryName> <!--Ads: Google | Microsoft default exclusion-->
			<QueryName condition="end with">.adadvisor.net</QueryName> <!--Ads: Neustar [ https://better.fyi/trackers/adadvisor.net/ ] -->
			<QueryName condition="end with">.adap.tv</QueryName> <!--Ads:AOL | Microsoft default exclusion [ https://www.crunchbase.com/organization/adap-tv ] -->
			<QueryName condition="end with">.addthis.com</QueryName> <!--Ads:Oracle | Microsoft default exclusion [ https://en.wikipedia.org/wiki/AddThis ] -->
			<QueryName condition="end with">.adform.net</QueryName> <!--Ads-->
			<QueryName condition="end with">.adnxs.com</QueryName> <!--Ads: AppNexus | Microsoft default exclusion-->
			<QueryName condition="end with">.adroll.com</QueryName> <!--Ads-->
			<QueryName condition="end with">.adrta.com</QueryName> <!--Ads-->
			<QueryName condition="end with">.adsafeprotected.com</QueryName> <!--Ads-->
			<QueryName condition="end with">.adsrvr.org</QueryName> <!--Ads-->
			<QueryName condition="end with">.advertising.com</QueryName> <!--Ads | Microsoft default exclusion-->
			<QueryName condition="end with">.amazon-adsystem.com</QueryName> <!--Ads-->
			<QueryName condition="end with">.amazon-adsystem.com</QueryName> <!--Ads-->
			<QueryName condition="end with">.analytics.yahoo.com</QueryName> <!--Ads:Yahoo-->
			<QueryName condition="end with">.aol.com</QueryName> <!--Ads | Microsoft default exclusion -->
			<QueryName condition="end with">.betrad.com</QueryName> <!--Ads | Microsoft default exclusion-->
			<QueryName condition="end with">.bidswitch.net</QueryName> <!--Ads-->
			<QueryName condition="end with">.casalemedia.com</QueryName> <!--Ads | Microsoft default exclusion-->
			<QueryName condition="end with">.chartbeat.net</QueryName> <!--Ads | Microsoft default exclusion [ https://better.fyi/trackers/chartbeat.com/ ]-->
			<QueryName condition="end with">.cnn.com</QueryName> <!-- Microsoft default exclusion-->
			<QueryName condition="end with">.convertro.com</QueryName> <!--Ads:Verizon-->
			<QueryName condition="end with">.criteo.com</QueryName> <!--Ads [ https://better.fyi/trackers/criteo.com/ ] -->
			<QueryName condition="end with">.criteo.net</QueryName> <!--Ads [ https://better.fyi/trackers/criteo.com/ ] -->
			<QueryName condition="end with">.crwdcntrl.net</QueryName> <!--Ads: Lotame [ https://better.fyi/trackers/crwdcntrl.net/ ] -->
			<QueryName condition="end with">.demdex.net</QueryName> <!--Ads | Microsoft default exclusion-->
			<QueryName condition="end with">.domdex.com</QueryName> 
			<QueryName condition="end with">.dotomi.com</QueryName> <!--Ads | Microsoft default exclusion-->
			<QueryName condition="end with">.doubleclick.net</QueryName> <!--Ads:Conversant | Microsoft default exclusion [ https://www.crunchbase.com/organization/dotomi ] -->
			<QueryName condition="end with">.doubleverify.com</QueryName> <!--Ads: Google-->
			<QueryName condition="end with">.emxdgt.com</QueryName> <!--Ads: EMX-->
			<QueryName condition="end with">.exelator.com</QueryName> <!--Ads:Nielson Marketing Cloud-->
			<QueryName condition="end with">.google-analytics.com</QueryName> <!--Ads:Google | Microsoft default exclusion-->
			<QueryName condition="end with">.googleadservices.com</QueryName> <!--Google-->
			<QueryName condition="end with">.googlesyndication.com</QueryName> <!--Ads:Google, sometimes called during malicious ads, but not directly responsible | Microsoft default exclusion [ https://www.hackread.com/wp-content/uploads/2018/06/Bitdefender-Whitepaper-Zacinlo.pdf ]-->
			<QueryName condition="end with">.googletagmanager.com</QueryName> <!--Google-->
			<QueryName condition="end with">.googlevideo.com</QueryName> <!--Google | Microsoft default exclusion-->
			<QueryName condition="end with">.gstatic.com</QueryName> <!--Google | Microsoft default exclusion-->
			<QueryName condition="end with">.gvt1.com</QueryName> <!--Google-->
			<QueryName condition="end with">.gvt2.com</QueryName> <!--Google-->
			<QueryName condition="end with">.ib-ibi.com</QueryName> <!--Ads: Offerpath [ https://better.fyi/trackers/ib-ibi.com/ ] -->
			<QueryName condition="end with">.jivox.com</QueryName> <!--Ads-->
			<QueryName condition="end with">.mathtag.com</QueryName> <!--Microsoft default exclusion-->
			<QueryName condition="end with">.moatads.com</QueryName> <!--Ads | Microsoft default exclusion-->
			<QueryName condition="end with">.moatpixel.com</QueryName> <!--Ads | Microsoft default exclusion-->
			<QueryName condition="end with">.mookie1.com</QueryName> <!--Ads-->
			<QueryName condition="end with">.myvisualiq.net</QueryName> <!--Ads-->
			<QueryName condition="end with">.netmng.com</QueryName> <!--Ads-->
			<QueryName condition="end with">.nexac.com</QueryName> <!--Ads | Microsoft default exclusion-->
			<QueryName condition="end with">.openx.net</QueryName> <!--Ads-->
			<QueryName condition="end with">.optimizely.com</QueryName> <!--Ads-->
			<QueryName condition="end with">.outbrain.com</QueryName> <!--Ads-->
			<QueryName condition="end with">.pardot.com</QueryName> <!--Ads-->
			<QueryName condition="end with">.phx.gbl</QueryName> <!--Ads | Microsoft default exclusion-->
			<QueryName condition="end with">.pinterest.com</QueryName> <!--Pinerest-->
			<QueryName condition="end with">.pubmatic.com</QueryName> <!--Ads | Microsoft default exclusion-->
			<QueryName condition="end with">.quantcount.com</QueryName>
			<QueryName condition="end with">.quantserve.com</QueryName>
			<QueryName condition="end with">.revsci.net</QueryName> <!--Ads:Omniture | Microsoft default exclusion-->
			<QueryName condition="end with">.rfihub.net</QueryName> <!--Ads | Microsoft default exclusion-->
			<QueryName condition="end with">.rlcdn.com</QueryName> <!--Ads: Rapleaf [ https://better.fyi/trackers/rlcdn.com/ ] -->
			<QueryName condition="end with">.rubiconproject.com</QueryName> <!--Ads: Rubicon Project | Microsoft default exclusion [ https://better.fyi/trackers/rubiconproject.com/ ] -->
			<QueryName condition="end with">.scdn.co</QueryName> <!--Spotify-->
			<QueryName condition="end with">.scorecardresearch.com</QueryName> <!--Ads: Comscore | Microsoft default exclusion-->
			<QueryName condition="end with">.serving-sys.com</QueryName> <!--Ads | Microsoft default exclusion-->
			<QueryName condition="end with">.sharethrough.com</QueryName> <!--Ads-->
			<QueryName condition="end with">.simpli.fi</QueryName>
			<QueryName condition="end with">.sitescout.com</QueryName> <!--Ads-->
			<QueryName condition="end with">.smartadserver.com</QueryName> <!--Ads-->
			<QueryName condition="end with">.snapads.com</QueryName> <!--Ads-->
			<QueryName condition="end with">.spotxchange.com</QueryName> <!--Ads-->
			<QueryName condition="end with">.taboola.com</QueryName> <!--Ads:Taboola-->
			<QueryName condition="end with">.taboola.map.fastly.net</QueryName> <!--Ads:Taboola-->
			<QueryName condition="end with">.tapad.com</QueryName>
			<QueryName condition="end with">.tidaltv.com</QueryName> <!--Ads: Videology [ https://better.fyi/trackers/tidaltv.com/ ] -->
			<QueryName condition="end with">.trafficmanager.net</QueryName> <!--Ads | Microsoft default exclusion-->
			<QueryName condition="end with">.tremorhub.com</QueryName> <!--Ads-->
			<QueryName condition="end with">.tribalfusion.com</QueryName> <!--Ads: Exponential [ https://better.fyi/trackers/tribalfusion.com/ ] -->
			<QueryName condition="end with">.turn.com</QueryName> <!--Ads | Microsoft default exclusion [ https://better.fyi/trackers/turn.com/ ] -->
			<QueryName condition="end with">.twimg.com</QueryName> <!--Ads | Microsoft default exclusion-->
			<QueryName condition="end with">.tynt.com</QueryName> <!--Ads-->
			<QueryName condition="end with">.w55c.net</QueryName> <!--Ads:dataxu-->
			<QueryName condition="end with">.ytimg.com</QueryName> <!--Google-->
			<QueryName condition="end with">.zorosrv.com</QueryName> <!--Ads:Taboola-->
			<QueryName condition="is">1rx.io</QueryName> <!--Ads-->
			<QueryName condition="is">adservice.google.com</QueryName> <!--Google-->
			<QueryName condition="is">ampcid.google.com</QueryName> <!--Google-->
			<QueryName condition="is">clientservices.googleapis.com</QueryName> <!--Google-->
			<QueryName condition="is">googleadapis.l.google.com</QueryName> <!--Google-->
			<QueryName condition="is">imasdk.googleapis.com</QueryName> <!--Google [ https://developers.google.com/interactive-media-ads/docs/sdks/html5/ ] -->
			<QueryName condition="is">l.google.com</QueryName> <!--Google-->
			<QueryName condition="is">ml314.com</QueryName> <!--Ads-->
			<QueryName condition="is">mtalk.google.com</QueryName> <!--Google-->
			<QueryName condition="is">update.googleapis.com</QueryName> <!--Google-->
			<QueryName condition="is">www.googletagservices.com</QueryName> <!--Google-->
			<!--SocialNet-->
			<QueryName condition="end with">.pscp.tv</QueryName> <!--Twitter:Periscope-->
			<!--OSCP/CRL Common-->
			<QueryName condition="end with">.digicert.com</QueryName>
			<QueryName condition="end with">.globalsign.com</QueryName>
			<QueryName condition="end with">.globalsign.net</QueryName>
			<QueryName condition="is">msocsp.com</QueryName> <!--Microsoft:OCSP-->
			<QueryName condition="is">ocsp.msocsp.com</QueryName> <!--Microsoft:OCSP-->
			<QueryName condition="end with">pki.goog</QueryName>
			<QueryName condition="is">ocsp.godaddy.com</QueryName>
			<QueryName condition="end with">amazontrust.com</QueryName>
			<QueryName condition="is">ocsp.sectigo.com</QueryName>
			<QueryName condition="is">pki-goog.l.google.com</QueryName>
			<QueryName condition="end with">.usertrust.com</QueryName>
			<QueryName condition="is">ocsp.comodoca.com</QueryName>
			<QueryName condition="is">ocsp.verisign.com</QueryName>
			<QueryName condition="is">ocsp.entrust.net</QueryName>
			<QueryName condition="end with">ocsp.identrust.com</QueryName>
			<QueryName condition="is">status.rapidssl.com</QueryName>
			<QueryName condition="is">status.thawte.com</QueryName>
			<QueryName condition="is">ocsp.int-x3.letsencrypt.org</QueryName>
			<QueryName condition="is">subca.ocsp-certum.com</QueryName>
			<QueryName condition="is">cscasha2.ocsp-certum.com</QueryName>
			<QueryName condition="is">crl.verisign.com</QueryName>
			<!--Added from Olaf-->
			<!--Logitech-->
			<Rule groupRelation="and">
				<Image name="flag=Info" condition="is">C:\ProgramData\LogiShrd\LogiOptions\Software\Current\updater.exe</Image>
				<QueryName condition="end with">.logitech.com</QueryName>
			</Rule> 
			<!--Microsoft Defender atp-->
			<Image name="flag=Info" condition="is">C:\Program Files\Windows Defender Advanced Threat Protection\MsSense.exe</Image><!--Generates a lot of redundant queries to the originial requestor-->
			<!--Sentinelone-->
			<Image name="flag=Info" condition="contains all">C:\Program Files\SentinelOne\Sentinel Agent;\SentinelAgent.exe</Image>
		</DnsQuery>
	</RuleGroup>


	<!--SYSMON EVENT ID 23 : FILEDELETE-->
	<RuleGroup name="" groupRelation="or">
        <FileDelete onmatch="exclude">
			<!--Google chorme-->
			<Image name="flag=Info" condition="contains all">\appdata\local\google\chrome\user data\swreporter\;software_reporter_tool.exe</Image>
			<Image name="flag=Info" condition="is">C:\Program Files (x86)\Google\Chrome\Application\chrome.exe</Image>
			<!--Windows services-->
			<!--Disabled due to Error : No "User" Element-->
			<!-- <User condition="contains any">NETWORK SERVICE; LOCAL SERVICE</User> -->
        </FileDelete>
	</RuleGroup>
	<RuleGroup name="" groupRelation="or">
		<FileDelete onmatch="include">
			<!--Microsoft SQL server-->
			<TargetFilename name="flag=Info" condition="contains all">C:\Program Files\Microsoft SQL Server;\Shared\ErrorDumps</TargetFilename> <!--Writable for all users-->
			<TargetFilename name="flag=Amber" condition="contains all">C:\Program Files\Microsoft SQL Server;\DataDumps</TargetFilename> <!--Writable for all users-->
			<TargetFilename name="flag=Amber" condition="contains all">C:\Program Files (X86)\Microsoft SQL Server\;Shared\ErrorDumps</TargetFilename> <!--Writable for all users-->                  
			<!--Qualys-->
			<Rule groupRelation="and">
				<TargetFilename name="flag=Info" condition="begin with">C:\Program Files\Qualys\QualysAgent</TargetFilename> <!--Writable for all users-->
				<TargetFilename name="flag=Info" condition="contains any">.com;.bat;.exe;.reg;.ps1;.vbs;.vba;.lnk;.doc;.xls;.hta;.bin;.7z;.dll;.xla;.cmd;.sh;.lnk;.pptm;.scr;.msi;.sct</TargetFilename>
			</Rule>     
			<!--User writable folders-->
			<Rule groupRelation="and">
				<TargetFilename name="flag=Info" condition="contains">\Downloads\</TargetFilename> <!--User Download folder-->
				<TargetFilename name="flag=Info" condition="contains any">.com;.bat;.exe;.reg;.ps1;.vbs;.vba;.lnk;.doc;.xls;.hta;.bin;.7z;.dll;.xla;.cmd;.sh;.lnk;.pptm;.scr;.msi;.sct</TargetFilename>
			</Rule>
			<Rule groupRelation="and">
				<TargetFilename name="flag=Info" condition="contains">\Appdata\Local\Temp\</TargetFilename> <!--User Temp folder-->
				<TargetFilename name="flag=Info" condition="contains any">.com;.bat;.exe;.reg;.ps1;.vbs;.vba;.lnk;.doc;.xls;.hta;.bin;.7z;.dll;.xla;.cmd;.sh;.lnk;.pptm;.scr;.msi;.sct</TargetFilename>
			</Rule>
			<Rule groupRelation="and">
				<TargetFilename name="flag=Amber" condition="contains">\Appdata\Local\Microsoft\Windows\INetCache\Content.Outlook\</TargetFilename> <!--Microsoft Outlook Temp folder-->
				<TargetFilename name="flag=Amber" condition="contains any">.com;.bat;.exe;.reg;.ps1;.vbs;.vba;.lnk;.doc;.xls;.hta;.bin;.7z;.dll;.xla;.cmd;.sh;.lnk;.pptm;.scr;.msi;.sct</TargetFilename>
			</Rule>
			<!--Writable folders-->
			<Rule groupRelation="and">
				<TargetFilename name="flag=Info" condition="begin with">C:\ProgramData\Intel</TargetFilename>
				<TargetFilename name="flag=Info" condition="contains any">.com;.bat;.exe;.reg;.ps1;.vbs;.vba;.lnk;.doc;.xls;.hta;.bin;.7z;.dll;.xla;.cmd;.sh;.lnk;.pptm;.scr;.msi;.sct</TargetFilename>
			</Rule>
			<Rule groupRelation="and">
				<TargetFilename name="flag=Info" condition="begin with">C:\ProgramData\Mozilla</TargetFilename> 
				<TargetFilename name="flag=Info" condition="contains any">.com;.bat;.exe;.reg;.ps1;.vbs;.vba;.lnk;.doc;.xls;.hta;.bin;.7z;.dll;.xla;.cmd;.sh;.lnk;.pptm;.scr;.msi;.sct</TargetFilename>
			</Rule>
			<Rule groupRelation="and">
				<TargetFilename name="flag=Info" condition="begin with">C:\ProgramData\chocolatey\logs</TargetFilename>
				<TargetFilename name="flag=Info" condition="contains any">.com;.bat;.exe;.reg;.ps1;.vbs;.vba;.lnk;.doc;.xls;.hta;.bin;.7z;.dll;.xla;.cmd;.sh;.lnk;.pptm;.scr;.msi;.sct</TargetFilename>
			</Rule>
			<Rule groupRelation="and">
				<TargetFilename name="flag=Red" condition="begin with">C:\ProgramData\Microsoft\DeviceSync</TargetFilename>
				<TargetFilename name="flag=Red" condition="contains any">.com;.bat;.exe;.reg;.ps1;.vbs;.vba;.lnk;.doc;.xls;.hta;.bin;.7z;.dll;.xla;.cmd;.sh;.lnk;.pptm;.scr;.msi;.sct</TargetFilename>
			</Rule>
			<Rule groupRelation="and">
				<TargetFilename name="flag=Info" condition="begin with">C:\ProgramData\Microsoft\PlayReady</TargetFilename>
				<TargetFilename name="flag=Info" condition="contains any">.com;.bat;.exe;.reg;.ps1;.vbs;.vba;.lnk;.doc;.xls;.hta;.bin;.7z;.dll;.xla;.cmd;.sh;.lnk;.pptm;.scr;.msi;.sct</TargetFilename>
			</Rule>
			<Rule groupRelation="and">
				<TargetFilename name="flag=Info" condition="begin with">C:\ProgramData\Microsoft\User Account Pictures</TargetFilename>
				<TargetFilename name="flag=Info" condition="contains any">.com;.bat;.exe;.reg;.ps1;.vbs;.vba;.lnk;.doc;.xls;.hta;.bin;.7z;.dll;.xla;.cmd;.sh;.lnk;.pptm;.scr;.msi;.sct</TargetFilename>
			</Rule>             
			<Rule groupRelation="and">
				<TargetFilename name="flag=Amber" condition="begin with">C:\ProgramData\Microsoft\Crypto\DSS\MachineKeys</TargetFilename>
				<TargetFilename name="flag=Amber" condition="contains any">.com;.bat;.exe;.reg;.ps1;.vbs;.vba;.lnk;.doc;.xls;.hta;.bin;.7z;.dll;.xla;.cmd;.sh;.lnk;.pptm;.scr;.msi;.sct</TargetFilename>
			</Rule>
			<Rule groupRelation="and">
				<TargetFilename name="flag=Amber" condition="begin with">C:\ProgramData\Microsoft\Crypto\RSA\MachineKeys</TargetFilename>
				<TargetFilename name="flag=Amber" condition="contains any">.com;.bat;.exe;.reg;.ps1;.vbs;.vba;.lnk;.doc;.xls;.hta;.bin;.7z;.dll;.xla;.cmd;.sh;.lnk;.pptm;.scr;.msi;.sct</TargetFilename>
			</Rule>
			<Rule groupRelation="and">
				<TargetFilename name="flag=Info" condition="begin with">C:\ProgramData\Microsoft\NetFramework\BreadcrumbStore</TargetFilename>
				<TargetFilename name="flag=Info" condition="contains any">.com;.bat;.exe;.reg;.ps1;.vbs;.vba;.lnk;.doc;.xls;.hta;.bin;.7z;.dll;.xla;.cmd;.sh;.lnk;.pptm;.scr;.msi;.sct</TargetFilename>
			</Rule>
			<Rule groupRelation="and">
				<TargetFilename name="flag=Info" condition="begin with">C:\ProgramData\Microsoft\Office\Heartbeat</TargetFilename>
				<TargetFilename name="flag=Info" condition="contains any">.com;.bat;.exe;.reg;.ps1;.vbs;.vba;.lnk;.doc;.xls;.hta;.bin;.7z;.dll;.xla;.cmd;.sh;.lnk;.pptm;.scr;.msi;.sct</TargetFilename>
			</Rule>
			<Rule groupRelation="and">
				<TargetFilename name="flag=Info" condition="begin with">C:\ProgramData\Microsoft\Windows\WER\ReportQueue</TargetFilename>
				<TargetFilename name="flag=Info" condition="contains any">.com;.bat;.exe;.reg;.ps1;.vbs;.vba;.lnk;.doc;.xls;.hta;.bin;.7z;.dll;.xla;.cmd;.sh;.lnk;.pptm;.scr;.msi;.sct</TargetFilename>
			</Rule>
			<Rule groupRelation="and">
				<TargetFilename name="flag=Info" condition="begin with">C:\ProgramData\Microsoft\Windows\WER\Temp</TargetFilename>
				<TargetFilename name="flag=Info" condition="contains any">.com;.bat;.exe;.reg;.ps1;.vbs;.vba;.lnk;.doc;.xls;.hta;.bin;.7z;.dll;.xla;.cmd;.sh;.lnk;.pptm;.scr;.msi;.sct</TargetFilename>
			</Rule>
			<Rule groupRelation="and">
				<TargetFilename name="flag=Info" condition="begin with">C:\ProgramData\Microsoft\Windows\WER\Temp</TargetFilename>
				<TargetFilename name="flag=Info" condition="contains any">.com;.bat;.exe;.reg;.ps1;.vbs;.vba;.lnk;.doc;.xls;.hta;.bin;.7z;.dll;.xla;.cmd;.sh;.lnk;.pptm;.scr;.msi;.sct</TargetFilename>
			</Rule>
			<Rule groupRelation="and">
				<TargetFilename name="flag=Info" condition="begin with">C:\ProgramData\Microsoft\Windows\WER\Temp</TargetFilename>
				<TargetFilename name="flag=Info" condition="contains any">.com;.bat;.exe;.reg;.ps1;.vbs;.vba;.lnk;.doc;.xls;.hta;.bin;.7z;.dll;.xla;.cmd;.sh;.lnk;.pptm;.scr;.msi;.sct</TargetFilename>
			</Rule>
			<Rule groupRelation="and">
				<TargetFilename name="flag=Info" condition="begin with">C:\ProgramData\Microsoft\Windows\WER\Temp</TargetFilename>
				<TargetFilename name="flag=Info" condition="contains any">.com;.bat;.exe;.reg;.ps1;.vbs;.vba;.lnk;.doc;.xls;.hta;.bin;.7z;.dll;.xla;.cmd;.sh;.lnk;.pptm;.scr;.msi;.sct</TargetFilename>
			</Rule>
			<Rule groupRelation="and">
				<TargetFilename name="flag=Info" condition="begin with">C:\ProgramData\Microsoft\Windows\WER\Temp</TargetFilename>
				<TargetFilename name="flag=Info" condition="contains any">.com;.bat;.exe;.reg;.ps1;.vbs;.vba;.lnk;.doc;.xls;.hta;.bin;.7z;.dll;.xla;.cmd;.sh;.lnk;.pptm;.scr;.msi;.sct</TargetFilename>
			</Rule>
			<Rule groupRelation="and">
				<TargetFilename name="flag=Info" condition="begin with">C:\Users\All Users\Intel</TargetFilename> 
				<TargetFilename name="flag=Info" condition="contains any">.com;.bat;.exe;.reg;.ps1;.vbs;.vba;.lnk;.doc;.xls;.hta;.bin;.7z;.dll;.xla;.cmd;.sh;.lnk;.pptm;.scr;.msi;.sct</TargetFilename>
			</Rule>
			<Rule groupRelation="and">
				<TargetFilename name="flag=Info" condition="begin with">C:\Users\All Users\Mozilla</TargetFilename> 
				<TargetFilename name="flag=Info" condition="contains any">.com;.bat;.exe;.reg;.ps1;.vbs;.vba;.lnk;.doc;.xls;.hta;.bin;.7z;.dll;.xla;.cmd;.sh;.lnk;.pptm;.scr;.msi;.sct</TargetFilename>
			</Rule>
			<Rule groupRelation="and">
				<TargetFilename name="flag=Info" condition="begin with">C:\Users\All Users\chocolatey\logs</TargetFilename>
				<TargetFilename name="flag=Info" condition="contains any">.com;.bat;.exe;.reg;.ps1;.vbs;.vba;.lnk;.doc;.xls;.hta;.bin;.7z;.dll;.xla;.cmd;.sh;.lnk;.pptm;.scr;.msi;.sct</TargetFilename>
			</Rule>
			<Rule groupRelation="and">
				<TargetFilename name="flag=Info" condition="begin with">C:\Users\All Users\Microsoft\DeviceSync</TargetFilename>
				<TargetFilename name="flag=Info" condition="contains any">.com;.bat;.exe;.reg;.ps1;.vbs;.vba;.lnk;.doc;.xls;.hta;.bin;.7z;.dll;.xla;.cmd;.sh;.lnk;.pptm;.scr;.msi;.sct</TargetFilename>
			</Rule>
			<Rule groupRelation="and">
				<TargetFilename name="flag=Info" condition="begin with">C:\Users\All Users\Microsoft\PlayReady</TargetFilename>
				<TargetFilename name="flag=Info" condition="contains any">.com;.bat;.exe;.reg;.ps1;.vbs;.vba;.lnk;.doc;.xls;.hta;.bin;.7z;.dll;.xla;.cmd;.sh;.lnk;.pptm;.scr;.msi;.sct</TargetFilename>
			</Rule>
			<Rule groupRelation="and">
				<TargetFilename name="flag=Info" condition="begin with">C:\Users\All Users\Microsoft\User Account Pictures</TargetFilename>
				<TargetFilename name="flag=Info" condition="contains any">.com;.bat;.exe;.reg;.ps1;.vbs;.vba;.lnk;.doc;.xls;.hta;.bin;.7z;.dll;.xla;.cmd;.sh;.lnk;.pptm;.scr;.msi;.sct</TargetFilename>
			</Rule>
			<Rule groupRelation="and">
				<TargetFilename name="flag=Info" condition="begin with">C:\Users\All Users\Microsoft\Crypto\DSS\MachineKeys</TargetFilename>
				<TargetFilename name="flag=Info" condition="contains any">.com;.bat;.exe;.reg;.ps1;.vbs;.vba;.lnk;.doc;.xls;.hta;.bin;.7z;.dll;.xla;.cmd;.sh;.lnk;.pptm;.scr;.msi;.sct</TargetFilename>
			</Rule>
			<Rule groupRelation="and">
				<TargetFilename name="flag=Info" condition="begin with">C:\Users\All Users\Microsoft\Crypto\RSA\MachineKeys</TargetFilename>
				<TargetFilename name="flag=Info" condition="contains any">.com;.bat;.exe;.reg;.ps1;.vbs;.vba;.lnk;.doc;.xls;.hta;.bin;.7z;.dll;.xla;.cmd;.sh;.lnk;.pptm;.scr;.msi;.sct</TargetFilename>
			</Rule>
			<Rule groupRelation="and">
				<TargetFilename name="flag=Info" condition="begin with">C:\Users\All Users\Microsoft\NetFramework\BreadcrumbStore</TargetFilename>
				<TargetFilename name="flag=Info" condition="contains any">.com;.bat;.exe;.reg;.ps1;.vbs;.vba;.lnk;.doc;.xls;.hta;.bin;.7z;.dll;.xla;.cmd;.sh;.lnk;.pptm;.scr;.msi;.sct</TargetFilename>
			</Rule>
			<Rule groupRelation="and">
				<TargetFilename name="flag=Info" condition="begin with">C:\Users\All Users\Microsoft\Office\Heartbeat</TargetFilename>
				<TargetFilename name="flag=Info" condition="contains any">.com;.bat;.exe;.reg;.ps1;.vbs;.vba;.lnk;.doc;.xls;.hta;.bin;.7z;.dll;.xla;.cmd;.sh;.lnk;.pptm;.scr;.msi;.sct</TargetFilename>
			</Rule>
			<Rule groupRelation="and">
				<TargetFilename name="flag=Info" condition="begin with">C:\Users\All Users\Microsoft\Windows\WER\ReportArchive</TargetFilename>
				<TargetFilename name="flag=Info" condition="contains any">.com;.bat;.exe;.reg;.ps1;.vbs;.vba;.lnk;.doc;.xls;.hta;.bin;.7z;.dll;.xla;.cmd;.sh;.lnk;.pptm;.scr;.msi;.sct</TargetFilename>
			</Rule>
			<Rule groupRelation="and">
				<TargetFilename name="flag=Info" condition="begin with">C:\Users\All Users\Microsoft\Windows\WER\ReportQueue</TargetFilename>
				<TargetFilename name="flag=Info" condition="contains any">.com;.bat;.exe;.reg;.ps1;.vbs;.vba;.lnk;.doc;.xls;.hta;.bin;.7z;.dll;.xla;.cmd;.sh;.lnk;.pptm;.scr;.msi;.sct</TargetFilename>
			</Rule>          
			<Rule groupRelation="and">
				<TargetFilename name="flag=Info" condition="begin with">C:\Users\All Users\Microsoft\Windows\WER\Temp</TargetFilename>
				<TargetFilename name="flag=Info" condition="contains any">.com;.bat;.exe;.reg;.ps1;.vbs;.vba;.lnk;.doc;.xls;.hta;.bin;.7z;.dll;.xla;.cmd;.sh;.lnk;.pptm;.scr;.msi;.sct</TargetFilename>
			</Rule>
			<Rule groupRelation="and">
				<TargetFilename name="flag=Info" condition="begin with">C:\Windows\Tasks</TargetFilename>
				<TargetFilename name="flag=Info" condition="contains any">.com;.bat;.exe;.reg;.ps1;.vbs;.vba;.lnk;.doc;.xls;.hta;.bin;.7z;.dll;.xla;.cmd;.sh;.lnk;.pptm;.scr;.msi;.sct</TargetFilename>
			</Rule>
			<Rule groupRelation="and">
				<TargetFilename name="flag=Info" condition="begin with">C:\Windows\tracing</TargetFilename>
				<TargetFilename name="flag=Info" condition="contains any">.com;.bat;.exe;.reg;.ps1;.vbs;.vba;.lnk;.doc;.xls;.hta;.bin;.7z;.dll;.xla;.cmd;.sh;.lnk;.pptm;.scr;.msi;.sct</TargetFilename>
			</Rule>
			<Rule groupRelation="and">
				<TargetFilename name="flag=Info" condition="begin with">C:\Windows\Registration\CRMLog</TargetFilename>
				<TargetFilename name="flag=Info" condition="contains any">.com;.bat;.exe;.reg;.ps1;.vbs;.vba;.lnk;.doc;.xls;.hta;.bin;.7z;.dll;.xla;.cmd;.sh;.lnk;.pptm;.scr;.msi;.sct</TargetFilename>
			</Rule>
			<Rule groupRelation="and">
				<TargetFilename name="flag=Info" condition="begin with">C:\Windows\System32\Tasks</TargetFilename>
				<TargetFilename name="flag=Info" condition="contains any">.com;.bat;.exe;.reg;.ps1;.vbs;.vba;.lnk;.doc;.xls;.hta;.bin;.7z;.dll;.xla;.cmd;.sh;.lnk;.pptm;.scr;.msi;.sct</TargetFilename>
			</Rule>
			<Rule groupRelation="and">
				<TargetFilename name="flag=Info" condition="begin with">C:\Windows\System32\Microsoft\Crypto\RSA\MachineKeys</TargetFilename>
				<TargetFilename name="flag=Info" condition="contains any">.com;.bat;.exe;.reg;.ps1;.vbs;.vba;.lnk;.doc;.xls;.hta;.bin;.7z;.dll;.xla;.cmd;.sh;.lnk;.pptm;.scr;.msi;.sct</TargetFilename>
			</Rule>
			<Rule groupRelation="and">
				<TargetFilename name="flag=Info" condition="begin with">C:\Windows\System32\spool\drivers\color</TargetFilename>
				<TargetFilename name="flag=Info" condition="contains any">.com;.bat;.exe;.reg;.ps1;.vbs;.vba;.lnk;.doc;.xls;.hta;.bin;.7z;.dll;.xla;.cmd;.sh;.lnk;.pptm;.scr;.msi;.sct</TargetFilename>
			</Rule>
			<Rule groupRelation="and">
				<TargetFilename name="flag=Red" condition="begin with">C:\Windows\SysWOW64\Tasks</TargetFilename>
				<TargetFilename name="flag=Red" condition="contains any">.com;.bat;.exe;.reg;.ps1;.vbs;.vba;.lnk;.doc;.xls;.hta;.bin;.7z;.dll;.xla;.cmd;.sh;.lnk;.pptm;.scr;.msi;.sct</TargetFilename>
			</Rule>
		</FileDelete>
    </RuleGroup>

	<RuleGroup name="" groupRelation="or">
      <!-- Event ID 24 == Clipboard change events, only captures text, not files -->
      <!-- Default set to disabled due to privacy implications and potential data you leave for attackers, enable with care!-->
      <ClipboardChange onmatch="include" />
    </RuleGroup>

    <RuleGroup name="" groupRelation="or">
      <!-- Event ID 25 == Process tampering events -->
      <ProcessTampering onmatch="exclude">
        <Image condition="is">C:\Program Files\Mozilla Firefox\firefox.exe</Image>
        <Image condition="is">C:\Program Files\Mozilla Firefox\updater.exe</Image>
        <Image condition="is">C:\Program Files\Mozilla Firefox\default-browser-agent.exe</Image>
        <Image condition="is">C:\Program Files\Mozilla Firefox\pingsender.exe</Image>
        <Image condition="is">C:\Program Files\Git\cmd\git.exe</Image>
        <Image condition="is">C:\Program Files\Git\mingw64\bin\git.exe</Image>
        <Image condition="is">C:\Program Files\Git\mingw64\libexec\git-core\git.exe</Image>
        <Image condition="is">C:\Program Files (x86)\Microsoft\Edge\Application\msedge.exe</Image>
        <Rule groupRelation="and">
          <Image condition="begin with">C:\Program Files (x86)\Microsoft\Edge\Application\</Image>
          <Image condition="end with">\BHO\ie_to_edge_stub.exe</Image>
        </Rule>
        <Rule groupRelation="and">
          <Image condition="begin with">C:\Program Files (x86)\Microsoft\Edge\Application\</Image>
          <Image condition="end with">\identity_helper.exe</Image>
        </Rule>
        <Rule groupRelation="and">
          <Image condition="begin with">C:\Program Files (x86)\Microsoft\EdgeUpdate\Install\</Image>
          <Image condition="contains">\MicrosoftEdge_X64_</Image>
        </Rule>
        <Image condition="contains">unknown process</Image>
        <Image condition="is">C:\Program Files\Microsoft VS Code\Code.exe</Image>
      </ProcessTampering>
    </RuleGroup>

	<!--SYSMON EVENT ID 255 : ERROR-->
		<!--"This event is generated when an error occurred within Sysmon. They can happen if the system is under heavy load
			and certain tasked could not be performed or a bug exists in the Sysmon service. You can report any bugs on the
			Sysinternals forum or over Twitter (@markrussinovich)."-->
		<!--Cannot be filtered.-->

	</EventFiltering>
</Sysmon>
